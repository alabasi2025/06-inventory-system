# Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†ØŒ ÙŠØ´Ù…Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§ÙØŒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†.

### Ø§Ù„Ù…ØµØ¯Ø± Ù…Ù† Ø§Ù„ØªÙˆ Ø¯Ùˆ
- **Ø§Ù„Ù…Ù‡Ù…Ø© 0.4:** Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (120 Ø³Ø§Ø¹Ø©)
- **Ø§Ù„Ù…Ù‡Ø§Ù… 14-17:** Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (600 Ø³Ø§Ø¹Ø©)
- **Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ù‡Ù…Ø© 0.2:** Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (40 Ø³Ø§Ø¹Ø©)
- **Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:** 760 Ø³Ø§Ø¹Ø©

### Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
â­â­â­ Ø­Ø±Ø¬Ø© Ø¬Ø¯Ø§Ù‹

### Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
- Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù… (01) - Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆÙ„ (03) - Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø§Ù„Ø£ØµÙˆÙ„

---

## Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ (Ø§Ù„Ù…Ù‡Ù…Ø© 0.4.1)

#### 1.1 ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ØµÙ†Ø§Ù
| Ø§Ù„ÙØ¦Ø© | Ø§Ù„ÙˆØµÙ | Ø£Ù…Ø«Ù„Ø© |
|-------|-------|-------|
| Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© | Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„ØªÙˆØµÙŠÙ„Ø§Øª | ÙƒÙŠØ§Ø¨Ù„ØŒ Ù…ÙØ§ØªÙŠØ­ØŒ Ø¹Ø¯Ø§Ø¯Ø§Øª |
| Ù‚Ø·Ø¹ ØºÙŠØ§Ø± | Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ø¯Ø§Øª | ÙÙ„Ø§ØªØ±ØŒ Ø¨Ø·Ø§Ø±ÙŠØ§ØªØŒ Ù…ÙƒÙˆÙ†Ø§Øª |
| Ù…Ø¹Ø¯Ø§Øª | Ø£Ø¯ÙˆØ§Øª ÙˆÙ…Ø¹Ø¯Ø§Øª Ø§Ù„Ø¹Ù…Ù„ | Ø£Ø¯ÙˆØ§Øª ÙŠØ¯ÙˆÙŠØ©ØŒ Ø£Ø¬Ù‡Ø²Ø© Ù‚ÙŠØ§Ø³ |
| Ù…ÙˆØ§Ø¯ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠØ© | Ù…ÙˆØ§Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ | ÙˆÙ‚ÙˆØ¯ØŒ Ø²ÙŠÙˆØªØŒ Ù…ÙˆØ§Ø¯ ØªÙ†Ø¸ÙŠÙ |
| Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡ | Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª | Ø£Ø³Ù…Ù†ØªØŒ Ø­Ø¯ÙŠØ¯ØŒ Ø±Ù…Ù„ |

#### 1.2 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù (items)
```sql
CREATE TABLE items (
    id UUID PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    name_en VARCHAR(200),
    description TEXT,
    category_id UUID REFERENCES item_categories(id),
    unit_id UUID REFERENCES units(id),
    barcode VARCHAR(100),
    
    -- Ø§Ù„ØªØ³Ø¹ÙŠØ±
    purchase_price DECIMAL(15,2),
    selling_price DECIMAL(15,2),
    last_purchase_price DECIMAL(15,2),
    average_cost DECIMAL(15,2),
    
    -- Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    minimum_stock DECIMAL(15,3) DEFAULT 0,
    maximum_stock DECIMAL(15,3),
    reorder_point DECIMAL(15,3),
    reorder_quantity DECIMAL(15,3),
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    inventory_account_id UUID REFERENCES accounts(id),
    cogs_account_id UUID REFERENCES accounts(id),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    is_active BOOLEAN DEFAULT true,
    is_stockable BOOLEAN DEFAULT true,
    is_purchasable BOOLEAN DEFAULT true,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    track_serial BOOLEAN DEFAULT false,
    track_batch BOOLEAN DEFAULT false,
    track_expiry BOOLEAN DEFAULT false,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 1.3 Ø¬Ø¯ÙˆÙ„ ÙØ¦Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù (item_categories)
```sql
CREATE TABLE item_categories (
    id UUID PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    parent_id UUID REFERENCES item_categories(id),
    level INTEGER DEFAULT 1,
    path VARCHAR(500),
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 1.4 Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª (units)
```sql
CREATE TABLE units (
    id UUID PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(50) NOT NULL,
    name_en VARCHAR(50),
    base_unit_id UUID REFERENCES units(id),
    conversion_factor DECIMAL(15,6) DEFAULT 1,
    is_base BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª (Ø§Ù„Ù…Ù‡Ù…Ø© 14.1)

#### 2.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª (warehouses)
```sql
CREATE TABLE warehouses (
    id UUID PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    type VARCHAR(50), -- main, sub, transit, quarantine
    location VARCHAR(200),
    address TEXT,
    manager_id UUID REFERENCES employees(id),
    
    -- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    allow_negative BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    inventory_account_id UUID REFERENCES accounts(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 2.2 Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Virtual Warehouses)

> **Ø§Ù„ØºØ±Ø¶:** ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (Ø¬Ø¯ÙŠØ¯ØŒ Ù…Ø³ØªØ¹Ù…Ù„ØŒ ØªØ§Ù„Ù) Ù„ØªØªØ¨Ø¹ Ø¯Ù‚ÙŠÙ‚

**ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª:**

| Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„ÙˆØµÙ |
|------|------|--------|
| Ø±Ø¦ÙŠØ³ÙŠ | main | Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ |
| ÙØ±Ø¹ÙŠ | sub | Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© |
| Ø¹Ø¨ÙˆØ± | transit | ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ |
| Ø­Ø¬Ø± | quarantine | Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙØ­Øµ |

**ØªØµÙ†ÙŠÙ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:**

| Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„ÙƒÙˆØ¯ | Ø§Ù„ÙˆØµÙ |
|--------|------|--------|
| Ø¬Ø¯ÙŠØ¯ | new | Ø£ØµÙ†Ø§Ù Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù… ØªÙØ³ØªØ®Ø¯Ù… |
| Ù…Ø³ØªØ¹Ù…Ù„ | used | Ø£ØµÙ†Ø§Ù Ù…Ø±ØªØ¬Ø¹Ø© ØµØ§Ù„Ø­Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
| ØªØ§Ù„Ù | damaged | Ø£ØµÙ†Ø§Ù ØªØ§Ù„ÙØ© ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­ Ø£Ùˆ ØªØ®Ø±ÙŠØ¯ |
| Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙØ­Øµ | pending_inspection | Ø£ØµÙ†Ø§Ù Ù…Ø±ØªØ¬Ø¹Ø© Ù„Ù… ØªÙÙØ­Øµ Ø¨Ø¹Ø¯ |

**Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:**

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
ALTER TABLE warehouses ADD COLUMN stock_condition VARCHAR(50) DEFAULT 'new';
-- new, used, damaged, pending_inspection

-- Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
INSERT INTO warehouses (code, name, type, stock_condition) VALUES
-- Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
('MAIN-NEW', 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø¬Ø¯ÙŠØ¯', 'main', 'new'),
('MAIN-USED', 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ù…Ø³ØªØ¹Ù…Ù„', 'main', 'used'),
('MAIN-DAMAGED', 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - ØªØ§Ù„Ù', 'main', 'damaged'),

-- Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© (ÙŠØªÙƒØ±Ø± Ù„ÙƒÙ„ Ù…Ø­Ø·Ø©)
('ST01-NEW', 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© 1 - Ø¬Ø¯ÙŠØ¯', 'sub', 'new'),
('ST01-USED', 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© 1 - Ù…Ø³ØªØ¹Ù…Ù„', 'sub', 'used'),
('ST01-DAMAGED', 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© 1 - ØªØ§Ù„Ù', 'sub', 'damaged'),
('ST01-PENDING', 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© 1 - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙØ­Øµ', 'sub', 'pending_inspection');
```

**Ø³ÙŠØ± Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±ØªØ¬Ø¹:**

```
Ø§Ù„ÙÙ†ÙŠ ÙŠØ³ØªØ¨Ø¯Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯
        â†“
ÙŠØ­Ø¯Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…:
        â”œâ”€â”€ "Ù…Ø³ØªØ¹Ù…Ù„ - ØµØ§Ù„Ø­" â†’ Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© - Ù…Ø³ØªØ¹Ù…Ù„
        â””â”€â”€ "ØªØ§Ù„Ù" â†’ Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ø·Ø© - ØªØ§Ù„Ù
        â†“
Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        â†“
Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ±Ù‰ ØªÙ‚Ø±ÙŠØ±:
        â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø© Ø§Ù„ØµØ§Ù„Ø­Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ÙƒÙŠØ¨
        â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­/ØªØ®Ø±ÙŠØ¯
```

**APIs Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:**

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/warehouses/by-condition/:condition | Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© |
| GET | /api/v1/inventory/used | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ |
| GET | /api/v1/inventory/damaged | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù |
| POST | /api/v1/inventory/return | ØªØ³Ø¬ÙŠÙ„ Ø¥Ø±Ø¬Ø§Ø¹ ØµÙ†Ù |
| PUT | /api/v1/inventory/:id/condition | ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ù |
| POST | /api/v1/inventory/transfer-condition | Ù†Ù‚Ù„ Ø¨ÙŠÙ† Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© |

---

#### 2.3 Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† (storage_locations)
```sql
CREATE TABLE storage_locations (
    id UUID PRIMARY KEY,
    warehouse_id UUID REFERENCES warehouses(id),
    code VARCHAR(50) NOT NULL,
    name VARCHAR(100),
    zone VARCHAR(50),
    rack VARCHAR(50),
    shelf VARCHAR(50),
    bin VARCHAR(50),
    capacity DECIMAL(15,3),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 2.3 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (inventory)
```sql
CREATE TABLE inventory (
    id UUID PRIMARY KEY,
    item_id UUID REFERENCES items(id),
    warehouse_id UUID REFERENCES warehouses(id),
    location_id UUID REFERENCES storage_locations(id),
    
    quantity DECIMAL(15,3) NOT NULL DEFAULT 0,
    reserved_quantity DECIMAL(15,3) DEFAULT 0,
    available_quantity DECIMAL(15,3) GENERATED ALWAYS AS (quantity - reserved_quantity) STORED,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    batch_number VARCHAR(100),
    serial_number VARCHAR(100),
    expiry_date DATE,
    
    -- Ø§Ù„ØªÙƒÙ„ÙØ©
    unit_cost DECIMAL(15,4),
    total_cost DECIMAL(15,2),
    
    last_movement_date TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(item_id, warehouse_id, location_id, batch_number, serial_number)
);
```

#### 2.4 Ø¬Ø¯ÙˆÙ„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (inventory_movements)
```sql
CREATE TABLE inventory_movements (
    id UUID PRIMARY KEY,
    movement_number VARCHAR(50) UNIQUE NOT NULL,
    movement_date TIMESTAMP NOT NULL,
    movement_type VARCHAR(50) NOT NULL, -- in, out, transfer, adjustment
    
    item_id UUID REFERENCES items(id),
    from_warehouse_id UUID REFERENCES warehouses(id),
    to_warehouse_id UUID REFERENCES warehouses(id),
    from_location_id UUID REFERENCES storage_locations(id),
    to_location_id UUID REFERENCES storage_locations(id),
    
    quantity DECIMAL(15,3) NOT NULL,
    unit_cost DECIMAL(15,4),
    total_cost DECIMAL(15,2),
    
    -- Ø§Ù„Ù…Ø±Ø¬Ø¹
    reference_type VARCHAR(50), -- purchase_order, sales_order, transfer, adjustment
    reference_id UUID,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    batch_number VARCHAR(100),
    serial_number VARCHAR(100),
    
    notes TEXT,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 2.5 ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª (Meter Lifecycle Tracking)

Ù†Ø¸Ø§Ù… Ø®Ø§Øµ Ù„ØªØªØ¨Ø¹ Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ø´Ø±Ø§Ø¡ Ø­ØªÙ‰ Ø§Ù„ØªØ±ÙƒÙŠØ¨.

#### Ø¬Ø¯ÙˆÙ„ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª (meter_status_tracking)
```sql
CREATE TABLE meter_status_tracking (
    id UUID PRIMARY KEY,
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    item_id UUID REFERENCES items(id),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    current_status VARCHAR(50) NOT NULL DEFAULT 'in_main_warehouse',
    -- Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ù…ÙƒÙ†Ø©:
    -- 'in_main_warehouse': ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    -- 'in_station_custody': Ø¨Ø¹Ù‡Ø¯Ø© Ù…Ø­Ø·Ø©
    -- 'with_technician': Ù…Ø¹ Ø§Ù„ÙÙ†ÙŠ
    -- 'installed': Ù…Ø±ÙƒØ¨ Ù„Ø¯Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„
    -- 'returned': Ù…Ø±ØªØ¬Ø¹
    -- 'defective': Ù…Ø¹ÙŠØ¨
    -- 'retired': Ù…ØªÙ‚Ø§Ø¹Ø¯
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_warehouse_id UUID REFERENCES warehouses(id),
    current_station_id UUID REFERENCES stations(id),
    current_holder_id UUID REFERENCES users(id), -- Ø§Ù„ÙÙ†ÙŠ Ø£Ùˆ Ø£Ù…ÙŠÙ† Ø§Ù„Ù…Ø®Ø²Ù†
    customer_id UUID REFERENCES customers(id), -- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±ÙƒØ¨Ø§Ù‹
    
    -- ØªÙˆØ§Ø±ÙŠØ® Ù…Ù‡Ù…Ø©
    received_date DATE, -- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯
    issued_to_station_date DATE, -- ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ±Ù Ù„Ù„Ù…Ø­Ø·Ø©
    issued_to_technician_date DATE, -- ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù„Ù„ÙÙ†ÙŠ
    installation_date DATE, -- ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±ÙƒÙŠØ¨
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    purchase_order_id UUID REFERENCES purchase_orders(id),
    grn_id UUID REFERENCES goods_received_notes(id),
    installation_operation_id UUID, -- Ø±Ù‚Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±ÙƒÙŠØ¨
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ (meter_movement_log)
```sql
CREATE TABLE meter_movement_log (
    id UUID PRIMARY KEY,
    meter_id UUID REFERENCES meter_status_tracking(id),
    serial_number VARCHAR(100) NOT NULL,
    
    -- Ø§Ù„Ø­Ø±ÙƒØ©
    from_status VARCHAR(50),
    to_status VARCHAR(50) NOT NULL,
    movement_date TIMESTAMP DEFAULT NOW(),
    
    -- Ø§Ù„ØªÙØ§ØµÙŠÙ„
    from_warehouse_id UUID,
    to_warehouse_id UUID,
    from_station_id UUID,
    to_station_id UUID,
    from_holder_id UUID,
    to_holder_id UUID,
    customer_id UUID,
    
    -- Ø§Ù„Ù…Ø±Ø¬Ø¹
    reference_type VARCHAR(50), -- 'grn', 'material_request', 'installation', 'return'
    reference_id UUID,
    
    notes TEXT,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### Triggers ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯

**1. Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ (GRN):**
```sql
CREATE OR REPLACE FUNCTION on_meter_received()
RETURNS TRIGGER AS $$
BEGIN
    -- Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø¯Ø§Ø¯
    INSERT INTO meter_status_tracking (
        serial_number, item_id, current_status,
        current_warehouse_id, received_date,
        purchase_order_id, grn_id
    ) VALUES (
        NEW.serial_number, NEW.item_id, 'in_main_warehouse',
        NEW.warehouse_id, CURRENT_DATE,
        NEW.purchase_order_id, NEW.grn_id
    );
    
    -- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©
    INSERT INTO meter_movement_log (
        meter_id, serial_number, to_status,
        to_warehouse_id, reference_type, reference_id, created_by
    ) VALUES (
        (SELECT id FROM meter_status_tracking WHERE serial_number = NEW.serial_number),
        NEW.serial_number, 'in_main_warehouse',
        NEW.warehouse_id, 'grn', NEW.grn_id, NEW.received_by
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**2. Ø¹Ù†Ø¯ ØµØ±Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ù…Ø­Ø·Ø©:**
```sql
CREATE OR REPLACE FUNCTION on_meter_issued_to_station()
RETURNS TRIGGER AS $$
DECLARE
    v_meter_id UUID;
    v_old_status VARCHAR(50);
BEGIN
    -- Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    SELECT id, current_status INTO v_meter_id, v_old_status
    FROM meter_status_tracking WHERE serial_number = NEW.serial_number;
    
    -- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
    UPDATE meter_status_tracking SET
        current_status = 'in_station_custody',
        current_warehouse_id = NULL,
        current_station_id = NEW.station_id,
        current_holder_id = NEW.station_manager_id,
        issued_to_station_date = CURRENT_DATE,
        updated_at = NOW()
    WHERE id = v_meter_id;
    
    -- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©
    INSERT INTO meter_movement_log (
        meter_id, serial_number, from_status, to_status,
        from_warehouse_id, to_station_id, to_holder_id,
        reference_type, reference_id, created_by
    ) VALUES (
        v_meter_id, NEW.serial_number, v_old_status, 'in_station_custody',
        NEW.from_warehouse_id, NEW.station_id, NEW.station_manager_id,
        'material_request', NEW.request_id, NEW.issued_by
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**3. Ø¹Ù†Ø¯ ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø¯Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„:**
```sql
CREATE OR REPLACE FUNCTION on_meter_installed()
RETURNS TRIGGER AS $$
DECLARE
    v_meter_id UUID;
    v_old_status VARCHAR(50);
BEGIN
    -- Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    SELECT id, current_status INTO v_meter_id, v_old_status
    FROM meter_status_tracking WHERE serial_number = NEW.meter_serial_number;
    
    -- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
    UPDATE meter_status_tracking SET
        current_status = 'installed',
        current_station_id = NULL,
        current_holder_id = NULL,
        customer_id = NEW.customer_id,
        installation_date = CURRENT_DATE,
        installation_operation_id = NEW.operation_id,
        updated_at = NOW()
    WHERE id = v_meter_id;
    
    -- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©
    INSERT INTO meter_movement_log (
        meter_id, serial_number, from_status, to_status,
        from_station_id, customer_id,
        reference_type, reference_id, created_by
    ) VALUES (
        v_meter_id, NEW.meter_serial_number, v_old_status, 'installed',
        NEW.station_id, NEW.customer_id,
        'installation', NEW.operation_id, NEW.technician_id
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

#### Ø´Ø§Ø´Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
| Ø§Ù„Ø¹Ù†ØµØ± | Ø§Ù„ÙˆØµÙ |
|--------|-------|
| Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø£ÙŠ Ø¹Ø¯Ø§Ø¯ |
| ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© | Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© |
| ÙÙ„ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ | Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹/Ø§Ù„Ù…Ø­Ø·Ø© |
| ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ§Øª | Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ø³Ø¬Ù„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ |
| ØªÙ‚Ø±ÙŠØ± Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø© | Ù…Ù† Ø§Ù„Ø´Ø±Ø§Ø¡ Ø­ØªÙ‰ Ø§Ù„ØªØ±ÙƒÙŠØ¨ |

#### APIs ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/meters/track/:serial | ØªØªØ¨Ø¹ Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ |
| GET | /api/v1/meters/status/:status | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© |
| GET | /api/v1/meters/location/:type/:id | Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ÙŠÙ† |
| GET | /api/v1/meters/:id/history | Ø³Ø¬Ù„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ |
| POST | /api/v1/meters/scan | Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯ |

---

### 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Ù…Ù† Ø§Ù„Ù…Ù‡Ù…Ø© 0.2 + Ø§Ù„Ù…Ù‡Ù…Ø© 16)

#### 3.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (suppliers)
```sql
CREATE TABLE suppliers (
    id UUID PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    name_en VARCHAR(200),
    type VARCHAR(50), -- materials, services, equipment, contractor
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
    phone VARCHAR(20),
    mobile VARCHAR(20),
    email VARCHAR(100),
    website VARCHAR(200),
    
    -- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    address TEXT,
    city VARCHAR(100),
    country VARCHAR(100),
    
    -- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
    tax_number VARCHAR(50),
    commercial_register VARCHAR(50),
    bank_name VARCHAR(100),
    bank_account VARCHAR(50),
    iban VARCHAR(50),
    
    -- Ø´Ø±ÙˆØ· Ø§Ù„ØªØ¹Ø§Ù…Ù„
    payment_terms VARCHAR(50), -- net_30, net_60, cod, prepaid
    credit_limit DECIMAL(15,2),
    currency VARCHAR(10) DEFAULT 'YER',
    
    -- Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    rating DECIMAL(3,2), -- 0.00 - 5.00
    is_approved BOOLEAN DEFAULT false,
    is_blacklisted BOOLEAN DEFAULT false,
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    account_id UUID REFERENCES accounts(id),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(20) DEFAULT 'active', -- active, inactive, suspended
    
    contact_person VARCHAR(100),
    contact_phone VARCHAR(20),
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 3.2 Ø¬Ø¯ÙˆÙ„ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (supplier_ratings)
```sql
CREATE TABLE supplier_ratings (
    id UUID PRIMARY KEY,
    supplier_id UUID REFERENCES suppliers(id),
    period_start DATE,
    period_end DATE,
    
    -- Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    quality_score DECIMAL(3,2), -- Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    delivery_score DECIMAL(3,2), -- Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
    price_score DECIMAL(3,2), -- ØªÙ†Ø§ÙØ³ÙŠØ© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    service_score DECIMAL(3,2), -- Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©
    communication_score DECIMAL(3,2), -- Ø§Ù„ØªÙˆØ§ØµÙ„
    
    overall_score DECIMAL(3,2),
    
    total_orders INTEGER,
    on_time_deliveries INTEGER,
    quality_issues INTEGER,
    
    notes TEXT,
    evaluated_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 3.3 Ø¬Ø¯ÙˆÙ„ Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (supplier_contracts)
```sql
CREATE TABLE supplier_contracts (
    id UUID PRIMARY KEY,
    contract_number VARCHAR(50) UNIQUE NOT NULL,
    supplier_id UUID REFERENCES suppliers(id),
    
    title VARCHAR(200),
    description TEXT,
    contract_type VARCHAR(50), -- framework, project, service
    
    start_date DATE NOT NULL,
    end_date DATE,
    value DECIMAL(15,2),
    currency VARCHAR(10) DEFAULT 'YER',
    
    -- Ø§Ù„Ø´Ø±ÙˆØ·
    payment_terms TEXT,
    delivery_terms TEXT,
    warranty_terms TEXT,
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, active, expired, terminated
    
    document_path VARCHAR(500),
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

---

### 4. Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª (Ø§Ù„Ù…Ù‡Ù…Ø© 0.4.2 + Ø§Ù„Ù…Ù‡Ù…Ø© 15)

#### 4.1 Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ (purchase_requests)
```sql
CREATE TABLE purchase_requests (
    id UUID PRIMARY KEY,
    request_number VARCHAR(50) UNIQUE NOT NULL,
    request_date DATE NOT NULL,
    
    department_id UUID,
    requested_by UUID REFERENCES users(id),
    priority VARCHAR(20) DEFAULT 'normal', -- low, normal, high, urgent
    
    purpose TEXT,
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, pending, approved, rejected, converted
    
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    rejection_reason TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.2 Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙˆØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ (purchase_request_items)
```sql
CREATE TABLE purchase_request_items (
    id UUID PRIMARY KEY,
    request_id UUID REFERENCES purchase_requests(id),
    item_id UUID REFERENCES items(id),
    
    quantity DECIMAL(15,3) NOT NULL,
    unit_id UUID REFERENCES units(id),
    estimated_price DECIMAL(15,2),
    
    specifications TEXT,
    preferred_supplier_id UUID REFERENCES suppliers(id),
    required_date DATE,
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.3 Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (quotation_requests)
```sql
CREATE TABLE quotation_requests (
    id UUID PRIMARY KEY,
    request_number VARCHAR(50) UNIQUE NOT NULL,
    request_date DATE NOT NULL,
    
    purchase_request_id UUID REFERENCES purchase_requests(id),
    
    deadline DATE,
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'sent', -- sent, received, evaluated, closed
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.4 Ø¬Ø¯ÙˆÙ„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (supplier_quotations)
```sql
CREATE TABLE supplier_quotations (
    id UUID PRIMARY KEY,
    quotation_number VARCHAR(50),
    quotation_request_id UUID REFERENCES quotation_requests(id),
    supplier_id UUID REFERENCES suppliers(id),
    
    quotation_date DATE,
    validity_date DATE,
    
    total_amount DECIMAL(15,2),
    currency VARCHAR(10) DEFAULT 'YER',
    
    delivery_terms TEXT,
    payment_terms TEXT,
    warranty_terms TEXT,
    
    document_path VARCHAR(500),
    
    status VARCHAR(20) DEFAULT 'received', -- received, evaluated, selected, rejected
    evaluation_score DECIMAL(5,2),
    evaluation_notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.5 Ø¬Ø¯ÙˆÙ„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (purchase_orders)
```sql
CREATE TABLE purchase_orders (
    id UUID PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    order_date DATE NOT NULL,
    
    supplier_id UUID REFERENCES suppliers(id),
    purchase_request_id UUID REFERENCES purchase_requests(id),
    quotation_id UUID REFERENCES supplier_quotations(id),
    
    -- Ø§Ù„Ù…Ø¨Ø§Ù„Øº
    subtotal DECIMAL(15,2),
    tax_amount DECIMAL(15,2),
    discount_amount DECIMAL(15,2),
    total_amount DECIMAL(15,2),
    currency VARCHAR(10) DEFAULT 'YER',
    
    -- Ø§Ù„Ø´Ø±ÙˆØ·
    payment_terms VARCHAR(50),
    delivery_terms TEXT,
    expected_delivery DATE,
    
    -- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    delivery_address TEXT,
    warehouse_id UUID REFERENCES warehouses(id),
    
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, sent, confirmed, partial, completed, cancelled
    
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 4.6 Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙˆØ¯ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (purchase_order_items)
```sql
CREATE TABLE purchase_order_items (
    id UUID PRIMARY KEY,
    order_id UUID REFERENCES purchase_orders(id),
    item_id UUID REFERENCES items(id),
    
    quantity DECIMAL(15,3) NOT NULL,
    unit_id UUID REFERENCES units(id),
    unit_price DECIMAL(15,4) NOT NULL,
    
    discount_percent DECIMAL(5,2) DEFAULT 0,
    discount_amount DECIMAL(15,2) DEFAULT 0,
    tax_percent DECIMAL(5,2) DEFAULT 0,
    tax_amount DECIMAL(15,2) DEFAULT 0,
    
    total_amount DECIMAL(15,2),
    
    received_quantity DECIMAL(15,3) DEFAULT 0,
    remaining_quantity DECIMAL(15,3) GENERATED ALWAYS AS (quantity - received_quantity) STORED,
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 5. Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ (Ø§Ù„Ù…Ù‡Ù…Ø© 0.4.2)

#### 5.1 Ø¬Ø¯ÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (goods_received_notes)
```sql
CREATE TABLE goods_received_notes (
    id UUID PRIMARY KEY,
    grn_number VARCHAR(50) UNIQUE NOT NULL,
    grn_date DATE NOT NULL,
    
    purchase_order_id UUID REFERENCES purchase_orders(id),
    supplier_id UUID REFERENCES suppliers(id),
    warehouse_id UUID REFERENCES warehouses(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†Ø©
    delivery_note_number VARCHAR(100),
    invoice_number VARCHAR(100),
    vehicle_number VARCHAR(50),
    driver_name VARCHAR(100),
    
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, inspected, accepted, rejected, partial
    
    received_by UUID REFERENCES users(id),
    inspected_by UUID REFERENCES users(id),
    inspected_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 5.2 Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (grn_items)
```sql
CREATE TABLE grn_items (
    id UUID PRIMARY KEY,
    grn_id UUID REFERENCES goods_received_notes(id),
    po_item_id UUID REFERENCES purchase_order_items(id),
    item_id UUID REFERENCES items(id),
    
    ordered_quantity DECIMAL(15,3),
    received_quantity DECIMAL(15,3) NOT NULL,
    accepted_quantity DECIMAL(15,3),
    rejected_quantity DECIMAL(15,3) DEFAULT 0,
    
    unit_id UUID REFERENCES units(id),
    unit_cost DECIMAL(15,4),
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    batch_number VARCHAR(100),
    serial_numbers TEXT[], -- array of serial numbers
    expiry_date DATE,
    
    -- Ø§Ù„ÙØ­Øµ
    inspection_status VARCHAR(20), -- pending, passed, failed, partial
    rejection_reason TEXT,
    
    location_id UUID REFERENCES storage_locations(id),
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 6. ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª (Ø§Ù„Ù…Ù‡Ù…Ø© 0.4.2)

#### 6.1 Ø¬Ø¯ÙˆÙ„ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª (purchase_invoices)
```sql
CREATE TABLE purchase_invoices (
    id UUID PRIMARY KEY,
    invoice_number VARCHAR(50) UNIQUE NOT NULL,
    supplier_invoice_number VARCHAR(100),
    invoice_date DATE NOT NULL,
    due_date DATE,
    
    supplier_id UUID REFERENCES suppliers(id),
    purchase_order_id UUID REFERENCES purchase_orders(id),
    grn_id UUID REFERENCES goods_received_notes(id),
    
    -- Ø§Ù„Ù…Ø¨Ø§Ù„Øº
    subtotal DECIMAL(15,2),
    tax_amount DECIMAL(15,2),
    discount_amount DECIMAL(15,2),
    total_amount DECIMAL(15,2),
    paid_amount DECIMAL(15,2) DEFAULT 0,
    remaining_amount DECIMAL(15,2),
    
    currency VARCHAR(10) DEFAULT 'YER',
    exchange_rate DECIMAL(15,6) DEFAULT 1,
    
    payment_terms VARCHAR(50),
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, posted, partial, paid, cancelled
    
    posted_by UUID REFERENCES users(id),
    posted_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 6.2 Ø¬Ø¯ÙˆÙ„ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (supplier_payments)
```sql
CREATE TABLE supplier_payments (
    id UUID PRIMARY KEY,
    payment_number VARCHAR(50) UNIQUE NOT NULL,
    payment_date DATE NOT NULL,
    
    supplier_id UUID REFERENCES suppliers(id),
    invoice_id UUID REFERENCES purchase_invoices(id),
    
    amount DECIMAL(15,2) NOT NULL,
    currency VARCHAR(10) DEFAULT 'YER',
    
    payment_method VARCHAR(50), -- cash, bank_transfer, check
    reference_number VARCHAR(100),
    bank_account VARCHAR(100),
    
    notes TEXT,
    
    status VARCHAR(20) DEFAULT 'pending', -- pending, completed, cancelled
    
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 7. Ø§Ù„Ø¬Ø±Ø¯ ÙˆØ§Ù„ØªØ³ÙˆÙŠØ§Øª (Ø§Ù„Ù…Ù‡Ù…Ø© 14.3)

#### 7.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¯ (stock_counts)
```sql
CREATE TABLE stock_counts (
    id UUID PRIMARY KEY,
    count_number VARCHAR(50) UNIQUE NOT NULL,
    count_date DATE NOT NULL,
    
    warehouse_id UUID REFERENCES warehouses(id),
    count_type VARCHAR(50), -- full, partial, cycle
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, in_progress, completed, approved
    
    notes TEXT,
    
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 7.2 Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ø±Ø¯ (stock_count_items)
```sql
CREATE TABLE stock_count_items (
    id UUID PRIMARY KEY,
    count_id UUID REFERENCES stock_counts(id),
    item_id UUID REFERENCES items(id),
    location_id UUID REFERENCES storage_locations(id),
    
    system_quantity DECIMAL(15,3),
    counted_quantity DECIMAL(15,3),
    variance DECIMAL(15,3) GENERATED ALWAYS AS (counted_quantity - system_quantity) STORED,
    
    unit_cost DECIMAL(15,4),
    variance_value DECIMAL(15,2),
    
    batch_number VARCHAR(100),
    serial_number VARCHAR(100),
    
    notes TEXT,
    counted_by UUID REFERENCES users(id),
    counted_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 7.3 Ø¬Ø¯ÙˆÙ„ ØªØ³ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (inventory_adjustments)
```sql
CREATE TABLE inventory_adjustments (
    id UUID PRIMARY KEY,
    adjustment_number VARCHAR(50) UNIQUE NOT NULL,
    adjustment_date DATE NOT NULL,
    
    warehouse_id UUID REFERENCES warehouses(id),
    stock_count_id UUID REFERENCES stock_counts(id),
    
    adjustment_type VARCHAR(50), -- increase, decrease, write_off
    reason VARCHAR(200),
    
    total_value DECIMAL(15,2),
    
    status VARCHAR(20) DEFAULT 'draft', -- draft, approved, posted
    
    notes TEXT,
    
    created_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    journal_entry_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 8. Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Ø§Ù„Ù…Ù‡Ù…Ø© 0.4.3 + Ø§Ù„Ù…Ù‡Ù…Ø© 14.4 + Ø§Ù„Ù…Ù‡Ù…Ø© 17)

#### 8.1 ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
| Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ | Ø§Ù„Ø´Ø±Ø· | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ |
|---------|-------|---------|
| Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶ | Ø§Ù„ÙƒÙ…ÙŠØ© < Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ | Ø¥Ø´Ø¹Ø§Ø± + Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ |
| Ù…Ø®Ø²ÙˆÙ† Ø²Ø§Ø¦Ø¯ | Ø§Ù„ÙƒÙ…ÙŠØ© > Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ | Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© |
| ØµÙ†Ù Ù…Ù†ØªÙ‡ÙŠ | Ø§Ù„ÙƒÙ…ÙŠØ© = 0 | Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¬Ù„ |
| Ù‚Ø±Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© < 30 ÙŠÙˆÙ… | Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ØªØµØ±ÙŠÙ |
| ØªØ£Ø®Ø± Ø§Ù„ØªÙˆØ±ÙŠØ¯ | Ø§Ù„ØªØ§Ø±ÙŠØ® > Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ | Ø¥Ø´Ø¹Ø§Ø± + Ù…ØªØ§Ø¨Ø¹Ø© |

#### 8.2 Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
| Ø§Ù„ØªÙ‚Ø±ÙŠØ± | Ø§Ù„ÙˆØµÙ |
|---------|-------|
| Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† | Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ§Ù„Ù‚ÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù/Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ |
| Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø®Ù„Ø§Ù„ ÙØªØ±Ø© |
| Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ | Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… |
| Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† | ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ | ØªØ­Ù„ÙŠÙ„ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø´Ø±Ø§Ø¡ |
| Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø¨Ø·ÙŠØ¦Ø© | Ø§Ù„Ø£ØµÙ†Ø§Ù Ù‚Ù„ÙŠÙ„Ø© Ø§Ù„Ø­Ø±ÙƒØ© |
| ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø±Ø¯ | Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬Ø±Ø¯ ÙˆØ§Ù„ÙØ±ÙˆÙ‚Ø§Øª |

---

## Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ

### Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
| Ø§Ù„Ø­Ø³Ø§Ø¨ | Ø§Ù„Ø±Ù…Ø² | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… |
|--------|-------|-----------|
| Ø§Ù„Ù…Ø®Ø²ÙˆÙ† | 130 | Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| Ù…Ø®Ø²ÙˆÙ† Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© | 1301 | Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ© |
| Ù…Ø®Ø²ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø± | 1302 | Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± |
| Ù…Ø®Ø²ÙˆÙ† ÙˆÙ‚ÙˆØ¯ | 1303 | Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙˆØ§Ù„Ø²ÙŠÙˆØª |
| Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ† | 210 | Ø°Ù…Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª | 410 | ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© |
| Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ | 520 | Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø±Ø§Ø¡ |

### Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©

#### Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹:
```
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (130)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (210)
```

#### Ø¹Ù†Ø¯ Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯:
```
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (210)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
```

#### Ø¹Ù†Ø¯ ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù†Ù‚Øµ):
```
Ù…Ù† Ø­Ù€/ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (590)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (130)
```

#### Ø¹Ù†Ø¯ ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø²ÙŠØ§Ø¯Ø©):
```
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (130)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (490)
```

---

## Ø§Ù„Ù€ APIs

### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/items | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù |
| GET | /api/v1/items/:id | ØªÙØ§ØµÙŠÙ„ ØµÙ†Ù |
| POST | /api/v1/items | Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ù |
| PUT | /api/v1/items/:id | ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù |
| DELETE | /api/v1/items/:id | Ø­Ø°Ù ØµÙ†Ù |
| GET | /api/v1/items/search | Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù |
| GET | /api/v1/item-categories | ÙØ¦Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù |

### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/inventory | Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| GET | /api/v1/inventory/item/:id | Ù…Ø®Ø²ÙˆÙ† ØµÙ†Ù |
| GET | /api/v1/inventory/warehouse/:id | Ù…Ø®Ø²ÙˆÙ† Ù…Ø³ØªÙˆØ¯Ø¹ |
| POST | /api/v1/inventory/adjust | ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| POST | /api/v1/inventory/transfer | ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª |
| GET | /api/v1/inventory/movements | Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |

### Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/suppliers | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| GET | /api/v1/suppliers/:id | ØªÙØ§ØµÙŠÙ„ Ù…ÙˆØ±Ø¯ |
| POST | /api/v1/suppliers | Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ±Ø¯ |
| PUT | /api/v1/suppliers/:id | ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ±Ø¯ |
| GET | /api/v1/suppliers/:id/orders | Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ |
| GET | /api/v1/suppliers/:id/invoices | ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ |
| POST | /api/v1/suppliers/:id/rate | ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ |

### Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/purchase-requests | Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ |
| POST | /api/v1/purchase-requests | Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ |
| PUT | /api/v1/purchase-requests/:id/approve | Ø§Ø¹ØªÙ…Ø§Ø¯ Ø·Ù„Ø¨ |
| GET | /api/v1/purchase-orders | Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ |
| POST | /api/v1/purchase-orders | Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ |
| POST | /api/v1/grn | ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù… |
| GET | /api/v1/purchase-invoices | ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª |
| POST | /api/v1/supplier-payments | ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© |

### Ø§Ù„Ø¬Ø±Ø¯
| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/stock-counts | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø±Ø¯ |
| POST | /api/v1/stock-counts | Ø¨Ø¯Ø¡ Ø¬Ø±Ø¯ Ø¬Ø¯ÙŠØ¯ |
| PUT | /api/v1/stock-counts/:id/items | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ø¯ |
| POST | /api/v1/stock-counts/:id/approve | Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¬Ø±Ø¯ |

---

## Ø§Ù„Ø´Ø§Ø´Ø§Øª

### Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù
1. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù
2. Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù
3. Ø´Ø¬Ø±Ø© ÙØ¦Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù
4. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ†Ù (ØªÙØ§ØµÙŠÙ„ + Ø­Ø±ÙƒØ§Øª)

### Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
5. Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
6. Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
7. ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
8. ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

### Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
9. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
10. Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ±Ø¯
11. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ (ØªÙØ§ØµÙŠÙ„ + Ù…Ø¹Ø§Ù…Ù„Ø§Øª)
12. ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

### Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
13. Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
14. Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡
15. Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
16. Ù†Ù…ÙˆØ°Ø¬ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡
17. Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹
18. ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
19. Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

### Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¬Ø±Ø¯
20. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø±Ø¯
21. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø±Ø¯
22. ØªÙ‚Ø±ÙŠØ± ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ø¬Ø±Ø¯

---

## Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ

| Ø§Ù„Ù…Ø±Ø­Ù„Ø© | Ø§Ù„Ù…Ù‡Ø§Ù… | Ø§Ù„Ø³Ø§Ø¹Ø§Øª | Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ |
|---------|--------|---------|----------|
| 1 | Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„ÙØ¦Ø§Øª | 80 | 2 |
| 2 | Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† | 120 | 3 |
| 3 | Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† | 80 | 2 |
| 4 | Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª | 200 | 5 |
| 5 | Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± | 120 | 3 |
| 6 | Ø§Ù„Ø¬Ø±Ø¯ ÙˆØ§Ù„ØªØ³ÙˆÙŠØ§Øª | 80 | 2 |
| 7 | Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª | 80 | 2 |
| **Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ** | | **760** | **19** |

---

## Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø®Ø±Ù‰

| Ø§Ù„Ù†Ø¸Ø§Ù… | Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¨Ø· | Ø§Ù„ÙˆØµÙ |
|--------|-----------|-------|
| Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù… (01) | Ù…Ø­Ø§Ø³Ø¨ÙŠ | Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø§Ù„Ù‚ÙŠÙˆØ¯ |
| Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆÙ„ (03) | Ù…Ø±Ø¬Ø¹ÙŠ | Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø§Ù„Ø£ØµÙˆÙ„ |
| Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© (04) | ØªØ´ØºÙŠÙ„ÙŠ | ØµØ±Ù Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª |
| Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„ØµÙŠØ§Ù†Ø© (05) | ØªØ´ØºÙŠÙ„ÙŠ | Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± Ù„Ù„ØµÙŠØ§Ù†Ø© |
| Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (08) | ØªØ¬Ø§Ø±ÙŠ | Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯ |

---

## 9ï¸âƒ£ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù (Damaged Inventory Management)

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© Ù…Ù† Ø§Ù„Ù…ÙŠØ¯Ø§Ù† ÙˆØ§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø£Ùˆ Ø§Ù„ØªØ®Ù„Øµ

### 9.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù (damaged_inventory)

```sql
CREATE TABLE damaged_inventory (
    id UUID PRIMARY KEY,
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒÙˆÙ†
    component_type VARCHAR(50) NOT NULL, -- meter, breaker, seal, cable
    serial_number VARCHAR(100),
    model VARCHAR(100),
    brand VARCHAR(100),
    
    -- Ù…ØµØ¯Ø± Ø§Ù„ØªÙ„Ù
    source_type VARCHAR(50), -- replacement, maintenance, inspection, return
    replacement_id UUID, -- Ø±Ø¨Ø· Ø¨Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„
    work_order_id UUID,
    customer_id UUID,
    
    -- Ø³Ø¨Ø¨ Ø§Ù„ØªÙ„Ù
    damage_reason VARCHAR(200),
    damage_description TEXT,
    damage_date DATE,
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹
    warehouse_id UUID REFERENCES warehouses(id),
    location_id UUID REFERENCES storage_locations(id),
    received_date DATE,
    received_by UUID REFERENCES users(id),
    
    -- Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    estimated_repair_cost DECIMAL(15,2),
    original_value DECIMAL(15,2),
    salvage_value DECIMAL(15,2),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(50) DEFAULT 'pending_inspection',
    -- pending_inspection: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙØ­Øµ
    -- under_evaluation: ØªØ­Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    -- approved_repair: Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    -- in_repair: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    -- repaired: ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    -- approved_disposal: Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ØªØ®Ù„Øµ
    -- disposed: ØªÙ… Ø§Ù„ØªØ®Ù„Øµ
    
    -- Ø§Ù„Ù‚Ø±Ø§Ø±
    decision VARCHAR(50), -- repair, dispose, sell_scrap
    decision_date DATE,
    decision_by UUID REFERENCES users(id),
    decision_notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_damaged_inventory_status ON damaged_inventory(status);
CREATE INDEX idx_damaged_inventory_type ON damaged_inventory(component_type);
```

### 9.2 Ø¬Ø¯ÙˆÙ„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (repair_orders)

```sql
CREATE TABLE repair_orders (
    id UUID PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    
    damaged_item_id UUID REFERENCES damaged_inventory(id),
    
    -- Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„/Ø§Ù„ÙˆØ±Ø´Ø©
    repair_type VARCHAR(50), -- internal, external
    contractor_id UUID, -- Ø¥Ø°Ø§ Ø®Ø§Ø±Ø¬ÙŠ
    technician_id UUID, -- Ø¥Ø°Ø§ Ø¯Ø§Ø®Ù„ÙŠ
    
    -- Ø§Ù„ØªÙƒÙ„ÙØ©
    estimated_cost DECIMAL(15,2),
    actual_cost DECIMAL(15,2),
    
    -- Ø§Ù„ØªÙˆÙ‚ÙŠØª
    start_date DATE,
    expected_completion DATE,
    actual_completion DATE,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(50) DEFAULT 'pending',
    -- pending, in_progress, completed, failed
    
    repair_notes TEXT,
    quality_check_passed BOOLEAN,
    quality_notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 9.3 Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„ØªØ®Ù„Øµ (disposal_log)

```sql
CREATE TABLE disposal_log (
    id UUID PRIMARY KEY,
    disposal_number VARCHAR(50) UNIQUE NOT NULL,
    disposal_date DATE NOT NULL,
    
    damaged_item_id UUID REFERENCES damaged_inventory(id),
    
    -- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ®Ù„Øµ
    disposal_method VARCHAR(50), -- scrap_sale, recycling, destruction
    
    -- Ø§Ù„Ù‚ÙŠÙ…Ø©
    scrap_value DECIMAL(15,2) DEFAULT 0,
    buyer_name VARCHAR(200), -- Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¨ÙŠØ¹
    
    -- Ø§Ù„ØªÙˆØ«ÙŠÙ‚
    disposal_certificate VARCHAR(500), -- Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥ØªÙ„Ø§Ù
    photos JSONB, -- ØµÙˆØ± Ø§Ù„ØªØ®Ù„Øµ
    
    -- Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
    approved_by UUID REFERENCES users(id),
    witnessed_by UUID REFERENCES users(id),
    
    notes TEXT,
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    journal_entry_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 9.4 Ø³ÙŠØ± Ø¹Ù…Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­/Ø§Ù„ØªØ®Ù„Øµ

```
Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„ØªØ§Ù„Ù ÙŠØµÙ„ Ù„Ù„Ù…Ø®Ø²Ù†
         â†“
Ø£Ù…ÙŠÙ† Ø§Ù„Ù…Ø®Ø²Ù† ÙŠØ³ØªÙ„Ù… ÙˆÙŠØ³Ø¬Ù„ ÙÙŠ Ø¬Ø¯ÙˆÙ„ damaged_inventory
         â†“
Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø®ØªØµ ÙŠÙØ­Øµ ÙˆÙŠÙ‚ÙŠÙ‘Ù…:
    - ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
    - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
    - Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø±Ø¯Ø©
         â†“
Ø§Ù„Ù‚Ø±Ø§Ø±:
    Ø¥Ø°Ø§ (ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ < 50% Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©) â†’ Ø¥ØµÙ„Ø§Ø­
    ÙˆØ¥Ù„Ø§ â†’ ØªØ®Ù„Øµ (Ø¨ÙŠØ¹ Ø®Ø±Ø¯Ø© Ø£Ùˆ Ø¥ØªÙ„Ø§Ù)
         â†“
Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Ø§Ø±
         â†“
ØªÙ†ÙÙŠØ° Ø§Ù„Ù‚Ø±Ø§Ø± + Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
```

### 9.5 Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù

| Ø§Ù„Ø¹Ù†ØµØ± | Ø§Ù„ÙˆØµÙ |
|---------|-------|
| Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ© | Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ© Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø© |
| ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© | Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙØ­ØµØŒ ØªØ­Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ØŒ ØªÙ… Ø§Ù„ØªØ®Ù„Øµ |
| ÙÙ„ØªØ± Ø§Ù„Ù†ÙˆØ¹ | Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ù‚ÙˆØ§Ø·Ø¹ØŒ Ø£Ø®ØªØ§Ù… |
| Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª | Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù†ÙˆØ¹ |
| Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… | Ø¥Ø¯Ø®Ø§Ù„ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙˆØ§Ù„Ù‚Ø±Ø§Ø± |
| ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù | Ø¹Ø¯Ø¯ ÙˆÙ‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ© |

### 9.6 APIs Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/damaged-inventory | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù |
| GET | /api/v1/damaged-inventory/:id | ØªÙØ§ØµÙŠÙ„ Ù…ÙƒÙˆÙ† ØªØ§Ù„Ù |
| POST | /api/v1/damaged-inventory | ØªØ³Ø¬ÙŠÙ„ Ù…ÙƒÙˆÙ† ØªØ§Ù„Ù Ø¬Ø¯ÙŠØ¯ |
| PUT | /api/v1/damaged-inventory/:id/evaluate | ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙƒÙˆÙ† |
| PUT | /api/v1/damaged-inventory/:id/decision | Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø± (Ø¥ØµÙ„Ø§Ø­/ØªØ®Ù„Øµ) |
| POST | /api/v1/repair-orders | Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¥ØµÙ„Ø§Ø­ |
| PUT | /api/v1/repair-orders/:id/complete | Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ |
| POST | /api/v1/disposal | ØªØ³Ø¬ÙŠÙ„ ØªØ®Ù„Øµ |
| GET | /api/v1/damaged-inventory/report | ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù |

### 9.7 Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©

**Ø¹Ù†Ø¯ Ø§Ù„ØªØ®Ù„Øµ (Ø¥ØªÙ„Ø§Ù):**
```
Ù…Ù† Ø­Ù€/ Ø®Ø³Ø§Ø¦Ø± Ø¥ØªÙ„Ø§Ù Ø§Ù„Ø£ØµÙˆÙ„ (590)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (130)
```

**Ø¹Ù†Ø¯ Ø¨ÙŠØ¹ Ø§Ù„Ø®Ø±Ø¯Ø©:**
```
Ù…Ù† Ø­Ù€/ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚/Ø§Ù„Ø¨Ù†Ùƒ
Ù…Ù† Ø­Ù€/ Ø®Ø³Ø§Ø¦Ø± Ø¨ÙŠØ¹ Ø§Ù„Ø®Ø±Ø¯Ø© (Ø§Ù„ÙØ±Ù‚)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (130)
```

**Ø¹Ù†Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:**
```
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ù…ÙØµÙ„Ø­)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (520)
```


---

## 13. Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø¹Ù… (Fund Returns Warehouse)

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ø³Ù„Ø§Ùƒ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© Ù…Ù† Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ù„ØªØ³Ù„ÙŠÙ…Ù‡Ø§ Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø¹Ù… ÙˆØªÙ†Ù…ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©.

### 13.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© (returned_meters)

```sql
CREATE TABLE returned_meters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    meter_serial VARCHAR(50) NOT NULL,
    meter_type VARCHAR(30),
    meter_model VARCHAR(50),
    
    source_type VARCHAR(30) NOT NULL,  -- 'migration', 'replacement', 'disconnection'
    migration_plan_id UUID,
    work_order_id UUID,
    customer_id UUID,
    
    condition VARCHAR(20) NOT NULL,  -- 'working', 'damaged', 'unknown'
    condition_notes TEXT,
    
    received_date DATE NOT NULL,
    received_by UUID REFERENCES users(id),
    
    delivered_to_fund BOOLEAN DEFAULT false,
    delivery_date DATE,
    delivery_receipt_number VARCHAR(50),
    delivered_by UUID REFERENCES users(id),
    
    photos JSONB,
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 13.2 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© (returned_wires)

```sql
CREATE TABLE returned_wires (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    wire_type VARCHAR(30),
    wire_size VARCHAR(20),
    length_meters DECIMAL(10, 2) NOT NULL,
    weight_kg DECIMAL(10, 2),
    
    source_type VARCHAR(30) NOT NULL,
    migration_plan_id UUID,
    work_order_id UUID,
    
    condition VARCHAR(20) NOT NULL,  -- 'good', 'damaged', 'scrap'
    
    received_date DATE NOT NULL,
    received_by UUID REFERENCES users(id),
    
    delivered_to_fund BOOLEAN DEFAULT false,
    delivery_date DATE,
    delivery_receipt_number VARCHAR(50),
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 13.3 Ø¬Ø¯ÙˆÙ„ ØªØ³Ù„ÙŠÙ…Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø¹Ù… (fund_deliveries)

```sql
CREATE TABLE fund_deliveries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    delivery_number VARCHAR(20) UNIQUE NOT NULL,
    delivery_date DATE NOT NULL,
    
    meters_count INT DEFAULT 0,
    wires_length_total DECIMAL(10, 2) DEFAULT 0,
    wires_weight_total DECIMAL(10, 2) DEFAULT 0,
    
    receipt_number VARCHAR(50),
    receipt_photo VARCHAR(500),
    
    fund_representative_name VARCHAR(100),
    fund_representative_phone VARCHAR(20),
    
    delivered_by UUID REFERENCES users(id),
    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'delivered', 'confirmed'
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 13.4 Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¯Ø¹Ù…                   [+ ØªØ³Ù„ÙŠÙ… Ø¬Ø¯ÙŠØ¯]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ 45 Ø¹Ø¯Ø§Ø¯     â”‚ â”‚ 1,200 Ù…ØªØ±   â”‚ â”‚ 12 ØªØ³Ù„ÙŠÙ…    â”‚                 â”‚
â”‚  â”‚ Ø¨Ø§Ù†ØªØ¸Ø§Ø±     â”‚ â”‚ Ø£Ø³Ù„Ø§Ùƒ       â”‚ â”‚ Ù…ÙƒØªÙ…Ù„       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                     â”‚
â”‚  [Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª] [Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ] [Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª]                                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Ø§Ù„Ø±Ù‚Ù…      â”‚ Ø§Ù„Ù†ÙˆØ¹    â”‚ Ø§Ù„Ø­Ø§Ù„Ø©   â”‚ Ø§Ù„Ù…ØµØ¯Ø±   â”‚ [âœ“]     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                     â”‚
â”‚  [ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„] [Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø¶Ø± ØªØ³Ù„ÙŠÙ…]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.5 APIs Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/returned-meters` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© |
| POST | `/api/v1/returned-meters` | ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¯Ø§Ø¯ Ù…Ø±ØªØ¬Ø¹ |
| GET | `/api/v1/returned-wires` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© |
| POST | `/api/v1/returned-wires` | ØªØ³Ø¬ÙŠÙ„ Ø£Ø³Ù„Ø§Ùƒ Ù…Ø±ØªØ¬Ø¹Ø© |
| GET | `/api/v1/fund-deliveries` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª |
| POST | `/api/v1/fund-deliveries` | Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø¶Ø± ØªØ³Ù„ÙŠÙ… |
| PUT | `/api/v1/fund-deliveries/:id/confirm` | ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… |
| GET | `/api/v1/fund-deliveries/:id/report` | ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ù„ÙŠÙ… (PDF) |



---

# 10. Ø±Ø¨Ø· Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (Inventory-Project Integration) - Ù…Ù„Ù 19

> **Ø§Ù„ØºØ±Ø¶:** Ø±Ø¨Ø· Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ±Ù ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ­Ø²Ù… Ø§Ù„Ø¹Ù…Ù„ Ù„ØªØªØ¨Ø¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ

## 10.1 Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ±Ù

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ±Ù
ALTER TABLE inventory_requests ADD COLUMN project_id UUID REFERENCES projects(id);
ALTER TABLE inventory_requests ADD COLUMN work_package_id UUID REFERENCES work_packages(id);

CREATE INDEX idx_inventory_requests_project ON inventory_requests(project_id);
CREATE INDEX idx_inventory_requests_work_package ON inventory_requests(work_package_id);
```

## 10.2 Ø¬Ø¯ÙˆÙ„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (project_material_consumption)

```sql
CREATE TABLE project_material_consumption (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID NOT NULL REFERENCES projects(id),
    work_package_id UUID REFERENCES work_packages(id),
    
    -- Ø§Ù„ØµÙ†Ù
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    item_code VARCHAR(50),
    item_name VARCHAR(200),
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ§Øª
    planned_quantity DECIMAL(10, 2),
    actual_quantity DECIMAL(10, 2) DEFAULT 0,
    variance DECIMAL(10, 2) GENERATED ALWAYS AS (actual_quantity - planned_quantity) STORED,
    
    -- Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ
    unit_cost DECIMAL(12, 2),
    total_cost DECIMAL(14, 2) GENERATED ALWAYS AS (actual_quantity * unit_cost) STORED,
    
    -- Ø§Ù„Ù…ØµØ¯Ø±
    inventory_request_id UUID REFERENCES inventory_requests(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_project_material_project ON project_material_consumption(project_id);
CREATE INDEX idx_project_material_item ON project_material_consumption(item_id);
```

## 10.3 Ø´Ø§Ø´Ø© Ø·Ù„Ø¨ ØµØ±Ù Ù…ÙˆØ§Ø¯ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ Ø·Ù„Ø¨ ØµØ±Ù Ù…ÙˆØ§Ø¯                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: [ØªØ±Ø­ÙŠÙ„ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… Ø¥Ù„Ù‰ IoT â–¼]                                      â”‚
â”‚  Ø­Ø²Ù…Ø© Ø§Ù„Ø¹Ù…Ù„: [Ø­Ø²Ù…Ø© 4: ØªØ±ÙƒÙŠØ¨ 25 Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ â–¼]                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø© Ù„Ù„Ø­Ø²Ù…Ø© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù          â”‚ Ø§Ù„Ù…Ø®Ø·Ø· â”‚ Ø§Ù„Ù…ØµØ±ÙˆÙ â”‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ â”‚ Ø§Ù„Ù…ØªÙˆÙØ± â”‚ Ø·Ù„Ø¨           â”‚ â”‚
â”‚  â”‚ Ø¹Ø¯Ø§Ø¯ IoT       â”‚ 25     â”‚ 0       â”‚ 25      â”‚ 50      â”‚ [25    ]      â”‚ â”‚
â”‚  â”‚ Ø®ØªÙ… Ø£Ù…Ø§Ù†       â”‚ 25     â”‚ 0       â”‚ 25      â”‚ 100     â”‚ [25    ]      â”‚ â”‚
â”‚  â”‚ ÙƒØ§Ø¨Ù„ 10Ù…       â”‚ 50     â”‚ 0       â”‚ 50      â”‚ 200     â”‚ [50    ]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ØºÙŠØ± Ù…Ø®Ø·Ø· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù: [Ø¨Ø­Ø«...                    â–¼] Ø§Ù„ÙƒÙ…ÙŠØ©: [    ] [+ Ø¥Ø¶Ø§ÙØ©]         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  Ù…Ù„Ø§Ø­Ø¸Ø§Øª: [                                                            ]   â”‚
â”‚                                                                             â”‚
â”‚  [Ø¥Ù„ØºØ§Ø¡]                                              [Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨]        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10.4 Ø´Ø§Ø´Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙˆØ§Ø¯: ØªØ±Ø­ÙŠÙ„ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… Ø¥Ù„Ù‰ IoT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø©: 175,000 Ø±ÙŠØ§Ù„                                   â”‚ â”‚
â”‚  â”‚ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙØ©: 156,250 Ø±ÙŠØ§Ù„ (89%)                            â”‚ â”‚
â”‚  â”‚ Ø§Ù„ÙØ±Ù‚: 18,750 Ø±ÙŠØ§Ù„ (ÙˆÙØ±)                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù      â”‚ Ø§Ù„Ù…Ø®Ø·Ø· â”‚ Ø§Ù„ÙØ¹Ù„ÙŠ â”‚ Ø§Ù„ÙØ±Ù‚  â”‚ ØªÙƒÙ„ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø© â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ      â”‚ â”‚
â”‚  â”‚ Ø¹Ø¯Ø§Ø¯ IoT   â”‚ 50     â”‚ 48     â”‚ -2     â”‚ 3,000        â”‚ 144,000       â”‚ â”‚
â”‚  â”‚ Ø·Ø¨Ù„ÙˆÙ† ÙÙŠØ¨Ø± â”‚ 3      â”‚ 3      â”‚ 0      â”‚ 2,500        â”‚ 7,500         â”‚ â”‚
â”‚  â”‚ Ø®ØªÙ… Ø£Ù…Ø§Ù†   â”‚ 50     â”‚ 48     â”‚ -2     â”‚ 50           â”‚ 2,400         â”‚ â”‚
â”‚  â”‚ ÙƒØ§Ø¨Ù„ 10Ù…   â”‚ 100    â”‚ 85     â”‚ -15    â”‚ 25           â”‚ 2,125         â”‚ â”‚
â”‚  â”‚ Ø£Ø¯ÙˆØ§Øª ØªØ±ÙƒÙŠØ¨â”‚ 5      â”‚ 5      â”‚ 0      â”‚ 45           â”‚ 225           â”‚ â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ   â”‚        â”‚        â”‚        â”‚              â”‚ 156,250       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø­Ø³Ø¨ Ø­Ø²Ù… Ø§Ù„Ø¹Ù…Ù„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Ø­Ø²Ù…Ø© Ø§Ù„Ø¹Ù…Ù„                    â”‚ Ø§Ù„Ù…Ø®Ø·Ø·   â”‚ Ø§Ù„ÙØ¹Ù„ÙŠ   â”‚ Ø§Ù„Ù†Ø³Ø¨Ø©         â”‚ â”‚
â”‚  â”‚ Ø­Ø²Ù…Ø© 1: ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø·Ø¨Ø§Ø¨Ù„ÙŠÙ†       â”‚ 45,000   â”‚ 43,500   â”‚ 97%            â”‚ â”‚
â”‚  â”‚ Ø­Ø²Ù…Ø© 2: Ù†Ù‚Ù„ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†         â”‚ 80,000   â”‚ 72,000   â”‚ 90%            â”‚ â”‚
â”‚  â”‚ Ø­Ø²Ù…Ø© 3: Ø§Ù„Ù…Ø³Ø­ ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚        â”‚ 0        â”‚ 0        â”‚ -              â”‚ â”‚
â”‚  â”‚ Ø­Ø²Ù…Ø© 4: ØªØ±ÙƒÙŠØ¨ Ø¥Ø¶Ø§ÙÙŠ           â”‚ 50,000   â”‚ 40,750   â”‚ 82%            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  [ØªØµØ¯ÙŠØ± Excel] [ØªØµØ¯ÙŠØ± PDF]                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10.5 APIs Ø±Ø¨Ø· Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/projects/:id/materials` | Ù…ÙˆØ§Ø¯ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¹ÙŠÙ† |
| GET | `/api/v1/projects/:id/materials/planned` | Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø© |
| GET | `/api/v1/projects/:id/materials/consumed` | Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ© |
| GET | `/api/v1/projects/:id/materials/variance` | ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ |
| POST | `/api/v1/inventory-requests/for-project` | Ø·Ù„Ø¨ ØµØ±Ù Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ |
| GET | `/api/v1/work-packages/:id/materials` | Ù…ÙˆØ§Ø¯ Ø­Ø²Ù…Ø© Ø¹Ù…Ù„ |
| GET | `/api/v1/projects/:id/cost-report` | ØªÙ‚Ø±ÙŠØ± ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø¯ |


---

## 11. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© (Three-Way Matching)

> **Ø§Ù„Ù…ØµØ¯Ø±:** Ù…Ù„Ù 20 - Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ù„Ù… ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª

### 11.1 Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©

| Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ù„Ù… | Ø§Ù„ÙˆØµÙ |
|-----------|-------|
| **Ù…Ø·Ø§Ø¨Ù‚Ø© ÙŠØ¯ÙˆÙŠØ© Ù…Ø¹Ù‚Ø¯Ø©** | Ù…Ù‚Ø§Ø±Ù†Ø© ÙŠØ¯ÙˆÙŠØ© Ø¨ÙŠÙ† Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø© |
| **Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­ØªÙ…Ù„Ø©** | Ø¯ÙØ¹ Ù…Ø¨Ø§Ù„Øº Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ù…ÙƒØ±Ø±Ø© |
| **Ù„Ø§ Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚** | ØµØ¹ÙˆØ¨Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª |
| **ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©** | Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„ ÙˆØ§Ø¶Ø­ Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª |

---

### 11.2 Ø§Ù„Ø­Ù„: Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡    â”‚     â”‚  Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… â”‚     â”‚  ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯  â”‚
â”‚ Purchase Order  â”‚â”€â”€â”€â”€â–¶â”‚      GRN        â”‚â”€â”€â”€â”€â–¶â”‚ Supplier Invoiceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©    â”‚
                    â”‚  Three-Way Matching    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                  â–¼                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Ù…Ø·Ø§Ø¨Ù‚Ø©   â”‚      â”‚ ÙØ±Ù‚ Ø¬Ø²Ø¦ÙŠ â”‚      â”‚ ÙØ±Ù‚ ÙƒØ¨ÙŠØ± â”‚
        â”‚ ÙƒØ§Ù…Ù„Ø© âœ… â”‚      â”‚ âš ï¸ ØªØ­Ø°ÙŠØ± â”‚      â”‚ ğŸ”´ Ø±ÙØ¶   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

### 11.3 Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

#### 11.3.1 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª (purchase_matches)

\`\`\`sql
CREATE TABLE purchase_matches (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©
    purchase_order_id UUID REFERENCES purchase_orders(id) NOT NULL,
    grn_id UUID REFERENCES goods_received_notes(id) NOT NULL,
    supplier_invoice_id UUID REFERENCES supplier_invoices(id),
    
    -- Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    match_status VARCHAR(20) DEFAULT 'pending',
    -- 'pending': Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    -- 'matched': Ù…Ø·Ø§Ø¨Ù‚Ø© ÙƒØ§Ù…Ù„Ø©
    -- 'partial_match': Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¬Ø²Ø¦ÙŠØ© (ÙØ±ÙˆÙ‚Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©)
    -- 'mismatch': Ø¹Ø¯Ù… Ù…Ø·Ø§Ø¨Ù‚Ø© (ÙØ±ÙˆÙ‚Ø§Øª ÙƒØ¨ÙŠØ±Ø©)
    -- 'approved': Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡ (Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)
    -- 'rejected': Ù…Ø±ÙÙˆØ¶
    
    -- Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
    quantity_variance DECIMAL(15,3) DEFAULT 0,
    price_variance DECIMAL(15,2) DEFAULT 0,
    total_variance DECIMAL(15,2) DEFAULT 0,
    variance_percent DECIMAL(5,2) DEFAULT 0,
    
    -- Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„
    tolerance_percent DECIMAL(5,2) DEFAULT 5.00,
    
    -- Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    approval_notes TEXT,
    
    matched_by UUID REFERENCES users(id),
    matched_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
\`\`\`

#### 11.3.2 Ø¬Ø¯ÙˆÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© (purchase_match_items)

\`\`\`sql
CREATE TABLE purchase_match_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    match_id UUID REFERENCES purchase_matches(id) NOT NULL,
    
    item_id UUID REFERENCES items(id) NOT NULL,
    item_code VARCHAR(50),
    item_name VARCHAR(200),
    
    -- Ù…Ù† Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
    po_quantity DECIMAL(15,3),
    po_unit_price DECIMAL(15,2),
    po_total DECIMAL(15,2),
    
    -- Ù…Ù† Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    grn_quantity DECIMAL(15,3),
    grn_condition VARCHAR(20),
    
    -- Ù…Ù† ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯
    invoice_quantity DECIMAL(15,3),
    invoice_unit_price DECIMAL(15,2),
    invoice_total DECIMAL(15,2),
    
    -- Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
    quantity_variance DECIMAL(15,3),
    price_variance DECIMAL(15,2),
    total_variance DECIMAL(15,2),
    
    item_status VARCHAR(20) DEFAULT 'pending',
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);
\`\`\`

#### 11.3.3 Ø¬Ø¯ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø§Ù…Ø­ (matching_tolerances)

\`\`\`sql
CREATE TABLE matching_tolerances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    supplier_id UUID REFERENCES suppliers(id),
    item_category_id UUID REFERENCES item_categories(id),
    
    quantity_tolerance_percent DECIMAL(5,2) DEFAULT 5.00,
    price_tolerance_percent DECIMAL(5,2) DEFAULT 2.00,
    total_tolerance_amount DECIMAL(15,2) DEFAULT 100.00,
    
    action_on_exceed VARCHAR(20) DEFAULT 'require_approval',
    
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);
\`\`\`

---

### 11.4 ğŸ’» Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© - Three-Way Matching                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: PO-2024-0156    â”‚ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: GRN-2024-0089                  â”‚ â”‚
â”‚ â”‚ Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª       â”‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: INV-SUP-2024-0234              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ø§Ù„ØµÙ†Ù          â”‚ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ â”‚ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… â”‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø© â”‚ Ø§Ù„ÙØ±Ù‚   â”‚ Ø§Ù„Ø­Ø§Ù„Ø©   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ÙƒØ§Ø¨Ù„ 16mm     â”‚ 1000 Ù…     â”‚ 1000 Ù…   â”‚ 1000 Ù…   â”‚ 0       â”‚ âœ… Ù…Ø·Ø§Ø¨Ù‚ â”‚ â”‚
â”‚ â”‚ ÙƒØ§Ø¨Ù„ 25mm     â”‚ 500 Ù…      â”‚ 480 Ù…    â”‚ 480 Ù…    â”‚ -20 Ù…   â”‚ âš ï¸ ÙØ±Ù‚  â”‚ â”‚
â”‚ â”‚ Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø§Ø¯ÙŠ    â”‚ 50 ÙˆØ­Ø¯Ø©    â”‚ 50 ÙˆØ­Ø¯Ø©  â”‚ 52 ÙˆØ­Ø¯Ø©  â”‚ +2      â”‚ âš ï¸ ÙØ±Ù‚  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:                                                         â”‚ â”‚
â”‚ â”‚ â”œâ”€ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: 125,000 Ø±ÙŠØ§Ù„                                     â”‚ â”‚
â”‚ â”‚ â”œâ”€ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: 124,200 Ø±ÙŠØ§Ù„                                       â”‚ â”‚
â”‚ â”‚ â”œâ”€ Ø§Ù„ÙØ±Ù‚: -800 Ø±ÙŠØ§Ù„ (0.64%)                                            â”‚ â”‚
â”‚ â”‚ â””â”€ Ø§Ù„Ø­Ø§Ù„Ø©: âš ï¸ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¬Ø²Ø¦ÙŠØ© (Ø¶Ù…Ù† Ø­Ø¯ Ø§Ù„ØªØ³Ø§Ù…Ø­ 5%)                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚ [Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©] [Ø·Ù„Ø¨ ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯] [Ø±ÙØ¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©]              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

### 11.5 APIs Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| POST | \`/api/v1/matching/three-way\` | ØªÙ†ÙÙŠØ° Ù…Ø·Ø§Ø¨Ù‚Ø© Ø«Ù„Ø§Ø«ÙŠØ© |
| GET | \`/api/v1/matching\` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª |
| GET | \`/api/v1/matching/:id\` | ØªÙØ§ØµÙŠÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© |
| GET | \`/api/v1/matching/:id/items\` | Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© |
| POST | \`/api/v1/matching/:id/approve\` | Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© |
| POST | \`/api/v1/matching/:id/reject\` | Ø±ÙØ¶ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© |
| GET | \`/api/v1/matching/pending\` | Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© |
| GET | \`/api/v1/matching/mismatches\` | Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø© |
| GET | \`/api/v1/tolerances\` | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø§Ù…Ø­ |

---

### 11.6 Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ

#### Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:
\`\`\`
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (150)
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (210)
    
Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ PO-XXXXØŒ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… GRN-XXXXØŒ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ INV-XXXX
\`\`\`

#### Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ÙØ±Ù‚ Ù…Ù‚Ø¨ÙˆÙ„:
\`\`\`
-- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø­Ø·Ø© (Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ø£Ù‚Ù„)
Ù…Ù† Ø­Ù€/ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (150) - Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©
Ù…Ù† Ø­Ù€/ ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª (560) - Ø¨Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ±Ù‚
    Ø¥Ù„Ù‰ Ø­Ù€/ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (210) - Ø¨Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
\`\`\`

---

## Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (10)

> **Ù„Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¹Ù† Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ Ø±Ø§Ø¬Ø¹:** [Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (10)](./10_Ù†Ø¸Ø§Ù…_Ø§Ù„ØªØ®Ø·ÙŠØ·_ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.md)

### Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© ÙÙŠ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ±Ù

| Ø§Ù„Ø­Ù‚Ù„ | Ø§Ù„ÙˆØµÙ |
|-------|-------|
| `project_id` | Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ |
| `work_package_id` | Ø­Ø²Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø© |

---

# 9. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…Ø§Ø¯ÙŠØ© (Material Custody System)

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ØµØ±ÙˆÙØ© ÙƒØ¹Ù‡Ø¯Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„ÙØ±Ù‚ØŒ Ù…Ø¹ ØªØªØ¨Ø¹ ÙƒØ§Ù…Ù„ ÙˆØªØµÙÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©

## 9.1 Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…Ø§Ø¯ÙŠØ©

| Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ù…Ø¯Ø© | Ø§Ù„ØªØµÙÙŠØ© |
|-------|-------|-------|---------|
| **Ø¹Ù‡Ø¯Ø© Ù…Ø´Ø±ÙˆØ¹** | Ù…ÙˆØ§Ø¯ Ù„ØªÙ†ÙÙŠØ° Ø­Ø²Ù…Ø© Ø¹Ù…Ù„ | Ù…Ø¤Ù‚ØªØ© | Ø¹Ù†Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ø²Ù…Ø© |
| **Ø¹Ù‡Ø¯Ø© ØµÙŠØ§Ù†Ø©** | Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù„Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© | Ù…Ø¤Ù‚ØªØ© | Ø¹Ù†Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ |
| **Ø¹Ù‡Ø¯Ø© Ø·ÙˆØ§Ø±Ø¦** | Ù…Ø®Ø²ÙˆÙ† Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© | Ù…ØªØ¬Ø¯Ø¯Ø© | Ø¯ÙˆØ±ÙŠØ© (Ø´Ù‡Ø±ÙŠØ©) |
| **Ø¹Ù‡Ø¯Ø© Ø¯Ø§Ø¦Ù…Ø©** | Ø£ØµÙˆÙ„ Ø¨Ø¹Ù‡Ø¯Ø© Ø§Ù„Ù…ÙˆØ¸Ù | Ø¯Ø§Ø¦Ù…Ø© | Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ùˆ Ø§Ù„Ø¥ØªÙ„Ø§Ù |

## 9.2 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…Ø§Ø¯ÙŠØ© (material_custodies)

```sql
CREATE TABLE material_custodies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    business_id UUID REFERENCES businesses(id) NOT NULL,
    station_id UUID REFERENCES stations(id),
    
    -- Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©
    custody_number VARCHAR(20) UNIQUE NOT NULL,
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‡Ø¯Ø©
    custody_type VARCHAR(30) NOT NULL,
    -- 'project': Ø¹Ù‡Ø¯Ø© Ù…Ø´Ø±ÙˆØ¹
    -- 'maintenance': Ø¹Ù‡Ø¯Ø© ØµÙŠØ§Ù†Ø©
    -- 'emergency': Ø¹Ù‡Ø¯Ø© Ø·ÙˆØ§Ø±Ø¦
    -- 'permanent': Ø¹Ù‡Ø¯Ø© Ø¯Ø§Ø¦Ù…Ø©
    
    -- Ø§Ù„Ù…Ø³ØªÙ„Ù…
    custodian_type VARCHAR(20) NOT NULL, -- 'employee', 'team', 'contractor'
    custodian_id UUID NOT NULL,
    custodian_name VARCHAR(200),
    
    -- Ø§Ù„Ù…Ø±Ø¬Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    reference_type VARCHAR(30), -- 'work_order', 'work_package', 'project', 'none'
    reference_id UUID,
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    issue_date DATE NOT NULL DEFAULT CURRENT_DATE,
    expected_return_date DATE,
    actual_return_date DATE,
    
    -- Ø§Ù„Ù‚ÙŠÙ…
    total_items INTEGER DEFAULT 0,
    total_value DECIMAL(15, 2) DEFAULT 0,
    returned_value DECIMAL(15, 2) DEFAULT 0,
    consumed_value DECIMAL(15, 2) DEFAULT 0,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(20) DEFAULT 'active',
    -- 'draft': Ù…Ø³ÙˆØ¯Ø©
    -- 'active': Ù†Ø´Ø·Ø©
    -- 'partial_return': Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ø²Ø¦ÙŠ
    -- 'pending_settlement': Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØµÙÙŠØ©
    -- 'settled': Ù…ÙØµÙØ§Ø©
    -- 'cancelled': Ù…Ù„ØºØ§Ø©
    
    -- Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    -- Ø§Ù„ØªØµÙÙŠØ©
    settled_by UUID REFERENCES users(id),
    settled_at TIMESTAMP,
    settlement_notes TEXT,
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ÙÙ‡Ø§Ø±Ø³
CREATE INDEX idx_material_custodies_custodian ON material_custodies(custodian_type, custodian_id);
CREATE INDEX idx_material_custodies_status ON material_custodies(status);
CREATE INDEX idx_material_custodies_type ON material_custodies(custody_type);
CREATE INDEX idx_material_custodies_reference ON material_custodies(reference_type, reference_id);
```

## 9.3 Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‡Ø¯Ø© (custody_items)

```sql
CREATE TABLE custody_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    custody_id UUID REFERENCES material_custodies(id) NOT NULL,
    
    -- Ø§Ù„ØµÙ†Ù
    item_id UUID REFERENCES items(id) NOT NULL,
    item_code VARCHAR(50),
    item_name VARCHAR(200),
    unit VARCHAR(20),
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ§Øª
    issued_quantity DECIMAL(15, 3) NOT NULL,
    returned_quantity DECIMAL(15, 3) DEFAULT 0,
    consumed_quantity DECIMAL(15, 3) DEFAULT 0,
    damaged_quantity DECIMAL(15, 3) DEFAULT 0,
    remaining_quantity DECIMAL(15, 3),
    
    -- Ø§Ù„Ù‚ÙŠÙ…
    unit_cost DECIMAL(15, 2),
    total_cost DECIMAL(15, 2),
    
    -- Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù†Ø¯
    status VARCHAR(20) DEFAULT 'issued',
    -- 'issued': Ù…ØµØ±ÙˆÙ
    -- 'partial_return': Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ø²Ø¦ÙŠ
    -- 'fully_returned': Ù…Ø±ØªØ¬Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    -- 'consumed': Ù…Ø³ØªÙ‡Ù„Ùƒ
    -- 'mixed': Ù…Ø®ØªÙ„Ø·
    
    -- Ø±Ø¨Ø· Ø¨Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù
    stock_issue_id UUID,
    stock_issue_item_id UUID,
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Trigger Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
CREATE OR REPLACE FUNCTION calculate_remaining_quantity()
RETURNS TRIGGER AS $$
BEGIN
    NEW.remaining_quantity := NEW.issued_quantity - COALESCE(NEW.returned_quantity, 0) 
                             - COALESCE(NEW.consumed_quantity, 0) - COALESCE(NEW.damaged_quantity, 0);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_calculate_remaining
BEFORE INSERT OR UPDATE ON custody_items
FOR EACH ROW
EXECUTE FUNCTION calculate_remaining_quantity();
```

## 9.4 Ø¬Ø¯ÙˆÙ„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø© (custody_transactions)

```sql
CREATE TABLE custody_transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    custody_id UUID REFERENCES material_custodies(id) NOT NULL,
    custody_item_id UUID REFERENCES custody_items(id),
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©
    transaction_type VARCHAR(20) NOT NULL,
    -- 'issue': ØµØ±Ù
    -- 'return': Ø¥Ø±Ø¬Ø§Ø¹
    -- 'consume': Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
    -- 'damage': ØªÙ„Ù
    -- 'transfer': ØªØ­ÙˆÙŠÙ„ Ù„Ø¹Ù‡Ø¯Ø© Ø£Ø®Ø±Ù‰
    -- 'adjustment': ØªØ³ÙˆÙŠØ©
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ©
    quantity DECIMAL(15, 3) NOT NULL,
    unit_cost DECIMAL(15, 2),
    total_cost DECIMAL(15, 2),
    
    -- Ø§Ù„ØªÙØ§ØµÙŠÙ„
    transaction_date TIMESTAMP DEFAULT NOW(),
    reference_type VARCHAR(30),
    reference_id UUID,
    
    -- Ù„Ù„Ø¥Ø±Ø¬Ø§Ø¹
    return_warehouse_id UUID,
    return_location VARCHAR(100),
    
    -- Ù„Ù„ØªØ­ÙˆÙŠÙ„
    transfer_to_custody_id UUID,
    
    notes TEXT,
    
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 9.5 Ø´Ø§Ø´Ø© ØµØ±Ù Ø§Ù„Ø¹Ù‡Ø¯Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ ØµØ±Ù Ø¹Ù‡Ø¯Ø© Ù…Ø§Ø¯ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù‡Ø¯Ø© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©: [CUS-2025-0001] (ØªÙ„Ù‚Ø§Ø¦ÙŠ)                                      â”‚  â”‚
â”‚  â”‚ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‡Ø¯Ø©: [Ø¹Ù‡Ø¯Ø© Ù…Ø´Ø±ÙˆØ¹        â–¼]                                         â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ù…Ø³ØªÙ„Ù…: [â—‹ Ù…ÙˆØ¸Ù  â— ÙØ±ÙŠÙ‚  â—‹ Ù…Ù‚Ø§ÙˆÙ„]                                       â”‚  â”‚
â”‚  â”‚ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…: [ÙØ±ÙŠÙ‚ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠ    â–¼]                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€ Ø§Ù„Ù…Ø±Ø¬Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±Ø¬Ø¹: [Ø­Ø²Ù…Ø© Ø¹Ù…Ù„          â–¼]                                         â”‚  â”‚
â”‚  â”‚ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹: [WP-2025-0045 - ØªÙ…Ø¯ÙŠØ¯ Ø£Ø³Ù„Ø§Ùƒ ÙÙŠØ¨Ø±    â–¼]                        â”‚  â”‚
â”‚  â”‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: [25/12/2025]                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€ Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‡Ø¯Ø© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù]                                                             â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ # â”‚ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù â”‚ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù          â”‚ Ø§Ù„ÙƒÙ…ÙŠØ© â”‚ Ø§Ù„ÙˆØ­Ø¯Ø© â”‚ Ø§Ù„ØªÙƒÙ„ÙØ©   â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ â”‚  â”‚
â”‚  â”‚ 1 â”‚ CAB-001   â”‚ Ø³Ù„Ùƒ ÙÙŠØ¨Ø± Ø£Ø­Ø§Ø¯ÙŠ     â”‚ 500   â”‚ Ù…ØªØ±   â”‚ 100     â”‚ 50,000  â”‚  â”‚
â”‚  â”‚ 2 â”‚ CON-005   â”‚ Ù…ÙˆØµÙ„Ø§Øª ÙÙŠØ¨Ø±        â”‚ 50    â”‚ Ù‚Ø·Ø¹Ø©  â”‚ 50      â”‚ 2,500   â”‚  â”‚
â”‚  â”‚ 3 â”‚ TOL-012   â”‚ Ø£Ø¯ÙˆØ§Øª Ù„Ø­Ø§Ù… ÙÙŠØ¨Ø±    â”‚ 2     â”‚ Ø·Ù‚Ù…   â”‚ 500     â”‚ 1,000   â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 53,500 Ø±ÙŠØ§Ù„                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  [Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©]  [ØµØ±Ù Ø§Ù„Ø¹Ù‡Ø¯Ø©]  [Ø¥Ù„ØºØ§Ø¡]                                           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9.6 Ø´Ø§Ø´Ø© ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù‡Ø¯Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù‡Ø¯Ø© - CUS-2025-0001                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ù…Ø³ØªÙ„Ù…: ÙØ±ÙŠÙ‚ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠ    â”‚    Ø§Ù„Ù…Ø±Ø¬Ø¹: WP-2025-0045                     â”‚
â”‚  ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ±Ù: 15/12/2025         â”‚    Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: 53,500 Ø±ÙŠØ§Ù„            â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€ ØªØµÙÙŠØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ ğŸ“¦ Ø³Ù„Ùƒ ÙÙŠØ¨Ø± Ø£Ø­Ø§Ø¯ÙŠ (CAB-001)                                               â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙˆÙØ©: 500 Ù…ØªØ±                                              â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©: [480    ] Ù…ØªØ±                                       â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©: [20     ] Ù…ØªØ±                                        â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ØªØ§Ù„ÙØ©:  [0      ] Ù…ØªØ±                                        â”‚  â”‚
â”‚  â”‚ â””â”€ Ù…ØµÙŠØ± Ø§Ù„Ù…Ø±ØªØ¬Ø¹: [â—‹ Ø¥Ø±Ø¬Ø§Ø¹ Ù„Ù„Ù…Ø®Ø²Ù†  â—‹ ØªØ­ÙˆÙŠÙ„ Ù„Ø¹Ù‡Ø¯Ø© Ø£Ø®Ø±Ù‰  â—‹ Ø¥Ø¨Ù‚Ø§Ø¡]           â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ ğŸ“¦ Ù…ÙˆØµÙ„Ø§Øª ÙÙŠØ¨Ø± (CON-005)                                                  â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙˆÙØ©: 50 Ù‚Ø·Ø¹Ø©                                              â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©: [48     ] Ù‚Ø·Ø¹Ø©                                      â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©: [0      ] Ù‚Ø·Ø¹Ø©                                       â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ØªØ§Ù„ÙØ©:  [2      ] Ù‚Ø·Ø¹Ø© (Ø³Ø¨Ø¨ Ø§Ù„ØªÙ„Ù: [ÙƒØ³Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ±ÙƒÙŠØ¨])      â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ ğŸ“¦ Ø£Ø¯ÙˆØ§Øª Ù„Ø­Ø§Ù… ÙÙŠØ¨Ø± (TOL-012)                                              â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙˆÙØ©: 2 Ø·Ù‚Ù…                                                â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©: [0      ] Ø·Ù‚Ù…                                       â”‚  â”‚
â”‚  â”‚ â”œâ”€ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©: [2      ] Ø·Ù‚Ù…                                        â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€ Ù…Ù„Ø®Øµ Ø§Ù„ØªØµÙÙŠØ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ©: 53,500 Ø±ÙŠØ§Ù„                                              â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©: 50,400 Ø±ÙŠØ§Ù„                                             â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©: 3,000 Ø±ÙŠØ§Ù„                                               â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ§Ù„ÙØ©: 100 Ø±ÙŠØ§Ù„                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  [ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØµÙÙŠØ©]  [Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©]  [Ø¥Ù„ØºØ§Ø¡]                                        â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9.7 Trigger: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªØµÙÙŠØ©

```sql
CREATE OR REPLACE FUNCTION process_custody_settlement()
RETURNS TRIGGER AS $$
BEGIN
    -- ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø­Ø§Ù„Ø© "settled"
    IF NEW.status = 'settled' AND OLD.status = 'pending_settlement' THEN
        
        -- Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø§Ø³ØªÙ„Ø§Ù… Ù„Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª
        IF NEW.returned_value > 0 THEN
            INSERT INTO stock_receipts (
                business_id,
                receipt_number,
                receipt_type,
                reference_type,
                reference_id,
                total_amount,
                status,
                notes,
                created_at
            ) VALUES (
                NEW.business_id,
                generate_receipt_number(),
                'custody_return',
                'custody',
                NEW.id,
                NEW.returned_value,
                'completed',
                'Ø¥Ø±Ø¬Ø§Ø¹ Ø¹Ù‡Ø¯Ø© Ø±Ù‚Ù…: ' || NEW.custody_number,
                NOW()
            );
        END IF;
        
        -- ØªØ­Ø¯ÙŠØ« Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©
        UPDATE item_stocks ist
        SET 
            quantity_available = quantity_available + ci.returned_quantity,
            updated_at = NOW()
        FROM custody_items ci
        WHERE ci.custody_id = NEW.id
          AND ci.returned_quantity > 0
          AND ist.item_id = ci.item_id;
        
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_process_custody_settlement
AFTER UPDATE ON material_custodies
FOR EACH ROW
EXECUTE FUNCTION process_custody_settlement();
```

## 9.8 ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…ÙØªÙˆØ­Ø©

```sql
CREATE VIEW v_open_custodies AS
SELECT 
    mc.id,
    mc.custody_number,
    mc.custody_type,
    mc.custodian_name,
    mc.issue_date,
    mc.expected_return_date,
    mc.total_value,
    mc.total_value - mc.returned_value - mc.consumed_value AS outstanding_value,
    CASE 
        WHEN mc.expected_return_date < CURRENT_DATE THEN 'overdue'
        WHEN mc.expected_return_date <= CURRENT_DATE + INTERVAL '7 days' THEN 'due_soon'
        ELSE 'normal'
    END AS urgency,
    mc.status
FROM material_custodies mc
WHERE mc.status IN ('active', 'partial_return', 'pending_settlement')
ORDER BY mc.expected_return_date;
```

## 9.9 APIs Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…Ø§Ø¯ÙŠØ©

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/custodies` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù‡Ø¯ |
| POST | `/api/v1/custodies` | Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‡Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© |
| GET | `/api/v1/custodies/:id` | ØªÙØ§ØµÙŠÙ„ Ø¹Ù‡Ø¯Ø© |
| PUT | `/api/v1/custodies/:id` | ØªØ­Ø¯ÙŠØ« Ø¹Ù‡Ø¯Ø© |
| POST | `/api/v1/custodies/:id/issue` | ØµØ±Ù Ø§Ù„Ø¹Ù‡Ø¯Ø© |
| POST | `/api/v1/custodies/:id/settle` | ØªØµÙÙŠØ© Ø§Ù„Ø¹Ù‡Ø¯Ø© |
| GET | `/api/v1/custodies/:id/items` | Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‡Ø¯Ø© |
| POST | `/api/v1/custodies/:id/items/:itemId/return` | Ø¥Ø±Ø¬Ø§Ø¹ Ø¨Ù†Ø¯ |
| GET | `/api/v1/custodies/open` | Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…ÙØªÙˆØ­Ø© |
| GET | `/api/v1/custodies/overdue` | Ø§Ù„Ø¹Ù‡Ø¯ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© |
| GET | `/api/v1/employees/:id/custodies` | Ø¹Ù‡Ø¯ Ù…ÙˆØ¸Ù |
| GET | `/api/v1/teams/:id/custodies` | Ø¹Ù‡Ø¯ ÙØ±ÙŠÙ‚ |

---

# 16. Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© (Opening Inventory Import)

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…

## 16.1 Ø¬Ø¯ÙˆÙ„ Ø¯ÙØ¹Ø§Øª Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

```sql
CREATE TABLE inventory_import_batches (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø©
    batch_number VARCHAR(20) UNIQUE NOT NULL,
    warehouse_id UUID REFERENCES warehouses(id),
    description TEXT,
    
    -- Ø§Ù„Ù…Ù„Ù
    file_name VARCHAR(255),
    file_path VARCHAR(500),
    
    -- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    total_rows INTEGER DEFAULT 0,
    valid_rows INTEGER DEFAULT 0,
    error_rows INTEGER DEFAULT 0,
    imported_rows INTEGER DEFAULT 0,
    total_value DECIMAL(15, 2) DEFAULT 0,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(20) DEFAULT 'pending',
    
    -- Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    validation_errors JSONB,
    
    -- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    uploaded_by UUID REFERENCES users(id),
    approved_by UUID REFERENCES users(id),
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    uploaded_at TIMESTAMP DEFAULT NOW(),
    validated_at TIMESTAMP,
    imported_at TIMESTAMP,
    
    -- Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    opening_entry_id UUID
);

-- ØªÙØ§ØµÙŠÙ„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
CREATE TABLE inventory_import_details (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    batch_id UUID REFERENCES inventory_import_batches(id) ON DELETE CASCADE,
    
    row_number INTEGER NOT NULL,
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù
    item_code VARCHAR(50),
    item_name VARCHAR(200),
    unit VARCHAR(20),
    quantity DECIMAL(12, 3),
    unit_cost DECIMAL(12, 2),
    total_cost DECIMAL(15, 2),
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹
    location_code VARCHAR(50),
    
    -- Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù‚Ù‚
    is_valid BOOLEAN DEFAULT FALSE,
    validation_errors JSONB,
    
    -- Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚/Ø§Ù„Ù…Ù†Ø´Ø£
    item_id UUID REFERENCES inventory_items(id),
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 16.2 Ø´Ø§Ø´Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹: [Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ø§Ù„Ø­Ø¯ÙŠØ¯Ø© â–¼]                                      â”‚
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel]                                                   â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:                                                         â”‚  â”‚
â”‚  â”‚ â€¢ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (Ù…Ø·Ù„ÙˆØ¨)                                                      â”‚  â”‚
â”‚  â”‚ â€¢ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù (Ù…Ø·Ù„ÙˆØ¨)                                                      â”‚  â”‚
â”‚  â”‚ â€¢ Ø§Ù„ÙˆØ­Ø¯Ø© (Ù…Ø·Ù„ÙˆØ¨)                                                         â”‚  â”‚
â”‚  â”‚ â€¢ Ø§Ù„ÙƒÙ…ÙŠØ© (Ù…Ø·Ù„ÙˆØ¨)                                                         â”‚  â”‚
â”‚  â”‚ â€¢ ØªÙƒÙ„ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø© (Ù…Ø·Ù„ÙˆØ¨)                                                   â”‚  â”‚
â”‚  â”‚ â€¢ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel]                                                    â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ Ø§Ù„Ù…Ù„Ù: Ù…Ø®Ø²ÙˆÙ†_Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©_2025.xlsx                                           â”‚  â”‚
â”‚  â”‚ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: 450                                                         â”‚  â”‚
â”‚  â”‚ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©: 2,500,000 Ø±ÙŠØ§Ù„                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ø®Ø·ÙˆØ© 3: Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù‚Ù‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ… Ø£ØµÙ†Ø§Ù Ù…ÙˆØ¬ÙˆØ¯Ø©: 380 (Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯)                                 â”‚  â”‚
â”‚  â”‚ â• Ø£ØµÙ†Ø§Ù Ø¬Ø¯ÙŠØ¯Ø©: 65 (Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§)                                        â”‚  â”‚
â”‚  â”‚ âŒ Ø£ØµÙ†Ø§Ù Ø¨Ù‡Ø§ Ø£Ø®Ø·Ø§Ø¡: 5                                                    â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ [ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚Ù‚]                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â˜‘ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹                                        â”‚  â”‚
â”‚  â”‚ â˜‘ Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ                                           â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚ [âœ… Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯]                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 16.3 Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†

```sql
-- Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
-- Ù…Ø¯ÙŠÙ†: 1400 - Ø§Ù„Ù…Ø®Ø²ÙˆÙ† .............. 2,500,000
--   Ø¯Ø§Ø¦Ù†: 3001 - Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ / Ø£Ø±ØµØ¯Ø© Ø§ÙØªØªØ§Ø­ÙŠØ© .. 2,500,000

CREATE OR REPLACE FUNCTION create_inventory_opening_entry(p_batch_id UUID)
RETURNS UUID AS $$
DECLARE
    v_entry_id UUID;
    v_total DECIMAL(15, 2);
    v_warehouse_name VARCHAR(100);
BEGIN
    -- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    SELECT SUM(total_cost), w.name
    INTO v_total, v_warehouse_name
    FROM inventory_import_details iid
    JOIN inventory_import_batches iib ON iid.batch_id = iib.id
    JOIN warehouses w ON iib.warehouse_id = w.id
    WHERE iid.batch_id = p_batch_id AND iid.is_valid = TRUE
    GROUP BY w.name;
    
    -- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ
    INSERT INTO opening_balance_entries (
        entry_number,
        entry_date,
        description,
        entry_type,
        source_batch_id,
        total_debit,
        total_credit,
        status
    ) VALUES (
        'OB-INV-' || TO_CHAR(NOW(), 'YYYY') || '-' || LPAD(NEXTVAL('opening_entry_seq')::TEXT, 3, '0'),
        CURRENT_DATE,
        'Ù‚ÙŠØ¯ Ø§ÙØªØªØ§Ø­ÙŠ - Ù…Ø®Ø²ÙˆÙ† ' || v_warehouse_name,
        'inventory',
        p_batch_id,
        v_total,
        v_total,
        'draft'
    ) RETURNING id INTO v_entry_id;
    
    -- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚ÙŠØ¯
    -- Ù…Ø¯ÙŠÙ†: Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    INSERT INTO opening_balance_details (entry_id, account_id, debit_amount, description)
    VALUES (v_entry_id, get_account_id('1400'), v_total, 'Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ');
    
    -- Ø¯Ø§Ø¦Ù†: Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„
    INSERT INTO opening_balance_details (entry_id, account_id, credit_amount, description)
    VALUES (v_entry_id, get_account_id('3001'), v_total, 'Ø£Ø±ØµØ¯Ø© Ø§ÙØªØªØ§Ø­ÙŠØ©');
    
    -- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙØ¹Ø©
    UPDATE inventory_import_batches
    SET opening_entry_id = v_entry_id
    WHERE id = p_batch_id;
    
    RETURN v_entry_id;
END;
$$ LANGUAGE plpgsql;
```

## 16.4 APIs Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/inventory-import/template` | ØªÙ†Ø²ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel |
| POST | `/api/v1/inventory-import/upload` | Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ |
| POST | `/api/v1/inventory-import/:batchId/validate` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª |
| GET | `/api/v1/inventory-import/:batchId/report` | ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­Ù‚Ù‚ |
| POST | `/api/v1/inventory-import/:batchId/import` | Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ |
| GET | `/api/v1/inventory-import/:batchId/status` | Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ |

---

## 19. Ø£ØµÙ†Ø§Ù Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø²ÙˆÙ† Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© (ÙƒÙŠØ§Ø¨Ù„ØŒ Ù‚Ø·Ø¹ Ø´Ø¯ØŒ Ù‚Ø·Ø¹ ØªØ¹Ù„ÙŠÙ‚ØŒ Ø¹ÙˆØ§Ø²Ù„) ÙˆØ±Ø¨Ø· Ø§Ù„ØµØ±Ù Ø¨Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø´Ø¨ÙƒØ©

### 19.1 ÙØ¦Ø§Øª Ø£ØµÙ†Ø§Ù Ø§Ù„Ø´Ø¨ÙƒØ©

```
Ø£ØµÙ†Ø§Ù Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©:
â”‚
â”œâ”€â”€ Ø§Ù„ÙƒÙŠØ§Ø¨Ù„ (Cables)
â”‚   â”œâ”€â”€ ABC Cable 120mmÂ²
â”‚   â”œâ”€â”€ ABC Cable 70mmÂ²
â”‚   â”œâ”€â”€ ABC Cable 50mmÂ²
â”‚   â”œâ”€â”€ ABC Cable 35mmÂ²
â”‚   â””â”€â”€ ÙƒÙŠØ§Ø¨Ù„ Ø£Ø±Ø¶ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø©
â”‚
â”œâ”€â”€ Ù‚Ø·Ø¹ Ø§Ù„Ø´Ø¯ (Tension Clamps)
â”‚   â”œâ”€â”€ Ù‚Ø·Ø¹Ø© Ø´Ø¯ 120mmÂ²
â”‚   â”œâ”€â”€ Ù‚Ø·Ø¹Ø© Ø´Ø¯ 70mmÂ²
â”‚   â””â”€â”€ Ù‚Ø·Ø¹Ø© Ø´Ø¯ 50mmÂ²
â”‚
â”œâ”€â”€ Ù‚Ø·Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ (Suspension Clamps)
â”‚   â”œâ”€â”€ Ù‚Ø·Ø¹Ø© ØªØ¹Ù„ÙŠÙ‚ 120mmÂ²
â”‚   â”œâ”€â”€ Ù‚Ø·Ø¹Ø© ØªØ¹Ù„ÙŠÙ‚ 70mmÂ²
â”‚   â””â”€â”€ Ù‚Ø·Ø¹Ø© ØªØ¹Ù„ÙŠÙ‚ 50mmÂ²
â”‚
â”œâ”€â”€ Ø§Ù„Ø¹ÙˆØ§Ø²Ù„ (Insulators)
â”‚   â”œâ”€â”€ Ø¹Ø§Ø²Ù„ Ø¨ÙˆØ±Ø³Ù„ÙŠÙ†
â”‚   â”œâ”€â”€ Ø¹Ø§Ø²Ù„ Ø²Ø¬Ø§Ø¬ÙŠ
â”‚   â””â”€â”€ Ø¹Ø§Ø²Ù„ Ø¨ÙˆÙ„ÙŠÙ…Ø±
â”‚
â”œâ”€â”€ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Poles)
â”‚   â”œâ”€â”€ Ø¹Ù…ÙˆØ¯ Ø®Ø´Ø¨ÙŠ 12Ù…
â”‚   â”œâ”€â”€ Ø¹Ù…ÙˆØ¯ Ø­Ø¯ÙŠØ¯ÙŠ 12Ù…
â”‚   â””â”€â”€ Ø¹Ù…ÙˆØ¯ Ø®Ø±Ø³Ø§Ù†ÙŠ 12Ù…
â”‚
â”œâ”€â”€ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª (Transformers)
â”‚   â”œâ”€â”€ Ù…Ø­ÙˆÙ„ 100 KVA
â”‚   â”œâ”€â”€ Ù…Ø­ÙˆÙ„ 250 KVA
â”‚   â””â”€â”€ Ù…Ø­ÙˆÙ„ 500 KVA
â”‚
â””â”€â”€ Ù…Ù„Ø­Ù‚Ø§Øª Ø£Ø®Ø±Ù‰
    â”œâ”€â”€ Ø£Ø³Ù„Ø§Ùƒ ØªØ£Ø±ÙŠØ¶
    â”œâ”€â”€ ÙˆØµÙ„Ø§Øª
    â””â”€â”€ ØµÙ†Ø§Ø¯ÙŠÙ‚ ØªÙˆØ²ÙŠØ¹
```

### 19.2 Ø¬Ø¯ÙˆÙ„ Ø£ØµÙ†Ø§Ù Ø§Ù„Ø´Ø¨ÙƒØ© (network_inventory_items)

```sql
CREATE TABLE network_inventory_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    item_id UUID REFERENCES inventory_items(id),
    
    -- ØªØµÙ†ÙŠÙ Ø§Ù„Ø´Ø¨ÙƒØ©
    network_category VARCHAR(50) NOT NULL,  -- 'cable', 'tension_clamp', 'suspension_clamp', 'insulator', 'pole', 'transformer'
    
    -- Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒÙŠØ§Ø¨Ù„
    cable_type VARCHAR(50),        -- 'ABC', 'underground', 'overhead'
    cable_size_mm2 DECIMAL(10,2),  -- 120, 70, 50, 35
    
    -- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù‚Ø·Ø¹
    clamp_size_mm2 DECIMAL(10,2),
    
    -- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
    pole_material VARCHAR(30),     -- 'wood', 'steel', 'concrete'
    pole_height_m DECIMAL(5,2),
    
    -- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª
    transformer_kva INTEGER,
    
    -- ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù„Ù„Ø´Ø¨ÙƒØ©
    network_unit VARCHAR(20),      -- 'meter', 'piece', 'set'
    
    -- Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ù„Ù„ØªÙƒÙ„ÙØ©
    unit_cost DECIMAL(15,2),
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 19.3 Ø¬Ø¯ÙˆÙ„ ØµØ±Ù Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ© (network_material_issues)

```sql
CREATE TABLE network_material_issues (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    issue_id UUID REFERENCES inventory_issues(id),
    
    -- Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©
    network_node_id UUID,           -- Ø¹Ù‚Ø¯Ø© Ø§Ù„Ø´Ø¨ÙƒØ© (Ø¹Ù…ÙˆØ¯ØŒ Ù…Ø­ÙˆÙ„ØŒ Ø·Ø¨Ù„ÙˆÙ†)
    network_segment_id UUID,        -- Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ© (ÙƒÙŠØ¨Ù„)
    network_asset_id UUID,          -- Ø£ØµÙ„ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¬Ù…Ø¹
    
    -- Ø±Ø¨Ø· Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    project_id UUID,
    work_package_id UUID,
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ§Øª
    quantity_issued DECIMAL(15,3),
    unit_cost DECIMAL(15,2),
    total_cost DECIMAL(15,2),
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    issued_at TIMESTAMP DEFAULT NOW(),
    issued_by UUID REFERENCES users(id),
    
    notes TEXT
);
```

### 19.4 View: Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```sql
CREATE OR REPLACE VIEW v_network_material_consumption AS
SELECT 
    p.project_name,
    p.id as project_id,
    nii.network_category,
    ii.item_name,
    SUM(nmi.quantity_issued) as total_quantity,
    nii.network_unit,
    SUM(nmi.total_cost) as total_cost
FROM network_material_issues nmi
JOIN inventory_issues iss ON iss.id = nmi.issue_id
JOIN inventory_items ii ON ii.id = iss.item_id
JOIN network_inventory_items nii ON nii.item_id = ii.id
LEFT JOIN projects p ON p.id = nmi.project_id
GROUP BY p.id, p.project_name, nii.network_category, ii.item_name, nii.network_unit;
```

### 19.5 View: Ù…Ø®Ø²ÙˆÙ† Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©

```sql
CREATE OR REPLACE VIEW v_network_inventory_stock AS
SELECT 
    ii.id,
    ii.item_code,
    ii.item_name,
    nii.network_category,
    nii.cable_size_mm2,
    nii.network_unit,
    nii.unit_cost,
    COALESCE(SUM(CASE WHEN it.transaction_type = 'in' THEN it.quantity ELSE 0 END), 0) -
    COALESCE(SUM(CASE WHEN it.transaction_type = 'out' THEN it.quantity ELSE 0 END), 0) as current_stock,
    ii.minimum_quantity,
    CASE 
        WHEN (COALESCE(SUM(CASE WHEN it.transaction_type = 'in' THEN it.quantity ELSE 0 END), 0) -
              COALESCE(SUM(CASE WHEN it.transaction_type = 'out' THEN it.quantity ELSE 0 END), 0)) 
              <= ii.minimum_quantity 
        THEN 'low_stock'
        ELSE 'ok'
    END as stock_status
FROM inventory_items ii
JOIN network_inventory_items nii ON nii.item_id = ii.id
LEFT JOIN inventory_transactions it ON it.item_id = ii.id
GROUP BY ii.id, ii.item_code, ii.item_name, nii.network_category, 
         nii.cable_size_mm2, nii.network_unit, nii.unit_cost, ii.minimum_quantity;
```

### 19.6 Ø´Ø§Ø´Ø© ØµØ±Ù Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ØµØ±Ù Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©                                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                 â”‚
â”‚ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: [Ù…Ø´Ø±ÙˆØ¹ ØªÙˆØ³Ø¹Ø© Ø´Ø¨ÙƒØ© Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… â–¼]                       â”‚
â”‚ Ø­Ø²Ù…Ø© Ø§Ù„Ø¹Ù…Ù„: [ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ â–¼]                            â”‚
â”‚                                                                 â”‚
â”‚ Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©:                                                   â”‚
â”‚ â”œâ”€ Ø¹Ù‚Ø¯Ø© Ø§Ù„Ø´Ø¨ÙƒØ©: [Ø§Ø®ØªØ± Ø¹Ù‚Ø¯Ø©... â–¼]                              â”‚
â”‚ â”œâ”€ Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ©: [SEG-005-006 â–¼]                               â”‚
â”‚ â””â”€ Ø£ØµÙ„ Ø§Ù„Ø´Ø¨ÙƒØ©: [Ø´Ø¨ÙƒØ© ØªÙˆØ²ÙŠØ¹ Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù… â–¼]                       â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ø§Ù„ØµÙ†Ù              â”‚ Ø§Ù„ÙƒÙ…ÙŠØ© â”‚ Ø§Ù„ÙˆØ­Ø¯Ø© â”‚ Ø§Ù„Ø³Ø¹Ø±  â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ ABC Cable 120mmÂ²   â”‚ 250    â”‚ Ù…ØªØ±   â”‚ 50     â”‚ 12,500   â”‚ â”‚
â”‚ â”‚ Ù‚Ø·Ø¹Ø© Ø´Ø¯ 120mmÂ²    â”‚ 10     â”‚ Ù‚Ø·Ø¹Ø©  â”‚ 150    â”‚ 1,500    â”‚ â”‚
â”‚ â”‚ Ù‚Ø·Ø¹Ø© ØªØ¹Ù„ÙŠÙ‚ 120mmÂ² â”‚ 5      â”‚ Ù‚Ø·Ø¹Ø©  â”‚ 100    â”‚ 500      â”‚ â”‚
â”‚ â”‚ Ø¹Ø§Ø²Ù„ Ø¨ÙˆØ±Ø³Ù„ÙŠÙ†      â”‚ 15     â”‚ Ù‚Ø·Ø¹Ø©  â”‚ 80     â”‚ 1,200    â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ                                      â”‚ 15,700   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: [                                                   ] â”‚
â”‚                                                                 â”‚
â”‚                              [Ø¥Ù„ØºØ§Ø¡] [Ø­ÙØ¸ ÙˆØµØ±Ù]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.7 APIs Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø´Ø¨ÙƒØ©

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/inventory/network/items` | Ù‚Ø§Ø¦Ù…Ø© Ø£ØµÙ†Ø§Ù Ø§Ù„Ø´Ø¨ÙƒØ© |
| GET | `/api/v1/inventory/network/stock` | Ø£Ø±ØµØ¯Ø© Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø´Ø¨ÙƒØ© |
| POST | `/api/v1/inventory/network/issue` | ØµØ±Ù Ù…ÙˆØ§Ø¯ Ù„Ù„Ø´Ø¨ÙƒØ© |
| GET | `/api/v1/inventory/network/consumption/:projectId` | Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ø´Ø±ÙˆØ¹ |
| GET | `/api/v1/inventory/network/segment/:segmentId/materials` | Ù…ÙˆØ§Ø¯ Ù…Ù‚Ø·Ø¹ Ù…Ø¹ÙŠÙ† |

---

> **Ø§Ù†Ø¸Ø± Ø£ÙŠØ¶Ø§Ù‹:** 
> - `05_Ù†Ø¸Ø§Ù…_Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©_ÙˆØ§Ù„ØªØ­ÙƒÙ….md` - Ø§Ù„Ù‚Ø³Ù… 9 Ù„Ù„ØªÙˆØ£Ù… Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ø´Ø¨ÙƒØ©
> - `10_Ù†Ø¸Ø§Ù…_Ø§Ù„ØªØ®Ø·ÙŠØ·_ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.md` - Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø´Ø¨ÙƒØ©

---

# 18ï¸âƒ£ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©

> **Ø§Ù„ØºØ±Ø¶:** Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ…

## 18.1 Function: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…ÙˆØ§Ø¯

```sql
CREATE OR REPLACE FUNCTION check_materials_availability(
    p_materials JSONB  -- [{item_id, quantity_required}]
)
RETURNS JSONB AS $$
DECLARE
    v_material RECORD;
    v_available_qty DECIMAL(15,4);
    v_results JSONB := '[]'::JSONB;
    v_all_available BOOLEAN := TRUE;
BEGIN
    FOR v_material IN SELECT * FROM jsonb_array_elements(p_materials)
    LOOP
        -- Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
        SELECT COALESCE(SUM(quantity_on_hand), 0) INTO v_available_qty
        FROM inventory_balances 
        WHERE item_id = (v_material.value->>'item_id')::UUID;
        
        -- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©
        v_results := v_results || jsonb_build_object(
            'item_id', v_material.value->>'item_id',
            'required', (v_material.value->>'quantity_required')::DECIMAL,
            'available', v_available_qty,
            'is_available', v_available_qty >= (v_material.value->>'quantity_required')::DECIMAL
        );
        
        IF v_available_qty < (v_material.value->>'quantity_required')::DECIMAL THEN
            v_all_available := FALSE;
        END IF;
    END LOOP;
    
    RETURN jsonb_build_object(
        'all_available', v_all_available,
        'materials', v_results
    );
END;
$$ LANGUAGE plpgsql;
```

## 18.2 APIs Ù„Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ…

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| POST | `/api/v1/inventory/check-availability` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…ÙˆØ§Ø¯ |
| GET | `/api/v1/inventory/items/:id/availability` | ØªÙˆÙØ± ØµÙ†Ù Ù…Ø¹ÙŠÙ† |
| GET | `/api/v1/inventory/work-order-materials/:workOrderId` | Ù…ÙˆØ§Ø¯ Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ |

---

> **Ø§Ù†Ø¸Ø± Ø£ÙŠØ¶Ø§Ù‹:** `05_Ù†Ø¸Ø§Ù…_Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©_ÙˆØ§Ù„ØªØ­ÙƒÙ….md` - ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©

---

## 18. Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø´Ø§Ù…Ù„ (Serialized Items Tracking)

### 18.1 Ø§Ù„Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

> **ÙƒÙ„ ØµÙ†Ù Ø®Ø§Ø¶Ø¹ Ù„Ù„Ø±Ù‚Ø§Ø¨Ø© ÙŠØ¬Ø¨ ØªØªØ¨Ø¹Ù‡ Ù…Ù† Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ¨**

Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØªØ¨Ø¹:
- **serial**: ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ø§Ù„ÙØ±ÙŠØ¯ (Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø£Ø®ØªØ§Ù…ØŒ Ù‚ÙˆØ§Ø·Ø¹ ØºØ§Ù„ÙŠØ©)
- **batch**: ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ø¯ÙØ¹Ø© (Ø£Ø¯ÙˆÙŠØ©ØŒ Ù…ÙˆØ§Ø¯ Ù„Ù‡Ø§ ØªØ§Ø±ÙŠØ® ØµÙ„Ø§Ø­ÙŠØ©)
- **quantity**: ØªØªØ¨Ø¹ Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙ‚Ø· (Ø£Ø³Ù„Ø§ÙƒØŒ Ù…Ø³Ø§Ù…ÙŠØ±)

### 18.2 ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù
ALTER TABLE items ADD COLUMN tracking_type ENUM(
    'serial',      -- ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
    'batch',       -- ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ø¯ÙØ¹Ø©
    'quantity'     -- ØªØªØ¨Ø¹ Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙ‚Ø·
) DEFAULT 'quantity';

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ ÙŠØªØ·Ù„Ø¨ ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ¨
ALTER TABLE items ADD COLUMN requires_installation_confirmation BOOLEAN DEFAULT false;

-- Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµÙ†Ø§Ù
INSERT INTO items (code, name, tracking_type, requires_installation_confirmation) VALUES
('MTR-001', 'Ø¹Ø¯Ø§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø£Ø­Ø§Ø¯ÙŠ Ø§Ù„Ø·ÙˆØ±', 'serial', true),
('MTR-002', 'Ø¹Ø¯Ø§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø·ÙˆØ±', 'serial', true),
('SEAL-001', 'Ø®ØªÙ… Ø£Ù…Ø§Ù† Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠ', 'serial', true),
('SEAL-002', 'Ø®ØªÙ… Ø£Ù…Ø§Ù† Ù…Ø¹Ø¯Ù†ÙŠ', 'serial', true),
('BRK-001', 'Ù‚Ø§Ø·Ø¹ 32 Ø£Ù…Ø¨ÙŠØ±', 'serial', true),
('BRK-002', 'Ù‚Ø§Ø·Ø¹ 63 Ø£Ù…Ø¨ÙŠØ±', 'serial', true),
('BRK-003', 'Ù‚Ø§Ø·Ø¹ 100 Ø£Ù…Ø¨ÙŠØ±', 'serial', true),
('CBL-001', 'Ø³Ù„Ùƒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ 4 Ù…Ù…', 'quantity', false),
('CBL-002', 'Ø³Ù„Ùƒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ 6 Ù…Ù…', 'quantity', false);
```

### 18.3 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø®ØªØ§Ù… (seal_tracking)

```sql
CREATE TABLE seal_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®ØªÙ…
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    item_id UUID REFERENCES items(id),
    seal_type ENUM('plastic', 'metal', 'electronic') NOT NULL,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    current_status ENUM(
        'in_main_warehouse',    -- ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        'in_station_custody',   -- Ø¨Ø¹Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­Ø·Ø©
        'in_technician_custody', -- Ø¨Ø¹Ù‡Ø¯Ø© Ø§Ù„ÙÙ†ÙŠ
        'installed',            -- Ù…Ø±ÙƒØ¨ Ù„Ø¯Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„
        'broken',               -- Ù…ÙƒØ³ÙˆØ±
        'replaced',             -- ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡
        'lost'                  -- Ù…ÙÙ‚ÙˆØ¯
    ) DEFAULT 'in_main_warehouse',
    
    -- Ø§Ù„Ø±Ø¨Ø·
    current_warehouse_id UUID REFERENCES warehouses(id),
    current_technician_id UUID REFERENCES users(id),
    installed_meter_id UUID REFERENCES meters(id),
    installed_customer_id UUID REFERENCES customers(id),
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    received_date TIMESTAMP,
    issued_date TIMESTAMP,
    installed_date TIMESTAMP,
    broken_date TIMESTAMP,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ÙÙ‡Ø±Ø³ Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹
CREATE INDEX idx_seal_serial ON seal_tracking(serial_number);
CREATE INDEX idx_seal_status ON seal_tracking(current_status);
CREATE INDEX idx_seal_meter ON seal_tracking(installed_meter_id);
```

### 18.4 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ (breaker_tracking)

```sql
CREATE TABLE breaker_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø·Ø¹
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    item_id UUID REFERENCES items(id),
    amperage INTEGER NOT NULL, -- 16, 32, 63, 100, etc.
    breaker_type ENUM('mcb', 'mccb', 'rccb', 'rcbo') NOT NULL,
    brand VARCHAR(100),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    current_status ENUM(
        'in_main_warehouse',
        'in_station_custody',
        'in_technician_custody',
        'installed',
        'faulty',
        'replaced',
        'scrapped'
    ) DEFAULT 'in_main_warehouse',
    
    -- Ø§Ù„Ø±Ø¨Ø·
    current_warehouse_id UUID REFERENCES warehouses(id),
    current_technician_id UUID REFERENCES users(id),
    installed_meter_id UUID REFERENCES meters(id),
    installed_customer_id UUID REFERENCES customers(id),
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    received_date TIMESTAMP,
    issued_date TIMESTAMP,
    installed_date TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_breaker_serial ON breaker_tracking(serial_number);
CREATE INDEX idx_breaker_status ON breaker_tracking(current_status);
```

### 18.5 Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø­Ø±ÙƒØ© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ØªØªØ¨Ø¹Ø© (serialized_item_history)

```sql
CREATE TABLE serialized_item_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ù†ÙˆØ¹ Ø§Ù„ØµÙ†Ù
    item_type ENUM('meter', 'seal', 'breaker') NOT NULL,
    item_tracking_id UUID NOT NULL, -- references meter_status_tracking, seal_tracking, or breaker_tracking
    serial_number VARCHAR(100) NOT NULL,
    
    -- Ø§Ù„Ø­Ø±ÙƒØ©
    from_status VARCHAR(50),
    to_status VARCHAR(50) NOT NULL,
    
    -- Ø§Ù„Ø³ÙŠØ§Ù‚
    from_location_type ENUM('warehouse', 'station', 'technician', 'customer'),
    from_location_id UUID,
    to_location_type ENUM('warehouse', 'station', 'technician', 'customer'),
    to_location_id UUID,
    
    -- Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
    reference_type VARCHAR(50), -- 'grn', 'issue_voucher', 'work_order', 'installation'
    reference_id UUID,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    performed_by UUID REFERENCES users(id),
    performed_at TIMESTAMP DEFAULT NOW(),
    notes TEXT,
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©)
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8)
);

CREATE INDEX idx_serialized_history_serial ON serialized_item_history(serial_number);
CREATE INDEX idx_serialized_history_type ON serialized_item_history(item_type);
```

### 18.6 Ø´Ø§Ø´Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ØªØªØ¨Ø¹Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø­Ù†Ø© Ø£ØµÙ†Ø§Ù Ù…ØªØªØ¨Ø¹Ø©                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø±Ù‚Ù… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: [GRN-2024-0156]     Ø§Ù„ØªØ§Ø±ÙŠØ®: [15/12/2024]              â”‚
â”‚  Ø§Ù„Ù…ÙˆØ±Ø¯: [Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©]         Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: [PO-2024-0089]         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù: [Ø¹Ø¯Ø§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø£Ø­Ø§Ø¯ÙŠ Ø§Ù„Ø·ÙˆØ± â–¼]  Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 50              â”‚   â”‚
â”‚  â”‚ Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹: [Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ]                                        â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ Ù…Ø³Ø­ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ©:                                          â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ [ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯] Ø£Ùˆ [âŒ¨ï¸ Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ]                              â”‚ â”‚   â”‚
â”‚  â”‚ â”‚                                                                   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ # â”‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ    â”‚ Ø§Ù„Ø­Ø§Ù„Ø©      â”‚ Ø¥Ø¬Ø±Ø§Ø¡                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ 1 â”‚ MTR-2024-00001    â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­ â”‚ [Ø­Ø°Ù]                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ 2 â”‚ MTR-2024-00002    â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­ â”‚ [Ø­Ø°Ù]                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ 3 â”‚ MTR-2024-00003    â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­ â”‚ [Ø­Ø°Ù]                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚...â”‚ ...               â”‚ ...         â”‚ ...                       â”‚ â”‚   â”‚
â”‚  â”‚ â”‚50 â”‚ [________________]â”‚ â³ Ø§Ù†ØªØ¸Ø§Ø±   â”‚                           â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ ØªÙ… Ù…Ø³Ø­: 49/50                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù: [Ø®ØªÙ… Ø£Ù…Ø§Ù† Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠ â–¼]  Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 100                   â”‚   â”‚
â”‚  â”‚ Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹: [Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ]                                        â”‚   â”‚
â”‚  â”‚ ØªÙ… Ù…Ø³Ø­: 100/100 âœ…                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù: [Ù‚Ø§Ø·Ø¹ 32 Ø£Ù…Ø¨ÙŠØ± â–¼]  Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 50                        â”‚   â”‚
â”‚  â”‚ Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹: [Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ]                                        â”‚   â”‚
â”‚  â”‚ ØªÙ… Ù…Ø³Ø­: 50/50 âœ…                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚                              [ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.7 Ø´Ø§Ø´Ø© ØµØ±Ù Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ØµØ±Ù Ù…ÙˆØ§Ø¯ Ù„Ø£Ù…Ø± Ø¹Ù…Ù„ ØªØ±ÙƒÙŠØ¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„: [WO-2024-0892]              Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: [ØªØ±ÙƒÙŠØ¨ Ø¬Ø¯ÙŠØ¯]          â”‚
â”‚  Ø§Ù„Ø¹Ù…ÙŠÙ„: [Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ]                Ø§Ù„ÙÙ†ÙŠ: [Ø®Ø§Ù„Ø¯ Ø³Ø¹ÙŠØ¯]                  â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                           Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ±ÙƒÙŠØ¨                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Ø¹Ø¯Ø§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¡                                                       â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ù†ÙˆØ¹: [Ø£Ø­Ø§Ø¯ÙŠ Ø§Ù„Ø·ÙˆØ± â–¼]                                            â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ: [ğŸ“· Ù…Ø³Ø­] â†’ MTR-2024-00156 âœ…                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. Ø®ØªÙ… Ø£Ù…Ø§Ù†                                                          â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ù†ÙˆØ¹: [Ø¨Ù„Ø§Ø³ØªÙŠÙƒÙŠ â–¼]                                               â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ: [ğŸ“· Ù…Ø³Ø­] â†’ SEAL-2024-08956 âœ…                     â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. Ù‚Ø§Ø·Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ                                                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø£Ù…Ø¨ÙŠØ±: [32A â–¼]                                                  â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ: [ğŸ“· Ù…Ø³Ø­] â†’ BRK-2024-04521 âœ…                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. Ø³Ù„Ùƒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ 4 Ù…Ù…                                                   â”‚   â”‚
â”‚  â”‚    Ø§Ù„ÙƒÙ…ÙŠØ©: [5] Ù…ØªØ±                                                   â”‚   â”‚
â”‚  â”‚    (Ù„Ø§ ÙŠØªØ·Ù„Ø¨ Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ)                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  Ù…Ù„Ø®Øµ Ø§Ù„ØµØ±Ù:                                                               â”‚
â”‚  â€¢ 1 Ø¹Ø¯Ø§Ø¯ (MTR-2024-00156)                                                 â”‚
â”‚  â€¢ 1 Ø®ØªÙ… (SEAL-2024-08956)                                                 â”‚
â”‚  â€¢ 1 Ù‚Ø§Ø·Ø¹ (BRK-2024-04521)                                                 â”‚
â”‚  â€¢ 5 Ù…ØªØ± Ø³Ù„Ùƒ                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚            [âŒ Ø¥Ù„ØºØ§Ø¡]                    [âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØµØ±Ù]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.8 Triggers Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù

```sql
-- Trigger Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØªÙ… Ø¹Ù†Ø¯ Ø§Ù„ØµØ±Ù
CREATE OR REPLACE FUNCTION update_seal_status_on_issue()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.item_type = 'seal' THEN
        UPDATE seal_tracking
        SET current_status = 'in_technician_custody',
            current_technician_id = NEW.technician_id,
            issued_date = NOW(),
            updated_at = NOW()
        WHERE serial_number = NEW.serial_number;
        
        -- ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ
        INSERT INTO serialized_item_history (
            station_id, item_type, serial_number,
            from_status, to_status,
            from_location_type, to_location_type, to_location_id,
            reference_type, reference_id, performed_by
        ) VALUES (
            NEW.station_id, 'seal', NEW.serial_number,
            'in_station_custody', 'in_technician_custody',
            'station', 'technician', NEW.technician_id,
            'issue_voucher', NEW.issue_voucher_id, NEW.issued_by
        );
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ØµØ±Ù
CREATE OR REPLACE FUNCTION update_breaker_status_on_issue()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.item_type = 'breaker' THEN
        UPDATE breaker_tracking
        SET current_status = 'in_technician_custody',
            current_technician_id = NEW.technician_id,
            issued_date = NOW(),
            updated_at = NOW()
        WHERE serial_number = NEW.serial_number;
        
        INSERT INTO serialized_item_history (
            station_id, item_type, serial_number,
            from_status, to_status,
            from_location_type, to_location_type, to_location_id,
            reference_type, reference_id, performed_by
        ) VALUES (
            NEW.station_id, 'breaker', NEW.serial_number,
            'in_station_custody', 'in_technician_custody',
            'station', 'technician', NEW.technician_id,
            'issue_voucher', NEW.issue_voucher_id, NEW.issued_by
        );
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

### 18.9 APIs ØªØªØ¨Ø¹ Ø§Ù„Ø£ØµÙ†Ø§Ù

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/seals/track/:serial | ØªØªØ¨Ø¹ Ø®ØªÙ… Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ |
| GET | /api/v1/breakers/track/:serial | ØªØªØ¨Ø¹ Ù‚Ø§Ø·Ø¹ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ |
| GET | /api/v1/items/serialized/history/:serial | Ø³Ø¬Ù„ Ø­Ø±ÙƒØ© ØµÙ†Ù Ù…ØªØªØ¨Ø¹ |
| POST | /api/v1/items/serialized/receive | Ø§Ø³ØªÙ„Ø§Ù… Ø£ØµÙ†Ø§Ù Ù…ØªØªØ¨Ø¹Ø© |
| POST | /api/v1/items/serialized/issue | ØµØ±Ù Ø£ØµÙ†Ø§Ù Ù…ØªØªØ¨Ø¹Ø© |
| GET | /api/v1/items/serialized/by-status/:status | Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© |
| GET | /api/v1/items/serialized/by-technician/:id | Ø§Ù„Ø£ØµÙ†Ø§Ù Ø¨Ø¹Ù‡Ø¯Ø© ÙÙ†ÙŠ |
| GET | /api/v1/items/serialized/by-customer/:id | Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù„Ø¹Ù…ÙŠÙ„ |


---

## 19. ØªØªØ¨Ø¹ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ STS (Customer Interface Unit - CIU)

### 19.1 Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙƒØªØ§Ù„ÙˆØ¬

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ STS ÙƒÙƒØªØ§Ù„ÙˆØ¬ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯
INSERT INTO items (code, name, tracking_type, requires_installation_confirmation, category) VALUES
('CIU-001', 'Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ STS Ø¯Ø§Ø®Ù„ÙŠØ©', 'serial', true, 'sts_equipment'),
('CIU-002', 'Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ STS Ø®Ø§Ø±Ø¬ÙŠØ©', 'serial', true, 'sts_equipment');
```

### 19.2 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ (ciu_tracking)

```sql
CREATE TABLE ciu_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    item_id UUID REFERENCES items(id),
    ciu_type ENUM('indoor', 'outdoor') NOT NULL,
    model VARCHAR(100),
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø¹Ø¯Ø§Ø¯ (ÙƒÙ„ Ø´Ø§Ø´Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø¹Ø¯Ø§Ø¯ Ù…Ø¹ÙŠÙ†)
    paired_meter_serial VARCHAR(100),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    current_status ENUM(
        'in_main_warehouse',    -- ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        'in_station_custody',   -- Ø¨Ø¹Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­Ø·Ø©
        'in_technician_custody', -- Ø¨Ø¹Ù‡Ø¯Ø© Ø§Ù„ÙÙ†ÙŠ
        'installed',            -- Ù…Ø±ÙƒØ¨ Ù„Ø¯Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„
        'faulty',               -- Ù…Ø¹Ø·Ù„
        'replaced',             -- ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡
        'returned'              -- Ù…Ø±ØªØ¬Ø¹
    ) DEFAULT 'in_main_warehouse',
    
    -- Ø§Ù„Ø±Ø¨Ø·
    current_warehouse_id UUID REFERENCES warehouses(id),
    current_technician_id UUID REFERENCES users(id),
    installed_meter_id UUID REFERENCES meters(id),
    installed_customer_id UUID REFERENCES customers(id),
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    received_date TIMESTAMP,
    issued_date TIMESTAMP,
    installed_date TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_ciu_serial ON ciu_tracking(serial_number);
CREATE INDEX idx_ciu_status ON ciu_tracking(current_status);
CREATE INDEX idx_ciu_meter ON ciu_tracking(paired_meter_serial);
```

### 19.3 Ø´Ø§Ø´Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø­Ù†Ø© Ø¹Ø¯Ø§Ø¯Ø§Øª STS Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø­Ù†Ø© Ø¹Ø¯Ø§Ø¯Ø§Øª STS Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø±Ù‚Ù… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: [GRN-2024-0189]     Ø§Ù„ØªØ§Ø±ÙŠØ®: [16/12/2024]              â”‚
â”‚  Ø§Ù„Ù…ÙˆØ±Ø¯: [Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©]          Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: [PO-2024-0112]         â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                         Ù…Ø³Ø­ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙÙ‚Ø©                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ Ø¹Ø¯Ø§Ø¯ STS          â”‚ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ CIU    â”‚ Ø§Ù„Ø­Ø§Ù„Ø©    â”‚ Ø¥Ø¬Ø±Ø§Ø¡      â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚ 1 â”‚ STS-2024-00001    â”‚ CIU-2024-00001    â”‚ âœ… Ù…Ø·Ø§Ø¨Ù‚  â”‚ [Ø­Ø°Ù]      â”‚   â”‚
â”‚  â”‚ 2 â”‚ STS-2024-00002    â”‚ CIU-2024-00002    â”‚ âœ… Ù…Ø·Ø§Ø¨Ù‚  â”‚ [Ø­Ø°Ù]      â”‚   â”‚
â”‚  â”‚ 3 â”‚ STS-2024-00003    â”‚ CIU-2024-00003    â”‚ âœ… Ù…Ø·Ø§Ø¨Ù‚  â”‚ [Ø­Ø°Ù]      â”‚   â”‚
â”‚  â”‚ 4 â”‚ STS-2024-00004    â”‚ CIU-2024-00004    â”‚ âœ… Ù…Ø·Ø§Ø¨Ù‚  â”‚ [Ø­Ø°Ù]      â”‚   â”‚
â”‚  â”‚ 5 â”‚ [ğŸ“· Ù…Ø³Ø­ Ø§Ù„Ø¹Ø¯Ø§Ø¯]   â”‚ [ğŸ“· Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©]   â”‚ â³ Ø§Ù†ØªØ¸Ø§Ø± â”‚            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… Ø±Ø¨Ø· ÙƒÙ„ Ø¹Ø¯Ø§Ø¯ Ø¨Ø´Ø§Ø´ØªÙ‡ Ø§Ù„Ù…Ø±Ø§ÙÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³Ø­               â”‚
â”‚                                                                             â”‚
â”‚  ØªÙ… Ù…Ø³Ø­: 4/50 Ø¹Ø¯Ø§Ø¯ + Ø´Ø§Ø´Ø©                                                  â”‚
â”‚                                                                             â”‚
â”‚                              [ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.4 Ø·Ù„Ø¨ Ù…ÙˆØ§Ø¯ ØªØ±ÙƒÙŠØ¨ STS (4 Ø£ØµÙ†Ø§Ù)

```sql
-- Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù…ÙˆØ§Ø¯ Ù„ØªØ±ÙƒÙŠØ¨ STSØŒ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© 4 Ø£ØµÙ†Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
CREATE OR REPLACE FUNCTION create_sts_installation_request(
    p_work_order_id UUID,
    p_station_id UUID,
    p_requested_by UUID
) RETURNS UUID AS $$
DECLARE
    v_request_id UUID;
BEGIN
    -- Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯
    INSERT INTO material_requests (
        station_id, work_order_id, request_type, requested_by, status
    ) VALUES (
        p_station_id, p_work_order_id, 'sts_installation', p_requested_by, 'pending'
    ) RETURNING id INTO v_request_id;
    
    -- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    INSERT INTO material_request_items (request_id, item_type, quantity, is_serialized) VALUES
    (v_request_id, 'sts_meter', 1, true),      -- Ø¹Ø¯Ø§Ø¯ STS
    (v_request_id, 'ciu', 1, true),            -- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶
    (v_request_id, 'seal', 1, true),           -- Ø®ØªÙ…
    (v_request_id, 'breaker', 1, true);        -- Ù‚Ø§Ø·Ø¹
    
    RETURN v_request_id;
END;
$$ LANGUAGE plpgsql;
```

### 19.5 Ø´Ø§Ø´Ø© ØµØ±Ù Ù…ÙˆØ§Ø¯ ØªØ±ÙƒÙŠØ¨ STS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ØµØ±Ù Ù…ÙˆØ§Ø¯ ØªØ±ÙƒÙŠØ¨ Ø¹Ø¯Ø§Ø¯ STS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„: [WO-2024-0956]              Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: [ØªØ±ÙƒÙŠØ¨ STS Ø¬Ø¯ÙŠØ¯]       â”‚
â”‚  Ø§Ù„Ø¹Ù…ÙŠÙ„: [Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯]               Ø§Ù„ÙÙ†ÙŠ: [Ø¹Ù„ÙŠ Ø­Ø³Ù†]                    â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                     Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ØªØ±ÙƒÙŠØ¨ STS (4 Ø£ØµÙ†Ø§Ù)                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Ø¹Ø¯Ø§Ø¯ STS                                                          â”‚   â”‚
â”‚  â”‚    [ğŸ“· Ù…Ø³Ø­] â†’ STS-2024-00156 âœ…                                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ STS (CIU)                                              â”‚   â”‚
â”‚  â”‚    [ğŸ“· Ù…Ø³Ø­] â†’ CIU-2024-00156 âœ…                                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† (Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¹Ø¯Ø§Ø¯ STS-2024-00156)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. Ø®ØªÙ… Ø£Ù…Ø§Ù†                                                          â”‚   â”‚
â”‚  â”‚    [ğŸ“· Ù…Ø³Ø­] â†’ SEAL-2024-09123 âœ…                                     â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. Ù‚Ø§Ø·Ø¹ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ                                                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø£Ù…Ø¨ÙŠØ±: [32A â–¼]                                                  â”‚   â”‚
â”‚  â”‚    [ğŸ“· Ù…Ø³Ø­] â†’ BRK-2024-05678 âœ…                                      â”‚   â”‚
â”‚  â”‚    Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  Ù…Ù„Ø®Øµ Ø§Ù„ØµØ±Ù Ù„ØªØ±ÙƒÙŠØ¨ STS:                                                    â”‚
â”‚  â€¢ 1 Ø¹Ø¯Ø§Ø¯ STS (STS-2024-00156)                                             â”‚
â”‚  â€¢ 1 Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ (CIU-2024-00156)                                             â”‚
â”‚  â€¢ 1 Ø®ØªÙ… (SEAL-2024-09123)                                                 â”‚
â”‚  â€¢ 1 Ù‚Ø§Ø·Ø¹ 32A (BRK-2024-05678)                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚            [âŒ Ø¥Ù„ØºØ§Ø¡]                    [âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØµØ±Ù]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.6 Trigger Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø§Ø´Ø©

```sql
CREATE OR REPLACE FUNCTION update_ciu_status_on_issue()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.item_type = 'ciu' THEN
        UPDATE ciu_tracking
        SET current_status = 'in_technician_custody',
            current_technician_id = NEW.technician_id,
            issued_date = NOW(),
            updated_at = NOW()
        WHERE serial_number = NEW.serial_number;
        
        -- ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ
        INSERT INTO serialized_item_history (
            station_id, item_type, serial_number,
            from_status, to_status,
            from_location_type, to_location_type, to_location_id,
            reference_type, reference_id, performed_by
        ) VALUES (
            NEW.station_id, 'ciu', NEW.serial_number,
            'in_station_custody', 'in_technician_custody',
            'station', 'technician', NEW.technician_id,
            'issue_voucher', NEW.issue_voucher_id, NEW.issued_by
        );
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

### 19.7 APIs ØªØªØ¨Ø¹ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¶

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | /api/v1/ciu/track/:serial | ØªØªØ¨Ø¹ Ø´Ø§Ø´Ø© Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ |
| GET | /api/v1/ciu/by-meter/:meter_serial | Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø¹Ø¯Ø§Ø¯ |
| POST | /api/v1/ciu/receive | Ø§Ø³ØªÙ„Ø§Ù… Ø´Ø§Ø´Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© |
| POST | /api/v1/ciu/pair-with-meter | Ø±Ø¨Ø· Ø´Ø§Ø´Ø© Ø¨Ø¹Ø¯Ø§Ø¯ |
| GET | /api/v1/ciu/by-customer/:id | Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù„Ø¹Ù…ÙŠÙ„ |
| GET | /api/v1/sts/installation-kit/:work_order_id | Ù…Ø¬Ù…ÙˆØ¹Ø© ØªØ±ÙƒÙŠØ¨ STS ÙƒØ§Ù…Ù„Ø© |


---

## 20. Ø£ØµÙ†Ø§Ù Ø´Ø¨ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠØ© (IoT Network Items)

### 20.1 ÙƒØªØ§Ù„ÙˆØ¬ Ø£ØµÙ†Ø§Ù Ø´Ø¨ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ†Ø§Ù Ø´Ø¨ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø£ØµÙ†Ø§Ù
INSERT INTO item_catalog (category_id, item_code, item_name, item_name_en, unit, tracking_type, is_serialized, min_stock_level, reorder_point) VALUES
-- Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆØµÙˆÙ„
('network_equipment', 'NET-AP-OUT-001', 'Ù†Ù‚Ø·Ø© ÙˆØµÙˆÙ„ Ø®Ø§Ø±Ø¬ÙŠØ©', 'Outdoor Access Point', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 5, 10),
('network_equipment', 'NET-AP-IN-001', 'Ù†Ù‚Ø·Ø© ÙˆØµÙˆÙ„ Ø¯Ø§Ø®Ù„ÙŠØ©', 'Indoor Access Point', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 3, 5),
('network_equipment', 'NET-REP-001', 'Ù…ÙƒØ±Ø± Ø¥Ø´Ø§Ø±Ø©', 'Signal Repeater', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 3, 5),

-- Ù‡ÙˆØ§Ø¦ÙŠØ§Øª
('network_equipment', 'NET-ANT-BH-001', 'Ù‡ÙˆØ§Ø¦ÙŠ Backhaul', 'Backhaul Antenna', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 2, 4),
('network_equipment', 'NET-ANT-SEC-001', 'Ù‡ÙˆØ§Ø¦ÙŠ Ù‚Ø·Ø§Ø¹ÙŠ', 'Sector Antenna', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 2, 4),
('network_equipment', 'NET-ANT-OMN-001', 'Ù‡ÙˆØ§Ø¦ÙŠ Ø´Ø§Ù…Ù„', 'Omni Antenna', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 2, 4),

-- ÙƒØ§Ø¨Ù„Ø§Øª ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª
('network_cables', 'NET-CAB-OUT-001', 'ÙƒØ§Ø¨Ù„ Ø´Ø¨ÙƒØ© Ø®Ø§Ø±Ø¬ÙŠ Cat6', 'Outdoor Cat6 Cable', 'Ù…ØªØ±', 'quantity', false, 500, 1000),
('network_cables', 'NET-CAB-FIB-001', 'ÙƒØ§Ø¨Ù„ ÙØ§ÙŠØ¨Ø± Ø®Ø§Ø±Ø¬ÙŠ', 'Outdoor Fiber Cable', 'Ù…ØªØ±', 'quantity', false, 200, 500),
('network_cables', 'NET-CON-RJ45-001', 'Ù…ÙˆØµÙ„ RJ45 Ø®Ø§Ø±Ø¬ÙŠ', 'Outdoor RJ45 Connector', 'Ù‚Ø·Ø¹Ø©', 'quantity', false, 100, 200),

-- ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙˆØ­Ù…Ø§ÙŠØ©
('network_enclosures', 'NET-BOX-OUT-001', 'ØµÙ†Ø¯ÙˆÙ‚ ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'Outdoor Junction Box', 'Ù‚Ø·Ø¹Ø©', 'quantity', false, 20, 50),
('network_enclosures', 'NET-BOX-POE-001', 'ØµÙ†Ø¯ÙˆÙ‚ PoE Ø®Ø§Ø±Ø¬ÙŠ', 'Outdoor PoE Box', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 10, 20),
('network_enclosures', 'NET-CAB-RACK-001', 'Ø®Ø²Ø§Ù†Ø© Ø´Ø¨ÙƒØ© Ø®Ø§Ø±Ø¬ÙŠØ©', 'Outdoor Network Cabinet', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 2, 4),

-- Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
('network_equipment', 'NET-SW-POE-001', 'Ø³ÙˆÙŠØªØ´ PoE Ø®Ø§Ø±Ø¬ÙŠ', 'Outdoor PoE Switch', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 5, 10),
('network_equipment', 'NET-INJ-POE-001', 'Ø­Ø§Ù‚Ù† PoE', 'PoE Injector', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 20, 50),
('network_equipment', 'NET-UPS-OUT-001', 'UPS Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø´Ø¨ÙƒØ©', 'Outdoor Network UPS', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 5, 10),

-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ±ÙƒÙŠØ¨
('network_tools', 'NET-TOOL-CRIMP-001', 'Ø£Ø¯Ø§Ø© ÙƒØ¨Ø³ RJ45', 'RJ45 Crimping Tool', 'Ù‚Ø·Ø¹Ø©', 'quantity', false, 5, 10),
('network_tools', 'NET-TOOL-TEST-001', 'Ø¬Ù‡Ø§Ø² ÙØ­Øµ Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª', 'Cable Tester', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 3, 5),
('network_tools', 'NET-TOOL-SPEC-001', 'Ø¬Ù‡Ø§Ø² ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·ÙŠÙ', 'Spectrum Analyzer', 'Ù‚Ø·Ø¹Ø©', 'serial', true, 1, 2);
```

### 20.2 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø¨ÙƒØ© (network_device_tracking)

```sql
CREATE TABLE network_device_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
    item_id UUID NOT NULL REFERENCES item_catalog(id),
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    mac_address VARCHAR(17),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
    purchase_date DATE,
    purchase_price DECIMAL(12, 2),
    supplier_id UUID REFERENCES suppliers(id),
    warranty_expiry DATE,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹
    current_status ENUM(
        'in_stock',           -- ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
        'installed',          -- Ù…Ø±ÙƒØ¨
        'maintenance',        -- ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
        'faulty',            -- Ù…Ø¹Ø·Ù„
        'disposed'           -- Ù…Ø³ØªØ¨Ø¹Ø¯
    ) DEFAULT 'in_stock',
    
    -- Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ¨ (Ø¥Ø°Ø§ Ù…Ø±ÙƒØ¨)
    installation_location VARCHAR(200),
    installation_latitude DECIMAL(10, 8),
    installation_longitude DECIMAL(11, 8),
    installed_date DATE,
    installed_by UUID REFERENCES users(id),
    
    -- Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² AP)
    access_point_id UUID REFERENCES access_points(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_network_device_serial ON network_device_tracking(serial_number);
CREATE INDEX idx_network_device_status ON network_device_tracking(current_status);
CREATE INDEX idx_network_device_station ON network_device_tracking(station_id);
```

### 20.3 Ø´Ø§Ø´Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø¨ÙƒØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ğŸ“¦ Ø§Ø³ØªÙ„Ø§Ù… Ø£Ø¬Ù‡Ø²Ø© Ø´Ø¨ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: PO-2024-0089                                                  â”‚
â”‚  Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                                           â”‚
â”‚  ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: 2024-12-16                                                â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                         Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡Ø§                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ø§Ù„ØµÙ†Ù                    â”‚ Ø§Ù„ÙƒÙ…ÙŠØ© â”‚ Ø§Ù„Ù…Ø³ØªÙ„Ù… â”‚ Ø§Ù„ØªØªØ¨Ø¹    â”‚ Ø§Ù„Ø­Ø§Ù„Ø©   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Ù†Ù‚Ø·Ø© ÙˆØµÙˆÙ„ Ø®Ø§Ø±Ø¬ÙŠØ©        â”‚ 10     â”‚ 10      â”‚ ØªØ³Ù„Ø³Ù„ÙŠ   â”‚ âœ… Ù…ÙƒØªÙ…Ù„ â”‚   â”‚
â”‚  â”‚ Ù…ÙƒØ±Ø± Ø¥Ø´Ø§Ø±Ø©              â”‚ 5      â”‚ 5       â”‚ ØªØ³Ù„Ø³Ù„ÙŠ   â”‚ âœ… Ù…ÙƒØªÙ…Ù„ â”‚   â”‚
â”‚  â”‚ ÙƒØ§Ø¨Ù„ Ø´Ø¨ÙƒØ© Ø®Ø§Ø±Ø¬ÙŠ (Ù…ØªØ±)   â”‚ 1000   â”‚ 1000    â”‚ ÙƒÙ…ÙŠØ©     â”‚ âœ… Ù…ÙƒØªÙ…Ù„ â”‚   â”‚
â”‚  â”‚ ØµÙ†Ø¯ÙˆÙ‚ ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ       â”‚ 20     â”‚ 18      â”‚ ÙƒÙ…ÙŠØ©     â”‚ âš ï¸ Ù†Ø§Ù‚Øµ  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                    Ù…Ø³Ø­ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© - Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆØµÙˆÙ„                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ      â”‚ MAC Address       â”‚ Ø§Ù„Ø­Ø§Ù„Ø©              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ UAP-AC-M-001234     â”‚ AA:BB:CC:DD:EE:01 â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­         â”‚   â”‚
â”‚  â”‚ 2 â”‚ UAP-AC-M-001235     â”‚ AA:BB:CC:DD:EE:02 â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­         â”‚   â”‚
â”‚  â”‚ 3 â”‚ UAP-AC-M-001236     â”‚ AA:BB:CC:DD:EE:03 â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­         â”‚   â”‚
â”‚  â”‚ ...                                                                 â”‚   â”‚
â”‚  â”‚ 10â”‚ [Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...]   â”‚ [ØªÙ„Ù‚Ø§Ø¦ÙŠ]          â”‚ â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø³Ø­    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯]    [âŒ¨ï¸ Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ]    [âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

# 14. ÙƒØªØ§Ù„ÙˆØ¬ Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù† (Surveillance Items Catalog)

## 14.1 Ø£ØµÙ†Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª

| ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù | Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù | Ø§Ù„ÙˆØµÙ | Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹ | Ø§Ù„ÙˆØ­Ø¯Ø© |
|-----------|-----------|-------|-----------|--------|
| CAM-FIX-OUT | ÙƒØ§Ù…ÙŠØ±Ø§ Ø«Ø§Ø¨ØªØ© Ø®Ø§Ø±Ø¬ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ IP Ø«Ø§Ø¨ØªØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-FIX-IN | ÙƒØ§Ù…ÙŠØ±Ø§ Ø«Ø§Ø¨ØªØ© Ø¯Ø§Ø®Ù„ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ IP Ø«Ø§Ø¨ØªØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-PTZ-OUT | ÙƒØ§Ù…ÙŠØ±Ø§ PTZ Ø®Ø§Ø±Ø¬ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-PTZ-IN | ÙƒØ§Ù…ÙŠØ±Ø§ PTZ Ø¯Ø§Ø®Ù„ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-DOME | ÙƒØ§Ù…ÙŠØ±Ø§ Ù‚Ø¨Ø© | ÙƒØ§Ù…ÙŠØ±Ø§ Ù‚Ø¨Ø© Ù„Ù„Ø³Ù‚Ù | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-BULLET | ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ø³Ø·ÙˆØ§Ù†ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ Bullet | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| CAM-THERMAL | ÙƒØ§Ù…ÙŠØ±Ø§ Ø­Ø±Ø§Ø±ÙŠØ© | ÙƒØ§Ù…ÙŠØ±Ø§ ØªØµÙˆÙŠØ± Ø­Ø±Ø§Ø±ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |

## 14.2 Ø£ØµÙ†Ø§Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„

| ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù | Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù | Ø§Ù„ÙˆØµÙ | Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹ | Ø§Ù„ÙˆØ­Ø¯Ø© |
|-----------|-----------|-------|-----------|--------|
| NVR-4CH | Ù…Ø³Ø¬Ù„ ÙÙŠØ¯ÙŠÙˆ Ø´Ø¨ÙƒÙŠ 4 Ù‚Ù†ÙˆØ§Øª | NVR 4 Channel | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| NVR-8CH | Ù…Ø³Ø¬Ù„ ÙÙŠØ¯ÙŠÙˆ Ø´Ø¨ÙƒÙŠ 8 Ù‚Ù†ÙˆØ§Øª | NVR 8 Channel | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| NVR-16CH | Ù…Ø³Ø¬Ù„ ÙÙŠØ¯ÙŠÙˆ Ø´Ø¨ÙƒÙŠ 16 Ù‚Ù†ÙˆØ§Øª | NVR 16 Channel | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| NVR-32CH | Ù…Ø³Ø¬Ù„ ÙÙŠØ¯ÙŠÙˆ Ø´Ø¨ÙƒÙŠ 32 Ù‚Ù†ÙˆØ§Øª | NVR 32 Channel | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| HDD-SURV-2TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© 2TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù…Ø®ØµØµ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| HDD-SURV-4TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© 4TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù…Ø®ØµØµ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| HDD-SURV-8TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© 8TB | Ù‚Ø±Øµ ØµÙ„Ø¨ Ù…Ø®ØµØµ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |

## 14.3 Ø£ØµÙ†Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª

| ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù | Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù | Ø§Ù„ÙˆØµÙ | Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹ | Ø§Ù„ÙˆØ­Ø¯Ø© |
|-----------|-----------|-------|-----------|--------|
| SENS-DOOR-MAG | Ø­Ø³Ø§Ø³ Ø¨Ø§Ø¨ Ù…ØºÙ†Ø§Ø·ÙŠØ³ÙŠ | Ø­Ø³Ø§Ø³ ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| SENS-MOTION-PIR | Ø­Ø³Ø§Ø³ Ø­Ø±ÙƒØ© PIR | Ø­Ø³Ø§Ø³ Ø­Ø±ÙƒØ© Ø¨Ø§Ù„Ø£Ø´Ø¹Ø© ØªØ­Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| SENS-SMOKE | Ø­Ø³Ø§Ø³ Ø¯Ø®Ø§Ù† | ÙƒØ§Ø´Ù Ø¯Ø®Ø§Ù† | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| SENS-TEMP | Ø­Ø³Ø§Ø³ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© | Ø­Ø³Ø§Ø³ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø±Ù‚Ù…ÙŠ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |
| SENS-FLOOD | Ø­Ø³Ø§Ø³ ØªØ³Ø±Ø¨ Ù…ÙŠØ§Ù‡ | ÙƒØ§Ø´Ù ØªØ³Ø±Ø¨ Ø§Ù„Ù…ÙŠØ§Ù‡ | Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ | Ù‚Ø·Ø¹Ø© |

## 14.4 Ø£ØµÙ†Ø§Ù Ù…Ù„Ø­Ù‚Ø§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª

| ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù | Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù | Ø§Ù„ÙˆØµÙ | Ù†ÙˆØ¹ Ø§Ù„ØªØªØ¨Ø¹ | Ø§Ù„ÙˆØ­Ø¯Ø© |
|-----------|-----------|-------|-----------|--------|
| CAM-MOUNT-WALL | Ø­Ø§Ù…Ù„ ÙƒØ§Ù…ÙŠØ±Ø§ Ø­Ø§Ø¦Ø· | Ø­Ø§Ù…Ù„ ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø¦Ø· | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| CAM-MOUNT-POLE | Ø­Ø§Ù…Ù„ ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù…ÙˆØ¯ | Ø­Ø§Ù…Ù„ ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| CAM-MOUNT-CORNER | Ø­Ø§Ù…Ù„ ÙƒØ§Ù…ÙŠØ±Ø§ Ø²Ø§ÙˆÙŠØ© | Ø­Ø§Ù…Ù„ ØªØ«Ø¨ÙŠØª ÙÙŠ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| CAM-HOUSING | ØµÙ†Ø¯ÙˆÙ‚ Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…ÙŠØ±Ø§ | ØµÙ†Ø¯ÙˆÙ‚ Ø­Ù…Ø§ÙŠØ© Ø®Ø§Ø±Ø¬ÙŠ | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| CAM-LENS-2.8 | Ø¹Ø¯Ø³Ø© 2.8mm | Ø¹Ø¯Ø³Ø© Ø«Ø§Ø¨ØªØ© 2.8mm | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| CAM-LENS-VAR | Ø¹Ø¯Ø³Ø© Ù…ØªØºÙŠØ±Ø© | Ø¹Ø¯Ø³Ø© 2.8-12mm | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| POE-INJ | Ø­Ø§Ù‚Ù† PoE | Power over Ethernet Injector | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |
| POE-SPLIT | ÙØ§ØµÙ„ PoE | PoE Splitter | Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© | Ù‚Ø·Ø¹Ø© |

## 14.5 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª (camera_tracking)

```sql
CREATE TABLE camera_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙ†Ù
    item_code VARCHAR(50) NOT NULL,
    item_name VARCHAR(200) NOT NULL,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    mac_address VARCHAR(17),
    brand VARCHAR(100),
    model VARCHAR(100),
    
    -- Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    received_date DATE NOT NULL,
    received_by UUID REFERENCES users(id),
    po_number VARCHAR(50),
    grn_number VARCHAR(50),
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_location ENUM(
        'warehouse',          -- ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
        'with_technician',    -- Ù…Ø¹ Ø§Ù„ÙÙ†ÙŠ
        'installed',          -- Ù…Ø±ÙƒØ¨Ø©
        'maintenance',        -- ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
        'damaged',            -- ØªØ§Ù„ÙØ©
        'disposed'            -- ØªÙ… Ø§Ù„ØªØ®Ù„Øµ Ù…Ù†Ù‡Ø§
    ) DEFAULT 'warehouse',
    
    -- Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø±ÙƒØ¨Ø©
    installation_location VARCHAR(200),
    installed_at TIMESTAMP,
    installed_by UUID REFERENCES users(id),
    
    -- Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø¹ ÙÙ†ÙŠ
    assigned_to UUID REFERENCES users(id),
    assigned_at TIMESTAMP,
    
    -- Ø§Ù„Ø¶Ù…Ø§Ù†
    warranty_start DATE,
    warranty_end DATE,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_camera_tracking_serial ON camera_tracking(serial_number);
CREATE INDEX idx_camera_tracking_location ON camera_tracking(current_location);
CREATE INDEX idx_camera_tracking_station ON camera_tracking(station_id);
```

## 14.6 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª (sensor_tracking)

```sql
CREATE TABLE sensor_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙ†Ù
    item_code VARCHAR(50) NOT NULL,
    item_name VARCHAR(200) NOT NULL,
    sensor_type ENUM('door', 'motion', 'smoke', 'temperature', 'flood') NOT NULL,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    
    -- Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    received_date DATE NOT NULL,
    received_by UUID REFERENCES users(id),
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_location ENUM(
        'warehouse',
        'with_technician',
        'installed',
        'maintenance',
        'damaged',
        'disposed'
    ) DEFAULT 'warehouse',
    
    -- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±ÙƒØ¨
    installation_location VARCHAR(200),
    linked_camera_id UUID,
    linked_asset_type VARCHAR(50),
    linked_asset_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_sensor_tracking_serial ON sensor_tracking(serial_number);
CREATE INDEX idx_sensor_tracking_type ON sensor_tracking(sensor_type);
```


---

# 11. Ø£ØµÙ†Ø§Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø© ÙˆØ§Ù„Ø­Ø¶ÙˆØ±

## 11.1 ÙƒØªØ§Ù„ÙˆØ¬ Ø£ØµÙ†Ø§Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø©

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ†Ø§Ù Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø©
INSERT INTO item_catalog (item_code, item_name, category, tracking_type, unit, description) VALUES
-- Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø©
('BIO-FP-001', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø¥ØµØ¨Ø¹ - ZKTeco', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø¥ØµØ¨Ø¹ Ù…Ø¹ Ø´Ø§Ø´Ø© LCD'),
('BIO-FP-002', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø¥ØµØ¨Ø¹ - Hikvision', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø¥ØµØ¨Ø¹ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø©'),
('BIO-FACE-001', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© ÙˆØ¬Ù‡ - ZKTeco', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ù‡Ø§Ø² ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡'),
('BIO-FACE-002', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© ÙˆØ¬Ù‡ - Hikvision', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ù‡Ø§Ø² ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡ Ù…Ø¹ ÙƒØ§Ù…ÙŠØ±Ø§ Ø­Ø±Ø§Ø±ÙŠØ©'),
('BIO-MIXED-001', 'Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ù…ØªØ¹Ø¯Ø¯ - Ø¥ØµØ¨Ø¹+ÙˆØ¬Ù‡', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ø¬Ù‡Ø§Ø² Ù…ØªØ¹Ø¯Ø¯ Ø·Ø±Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚'),
('BIO-CARD-001', 'Ø¬Ù‡Ø§Ø² Ù‚Ø§Ø±Ø¦ Ø¨Ø·Ø§Ù‚Ø§Øª RFID', 'Ø£Ø¬Ù‡Ø²Ø©_Ø§Ù„Ø¨ØµÙ…Ø©', 'serial', 'Ø¬Ù‡Ø§Ø²', 'Ù‚Ø§Ø±Ø¦ Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø­Ø¶ÙˆØ±'),

-- Ù…Ù„Ø­Ù‚Ø§Øª Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø©
('BIO-ACC-001', 'Ø­Ø§Ù…Ù„ Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø­Ø§Ø¦Ø·ÙŠ', 'Ù…Ù„Ø­Ù‚Ø§Øª_Ø§Ù„Ø¨ØµÙ…Ø©', 'quantity', 'Ù‚Ø·Ø¹Ø©', 'Ø­Ø§Ù…Ù„ ØªØ«Ø¨ÙŠØª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø¦Ø·'),
('BIO-ACC-002', 'Ø­Ø§Ù…Ù„ Ø¬Ù‡Ø§Ø² Ø¨ØµÙ…Ø© Ø£Ø±Ø¶ÙŠ', 'Ù…Ù„Ø­Ù‚Ø§Øª_Ø§Ù„Ø¨ØµÙ…Ø©', 'quantity', 'Ù‚Ø·Ø¹Ø©', 'Ø­Ø§Ù…Ù„ Ø£Ø±Ø¶ÙŠ Ù…ØªØ­Ø±Ùƒ'),
('BIO-ACC-003', 'Ø¨Ø·Ø§Ø±ÙŠØ© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© UPS ØµØºÙŠØ±Ø©', 'Ù…Ù„Ø­Ù‚Ø§Øª_Ø§Ù„Ø¨ØµÙ…Ø©', 'quantity', 'Ù‚Ø·Ø¹Ø©', 'Ø¨Ø·Ø§Ø±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡'),
('BIO-ACC-004', 'ÙƒØ§Ø¨Ù„ Ø´Ø¨ÙƒØ© CAT6 - 5 Ù…ØªØ±', 'Ù…Ù„Ø­Ù‚Ø§Øª_Ø§Ù„Ø¨ØµÙ…Ø©', 'quantity', 'Ù‚Ø·Ø¹Ø©', 'ÙƒØ§Ø¨Ù„ ØªÙˆØµÙŠÙ„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©'),
('BIO-ACC-005', 'Ù…Ø­ÙˆÙ„ PoE', 'Ù…Ù„Ø­Ù‚Ø§Øª_Ø§Ù„Ø¨ØµÙ…Ø©', 'quantity', 'Ù‚Ø·Ø¹Ø©', 'Ù…Ø­ÙˆÙ„ ØªØºØ°ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø´Ø¨ÙƒØ©'),

-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
('BIO-CARD-PROX', 'Ø¨Ø·Ø§Ù‚Ø© Ø­Ø¶ÙˆØ± Proximity', 'Ø¨Ø·Ø§Ù‚Ø§Øª_Ø§Ù„Ø­Ø¶ÙˆØ±', 'serial', 'Ø¨Ø·Ø§Ù‚Ø©', 'Ø¨Ø·Ø§Ù‚Ø© RFID Ù„Ù„Ø­Ø¶ÙˆØ±'),
('BIO-CARD-SMART', 'Ø¨Ø·Ø§Ù‚Ø© Ø­Ø¶ÙˆØ± Ø°ÙƒÙŠØ©', 'Ø¨Ø·Ø§Ù‚Ø§Øª_Ø§Ù„Ø­Ø¶ÙˆØ±', 'serial', 'Ø¨Ø·Ø§Ù‚Ø©', 'Ø¨Ø·Ø§Ù‚Ø© Ø°ÙƒÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
```

## 11.2 Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¨ØµÙ…Ø©

```sql
CREATE TABLE biometric_device_tracking (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    item_id UUID NOT NULL REFERENCES item_catalog(id),
    serial_number VARCHAR(100) UNIQUE NOT NULL,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
    purchase_order_id UUID REFERENCES purchase_orders(id),
    purchase_date DATE,
    warranty_end_date DATE,
    supplier_id UUID REFERENCES suppliers(id),
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_location_type ENUM('warehouse', 'station', 'maintenance') DEFAULT 'warehouse',
    warehouse_id UUID REFERENCES warehouses(id),
    station_id UUID REFERENCES stations(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ±ÙƒÙŠØ¨
    installation_date DATE,
    installed_by UUID REFERENCES users(id),
    ip_address VARCHAR(45),
    mac_address VARCHAR(17),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status ENUM('in_stock', 'installed', 'maintenance', 'retired') DEFAULT 'in_stock',
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_bio_device_serial ON biometric_device_tracking(serial_number);
CREATE INDEX idx_bio_device_station ON biometric_device_tracking(station_id);
```


---

# 14. Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ (Trackable Items)

## 14.1 Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

> **Ø§Ù„ØºØ±Ø¶:** Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø¨ÙŠÙ† Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ© (Ù…Ø«Ù„ Ø§Ù„Ø²ÙŠØª) ÙˆØ§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹ (Ù…Ø«Ù„ Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ù…Ø¶Ø®Ø§Øª) Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø±Ù‚Ù…Ù‡Ø§ Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ.

## 14.2 ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØªØ¨Ø¹ Ù„Ø¬Ø¯ÙˆÙ„ inventory_items
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS is_trackable BOOLEAN DEFAULT false;
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS requires_serial_number BOOLEAN DEFAULT false;
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS expected_life_hours DECIMAL(10, 2);
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS expected_life_days INT;
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS is_component BOOLEAN DEFAULT false;
ALTER TABLE inventory_items ADD COLUMN IF NOT EXISTS component_category ENUM(
    'filter', 'pump', 'battery', 'belt', 'sensor', 'relay', 'fuse', 'other'
);
```

## 14.3 Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ù„Ù„Ø£ØµÙ†Ø§Ù (item_serial_numbers)

```sql
CREATE TABLE item_serial_numbers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- Ø§Ù„ØµÙ†Ù
    item_id UUID NOT NULL REFERENCES inventory_items(id) ON DELETE CASCADE,
    
    -- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
    serial_number VARCHAR(100) NOT NULL UNIQUE,
    batch_number VARCHAR(100),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    received_at TIMESTAMP NOT NULL DEFAULT NOW(),
    received_grn_id UUID REFERENCES goods_received_notes(id),
    supplier_id UUID REFERENCES suppliers(id),
    purchase_cost DECIMAL(12, 2),
    warranty_expiry DATE,
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_location ENUM('warehouse', 'technician', 'installed', 'disposed') DEFAULT 'warehouse',
    warehouse_id UUID REFERENCES warehouses(id),
    assigned_technician_id UUID REFERENCES employees(id),
    installed_asset_id UUID REFERENCES assets(id),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status ENUM('available', 'reserved', 'issued', 'installed', 'returned', 'disposed') DEFAULT 'available',
    
    -- ØªÙˆØ§Ø±ÙŠØ® Ù…Ù‡Ù…Ø©
    issued_at TIMESTAMP,
    installed_at TIMESTAMP,
    disposed_at TIMESTAMP,
    disposal_reason TEXT,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_serial_item ON item_serial_numbers(item_id);
CREATE INDEX idx_serial_status ON item_serial_numbers(status);
CREATE INDEX idx_serial_location ON item_serial_numbers(current_location);
CREATE INDEX idx_serial_technician ON item_serial_numbers(assigned_technician_id);
```

## 14.4 Ø¬Ø¯ÙˆÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© (serial_number_movements)

```sql
CREATE TABLE serial_number_movements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    serial_id UUID NOT NULL REFERENCES item_serial_numbers(id),
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©
    movement_type ENUM(
        'received',           -- Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯
        'issued_to_tech',     -- ØµØ±Ù Ù„Ù„ÙÙ†ÙŠ
        'returned_from_tech', -- Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù† Ø§Ù„ÙÙ†ÙŠ
        'installed',          -- ØªØ±ÙƒÙŠØ¨ ÙÙŠ Ø£ØµÙ„
        'removed',            -- Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø£ØµÙ„
        'transferred',        -- Ù†Ù‚Ù„ Ø¨ÙŠÙ† Ù…Ø®Ø§Ø²Ù†
        'disposed'            -- Ø¥ØªÙ„Ø§Ù
    ) NOT NULL,
    
    -- Ù…Ù†/Ø¥Ù„Ù‰
    from_location VARCHAR(200),
    to_location VARCHAR(200),
    
    -- Ø§Ù„Ù…Ø±Ø¬Ø¹
    reference_type VARCHAR(50),
    reference_id UUID,
    
    -- Ø§Ù„ØªÙØ§ØµÙŠÙ„
    performed_by UUID REFERENCES employees(id),
    performed_at TIMESTAMP DEFAULT NOW(),
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_movement_serial ON serial_number_movements(serial_id);
CREATE INDEX idx_movement_type ON serial_number_movements(movement_type);
CREATE INDEX idx_movement_date ON serial_number_movements(performed_at);
```

## 14.5 Ø´Ø§Ø´Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø£ØµÙ†Ø§Ù Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“¦ Ø§Ø³ØªÙ„Ø§Ù… Ø£ØµÙ†Ø§Ù Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø¥Ø°Ù† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: GRN-2024-0456                                               â”‚
â”‚  Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…ØªØ­Ø¯Ø©                                               â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                           Ø§Ù„ØµÙ†Ù: ÙÙ„ØªØ± Ø²ÙŠØª CAT-1R-0739                       â”‚
â”‚                           Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 10 Ù‚Ø·Ø¹                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ” Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ:                             â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ [                                                           ]   â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                     [ğŸ“· Ù…Ø³Ø­]         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø© (7/10):                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ #   â”‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ    â”‚ Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹Ø©  â”‚ Ø§Ù„Ø­Ø§Ù„Ø©        â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ 1   â”‚ FO-2024-001234     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 2   â”‚ FO-2024-001235     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 3   â”‚ FO-2024-001236     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 4   â”‚ FO-2024-001237     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 5   â”‚ FO-2024-001238     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 6   â”‚ FO-2024-001239     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 7   â”‚ FO-2024-001240     â”‚ BATCH-A1     â”‚ âœ… ØªÙ… Ø§Ù„Ù…Ø³Ø­   â”‚              â”‚
â”‚  â”‚ 8   â”‚ -                  â”‚ -            â”‚ â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±â”‚              â”‚
â”‚  â”‚ 9   â”‚ -                  â”‚ -            â”‚ â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±â”‚              â”‚
â”‚  â”‚ 10  â”‚ -                  â”‚ -            â”‚ â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                             â”‚
â”‚  [âŒ Ø¥Ù„ØºØ§Ø¡]                                      [âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 14.6 Trigger Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…

```sql
CREATE OR REPLACE FUNCTION validate_trackable_item_receipt()
RETURNS TRIGGER AS $$
DECLARE
    v_item RECORD;
BEGIN
    -- Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙ†Ù
    SELECT * INTO v_item FROM inventory_items WHERE id = NEW.item_id;
    
    -- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ†Ù ÙŠØªØ·Ù„Ø¨ Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ
    IF v_item.requires_serial_number = true THEN
        -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø±Ù‚Ø§Ù… ØªØ³Ù„Ø³Ù„ÙŠØ© Ø¨Ù†ÙØ³ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ©
        IF (
            SELECT COUNT(*) FROM item_serial_numbers 
            WHERE item_id = NEW.item_id AND received_grn_id = NEW.grn_id
        ) < NEW.quantity THEN
            RAISE EXCEPTION 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©';
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

## 14.7 APIs Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/inventory/items/:id/serials` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ù„Ù„ØµÙ†Ù |
| POST | `/api/v1/inventory/serials/scan` | Ù…Ø³Ø­ Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ Ø¬Ø¯ÙŠØ¯ |
| GET | `/api/v1/inventory/serials/:serial/history` | ØªØ§Ø±ÙŠØ® Ø­Ø±ÙƒØ© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ |
| POST | `/api/v1/inventory/serials/:serial/issue` | ØµØ±Ù Ù„Ù„ÙÙ†ÙŠ |
| POST | `/api/v1/inventory/serials/:serial/return` | Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù† Ø§Ù„ÙÙ†ÙŠ |
| GET | `/api/v1/inventory/serials/available` | Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØµØ±Ù |


---

# 16. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª (Multi-Status Warehouse)

## 16.1 Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø­Ø§Ù„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ø¯Ø¹Ù… Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØµÙ„Ø­.

## 16.2 Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (storage_locations)

```sql
CREATE TABLE storage_locations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
    location_code VARCHAR(50) NOT NULL UNIQUE,
    location_name VARCHAR(200) NOT NULL,
    location_name_en VARCHAR(200),
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    location_type ENUM(
        'main',           -- Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø£ØµÙ†Ø§Ù Ø¬Ø¯ÙŠØ¯Ø©)
        'damaged',        -- Ù…Ø®Ø²Ù† Ø§Ù„ØªØ§Ù„Ù
        'repair',         -- Ù…Ø®Ø²Ù† Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        'refurbished',    -- Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­
        'quarantine',     -- Ù…Ø®Ø²Ù† Ø§Ù„Ø­Ø¬Ø± (ÙØ­Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©)
        'scrap'           -- Ù…Ø®Ø²Ù† Ø§Ù„Ø®Ø±Ø¯Ø© (Ù„Ù„ØªØ®Ù„Øµ)
    ) NOT NULL DEFAULT 'main',
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ¹Ù„ÙŠ
    physical_location TEXT,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    is_active BOOLEAN DEFAULT TRUE,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ÙƒÙ„ Ù…Ø­Ø·Ø©
CREATE OR REPLACE FUNCTION create_default_storage_locations()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO storage_locations (station_id, location_code, location_name, location_type)
    VALUES 
        (NEW.id, NEW.station_code || '-MAIN', 'Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'main'),
        (NEW.id, NEW.station_code || '-DMG', 'Ù…Ø®Ø²Ù† Ø§Ù„ØªØ§Ù„Ù', 'damaged'),
        (NEW.id, NEW.station_code || '-REP', 'Ù…Ø®Ø²Ù† Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­', 'repair'),
        (NEW.id, NEW.station_code || '-REF', 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­', 'refurbished'),
        (NEW.id, NEW.station_code || '-SCR', 'Ù…Ø®Ø²Ù† Ø§Ù„Ø®Ø±Ø¯Ø©', 'scrap');
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_create_storage_locations
AFTER INSERT ON stations
FOR EACH ROW EXECUTE FUNCTION create_default_storage_locations();
```

## 16.3 ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹

```sql
-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
ALTER TABLE inventory 
ADD COLUMN IF NOT EXISTS storage_location_id UUID REFERENCES storage_locations(id);

-- Ø¬Ø¯ÙˆÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
CREATE TABLE inventory_by_location (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    storage_location_id UUID NOT NULL REFERENCES storage_locations(id),
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ©
    quantity DECIMAL(10, 2) DEFAULT 0,
    
    -- Ù„Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØªØ¨Ø¹
    serial_numbers JSONB,
    
    -- Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
    last_movement_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(item_id, storage_location_id)
);
```

## 16.4 Ø¬Ø¯ÙˆÙ„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ (location_transfers)

```sql
CREATE TABLE location_transfers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- Ø±Ù‚Ù… Ø§Ù„Ø­Ø±ÙƒØ©
    transfer_number VARCHAR(50) NOT NULL UNIQUE,
    
    -- Ø§Ù„ØµÙ†Ù
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    serial_number_id UUID REFERENCES item_serial_numbers(id),
    
    -- Ù…Ù†/Ø¥Ù„Ù‰
    from_location_id UUID NOT NULL REFERENCES storage_locations(id),
    to_location_id UUID NOT NULL REFERENCES storage_locations(id),
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ©
    quantity DECIMAL(10, 2) NOT NULL,
    
    -- Ø§Ù„Ø³Ø¨Ø¨
    transfer_reason ENUM(
        'scan_out_scrap',       -- ÙÙƒ Ù‚Ø·Ø¹Ø© ØªØ§Ù„ÙØ©
        'scan_out_repairable',  -- ÙÙƒ Ù‚Ø·Ø¹Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥ØµÙ„Ø§Ø­
        'send_to_repair',       -- Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­
        'repair_complete',      -- Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        'assembly_complete',    -- Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ¬Ù…ÙŠØ¹
        'quality_approved',     -- Ø§Ø¬ØªÙŠØ§Ø² ÙØ­Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©
        'quality_rejected',     -- Ø±ÙØ¶ ÙØ­Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©
        'disposal',             -- ØªØ®Ù„Øµ
        'manual_transfer'       -- Ù†Ù‚Ù„ ÙŠØ¯ÙˆÙŠ
    ) NOT NULL,
    
    -- Ø§Ù„Ù…Ø±Ø¬Ø¹
    reference_type VARCHAR(50),
    reference_id UUID,
    
    -- Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    notes TEXT,
    
    -- Ù…Ù† Ù†ÙØ°
    transferred_by UUID REFERENCES employees(id),
    transferred_at TIMESTAMP DEFAULT NOW(),
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

# 17. ÙˆØ­Ø¯Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¯ÙˆÙŠØ± (Repair & Recycling)

## 17.1 Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

> **Ø§Ù„ØºØ±Ø¶:** Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„ØªØ§Ù„ÙØ© ÙˆØªØ¬Ù…ÙŠØ¹ Ù‚Ø·Ø¹ ØµØ§Ù„Ø­Ø© Ù…Ù† Ù‚Ø·Ø¹ ØªØ§Ù„ÙØ© Ù…ØªØ¹Ø¯Ø¯Ø©.

## 17.2 Ø¬Ø¯ÙˆÙ„ Ø£ÙˆØ§Ù…Ø± Ø¹Ù…Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (repair_work_orders)

```sql
CREATE TABLE repair_work_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- Ø±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±
    rwo_number VARCHAR(50) NOT NULL UNIQUE,
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„
    repair_type ENUM(
        'repair',      -- Ø¥ØµÙ„Ø§Ø­ Ù‚Ø·Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
        'assembly',    -- ØªØ¬Ù…ÙŠØ¹ Ù…Ù† Ù‚Ø·Ø¹ Ù…ØªØ¹Ø¯Ø¯Ø©
        'refurbish'    -- ØªØ¬Ø¯ÙŠØ¯ Ø´Ø§Ù…Ù„
    ) NOT NULL,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status ENUM(
        'pending',      -- Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        'in_progress',  -- Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°
        'completed',    -- Ù…ÙƒØªÙ…Ù„
        'failed',       -- ÙØ´Ù„
        'cancelled'     -- Ù…Ù„ØºÙŠ
    ) DEFAULT 'pending',
    
    -- Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© (Ù„Ù„Ø¥ØµÙ„Ø§Ø­ Ø£Ùˆ Ø§Ù„ØªØ¬Ù…ÙŠØ¹)
    input_items JSONB NOT NULL,
    -- Ù…Ø«Ø§Ù„: [{"serial_number_id": "...", "item_id": "...", "condition": "damaged"}]
    
    -- Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø©
    output_item_id UUID REFERENCES inventory_items(id),
    output_serial_number VARCHAR(100),
    output_condition VARCHAR(50),
    expected_efficiency DECIMAL(5, 2), -- Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (%)
    
    -- Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ
    labor_cost DECIMAL(12, 2) DEFAULT 0,
    material_cost DECIMAL(12, 2) DEFAULT 0,
    external_cost DECIMAL(12, 2) DEFAULT 0,
    total_cost DECIMAL(12, 2) GENERATED ALWAYS AS (labor_cost + material_cost + external_cost) STORED,
    
    -- Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯
    assigned_to UUID REFERENCES employees(id),
    assigned_at TIMESTAMP,
    
    -- Ø§Ù„ØªÙ†ÙÙŠØ°
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    
    -- Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    diagnosis TEXT,
    repair_notes TEXT,
    failure_reason TEXT,
    
    -- Ù…Ù† Ø£Ù†Ø´Ø£
    created_by UUID REFERENCES employees(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

## 17.3 Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (repair_materials)

```sql
CREATE TABLE repair_materials (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    repair_work_order_id UUID NOT NULL REFERENCES repair_work_orders(id) ON DELETE CASCADE,
    
    -- Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
    item_id UUID NOT NULL REFERENCES inventory_items(id),
    quantity DECIMAL(10, 2) NOT NULL,
    unit_cost DECIMAL(12, 2) NOT NULL,
    total_cost DECIMAL(12, 2) GENERATED ALWAYS AS (quantity * unit_cost) STORED,
    
    -- Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†
    from_location_id UUID REFERENCES storage_locations(id),
    
    used_at TIMESTAMP DEFAULT NOW()
);
```

## 17.4 Ø´Ø§Ø´Ø© Ù…Ø®Ø²Ù† Ø§Ù„ØªØ§Ù„Ù

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ”§ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø²Ù† Ø§Ù„ØªØ§Ù„Ù                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ø§Ù„Ù…Ø­Ø·Ø©: [Ù…Ø­Ø·Ø© Ø§Ù„Ø´Ù…Ø§Ù„ â–¼]              Ø§Ù„ÙØªØ±Ø©: [Ø¢Ø®Ø± 30 ÙŠÙˆÙ… â–¼]              â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²Ù†:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø·Ø¹ â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ â”‚   Ø®Ø±Ø¯Ø©      â”‚            â”‚
â”‚  â”‚     45       â”‚     28       â”‚      8       â”‚     9        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ” [Ø¨Ø­Ø«...]                    [ØªØµÙÙŠØ©: Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â–¼]                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â–¡ â”‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ â”‚ Ø§Ù„ØµÙ†Ù          â”‚ Ø§Ù„Ø­Ø§Ù„Ø©      â”‚ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙÙƒ    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â˜‘ â”‚ SN-12345       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­â”‚ 2024-12-10   â”‚   â”‚
â”‚  â”‚ â˜‘ â”‚ SN-12346       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­â”‚ 2024-12-08   â”‚   â”‚
â”‚  â”‚ â˜‘ â”‚ SN-12347       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­â”‚ 2024-12-05   â”‚   â”‚
â”‚  â”‚ â˜‘ â”‚ SN-12348       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­â”‚ 2024-12-01   â”‚   â”‚
â”‚  â”‚ â–¡ â”‚ SN-99001       â”‚ Ù…Ø¶Ø®Ø© ÙˆÙ‚ÙˆØ¯     â”‚ Ø®Ø±Ø¯Ø©        â”‚ 2024-12-12   â”‚   â”‚
â”‚  â”‚ â–¡ â”‚ SN-88002       â”‚ Ø¨Ø·Ø§Ø±ÙŠØ© 12V    â”‚ Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ 2024-12-11   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ØªÙ… ØªØ­Ø¯ÙŠØ¯: 4 Ù‚Ø·Ø¹ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹                                              â”‚
â”‚                                                                             â”‚
â”‚  [ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¥ØµÙ„Ø§Ø­]  [ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØªØ¬Ù…ÙŠØ¹]  [ğŸ—‘ï¸ Ù†Ù‚Ù„ Ù„Ù„Ø®Ø±Ø¯Ø©]             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 17.5 Ø´Ø§Ø´Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± ØªØ¬Ù…ÙŠØ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¹Ù…Ù„ ØªØ¬Ù…ÙŠØ¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„: ØªØ¬Ù…ÙŠØ¹ Ù…Ù† Ù‚Ø·Ø¹ Ù…ØªØ¹Ø¯Ø¯Ø©                                            â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                              Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø©                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ # â”‚ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ â”‚ Ø§Ù„ØµÙ†Ù          â”‚ Ø§Ù„Ø­Ø§Ù„Ø©       â”‚ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙØªØ±ÙŠØ©â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1 â”‚ SN-12345       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ 50 Ø±.Ø³       â”‚   â”‚
â”‚  â”‚ 2 â”‚ SN-12346       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ 50 Ø±.Ø³       â”‚   â”‚
â”‚  â”‚ 3 â”‚ SN-12347       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ 50 Ø±.Ø³       â”‚   â”‚
â”‚  â”‚ 4 â”‚ SN-12348       â”‚ ÙÙ„ØªØ± Ø²ÙŠØª CAT   â”‚ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­ â”‚ 50 Ø±.Ø³       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª: 200 Ø±.Ø³                                             â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                              Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø©                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  Ø§Ù„ØµÙ†Ù Ø§Ù„Ù†Ø§ØªØ¬: ÙÙ„ØªØ± Ø²ÙŠØª CAT (Ù…ÙØ¬Ù…Ù‘Ø¹)                                       â”‚
â”‚  Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯: [ASM-2024-001        ]                             â”‚
â”‚  Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: [50  ] %                                                â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  Ø§Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø¥Ù„Ù‰: [Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ - ÙÙ†ÙŠ ÙˆØ±Ø´Ø© â–¼]                                     â”‚
â”‚  Ù…Ù„Ø§Ø­Ø¸Ø§Øª: [ØªØ¬Ù…ÙŠØ¹ Ù…Ù† 4 ÙÙ„Ø§ØªØ± ØªØ§Ù„ÙØ© Ù„Ø¥Ù†ØªØ§Ø¬ ÙÙ„ØªØ± ÙˆØ§Ø­Ø¯ ØµØ§Ù„Ø­          ]        â”‚
â”‚                                                                             â”‚
â”‚  [âŒ Ø¥Ù„ØºØ§Ø¡]                                              [âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 17.6 Trigger Ù†Ù‚Ù„ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©

```sql
-- Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨Ù†Ø¬Ø§Ø­
CREATE OR REPLACE FUNCTION on_repair_complete()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.status = 'completed' AND OLD.status != 'completed' THEN
        -- Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©
        INSERT INTO item_serial_numbers (
            item_id, serial_number, status, condition,
            notes, current_location_id
        ) VALUES (
            NEW.output_item_id,
            NEW.output_serial_number,
            'available',
            'refurbished',
            CASE 
                WHEN NEW.repair_type = 'assembly' THEN 
                    'Ù…ÙØ¬Ù…Ù‘Ø¹ Ù…Ù† ' || jsonb_array_length(NEW.input_items) || ' ÙˆØ­Ø¯Ø§ØªØŒ ÙƒÙØ§Ø¡Ø© ' || NEW.expected_efficiency || '%'
                ELSE 
                    'Ù…ÙØµÙ„Ø­ØŒ ÙƒÙØ§Ø¡Ø© ' || NEW.expected_efficiency || '%'
            END,
            (SELECT id FROM storage_locations WHERE station_id = (
                SELECT station_id FROM storage_locations WHERE id = (
                    SELECT from_location_id FROM location_transfers 
                    WHERE reference_id = NEW.id LIMIT 1
                )
            ) AND location_type = 'refurbished')
        );
        
        -- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ø¥Ù„Ù‰ 'consumed'
        UPDATE item_serial_numbers 
        SET status = 'consumed', consumed_at = NOW()
        WHERE id IN (
            SELECT (value->>'serial_number_id')::UUID 
            FROM jsonb_array_elements(NEW.input_items)
        );
        
        -- Ø¥Ø¶Ø§ÙØ© ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù„Ø³Ø¬Ù„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ
        INSERT INTO component_lifecycle_log (
            serial_number_id, event_type, event_data
        ) VALUES (
            (SELECT id FROM item_serial_numbers WHERE serial_number = NEW.output_serial_number),
            'repair_cost',
            jsonb_build_object(
                'repair_work_order_id', NEW.id,
                'total_cost', NEW.total_cost,
                'repair_type', NEW.repair_type
            )
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_repair_complete
AFTER UPDATE ON repair_work_orders
FOR EACH ROW EXECUTE FUNCTION on_repair_complete();
```

## 17.7 APIs ÙˆØ­Ø¯Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/storage-locations` | Ù‚Ø§Ø¦Ù…Ø© Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† |
| GET | `/api/v1/storage-locations/:id/inventory` | Ù…Ø®Ø²ÙˆÙ† Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ÙŠÙ† |
| POST | `/api/v1/location-transfers` | Ù†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ |
| GET | `/api/v1/damaged-inventory` | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªØ§Ù„Ù |
| POST | `/api/v1/repair-work-orders` | Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø¥ØµÙ„Ø§Ø­/ØªØ¬Ù…ÙŠØ¹ |
| PUT | `/api/v1/repair-work-orders/:id` | ØªØ­Ø¯ÙŠØ« Ø£Ù…Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ |
| POST | `/api/v1/repair-work-orders/:id/complete` | Ø¥ÙƒÙ…Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ |
| GET | `/api/v1/repair-work-orders/:id/costs` | ØªÙƒØ§Ù„ÙŠÙ Ø£Ù…Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­ |



---

# ğŸ¢ ÙˆØ­Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø§Ø¯ÙŠØ© - ERP Core (Ù…Ù„Ù 38)

## ğŸ¯ Ø§Ù„ØºØ±Ø¶

Ø¨Ù†Ø§Ø¡ Ù†Ø¸Ø§Ù… Ù…Ø±ÙƒØ²ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ø¯ÙØ¹ØŒ Ù…Ø¹ Ø±Ù‚Ù…Ù†Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©.

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 32: ÙˆØ­Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©

### 32.1 ØªØ­Ø³ÙŠÙ†Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

#### Ø¬Ø¯ÙˆÙ„ Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_contacts`

```sql
CREATE TABLE supplier_contacts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    supplier_id UUID NOT NULL REFERENCES suppliers(id) ON DELETE CASCADE,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    name VARCHAR(255) NOT NULL,
    position VARCHAR(100),  -- Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
    department VARCHAR(100),
    
    -- ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
    phone VARCHAR(20),
    mobile VARCHAR(20),
    email VARCHAR(255),
    whatsapp VARCHAR(20),
    
    -- Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
    is_primary BOOLEAN DEFAULT FALSE,
    preferred_contact_method ENUM('phone', 'email', 'whatsapp') DEFAULT 'phone',
    
    -- Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    notes TEXT,
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_supplier_contacts_supplier ON supplier_contacts(supplier_id);
```

#### Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_bank_accounts`

```sql
CREATE TABLE supplier_bank_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    supplier_id UUID NOT NULL REFERENCES suppliers(id) ON DELETE CASCADE,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ
    bank_name VARCHAR(255) NOT NULL,
    bank_branch VARCHAR(255),
    account_name VARCHAR(255) NOT NULL,
    account_number VARCHAR(50) NOT NULL,
    iban VARCHAR(50),
    swift_code VARCHAR(20),
    
    -- Ø§Ù„Ø¹Ù…Ù„Ø©
    currency VARCHAR(3) DEFAULT 'SAR',
    
    -- Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
    is_primary BOOLEAN DEFAULT FALSE,
    
    -- Ø§Ù„ØªØ­Ù‚Ù‚
    verified_at TIMESTAMP,
    verified_by UUID REFERENCES employees(id),
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_supplier_bank_accounts_supplier ON supplier_bank_accounts(supplier_id);
```

#### Ø¬Ø¯ÙˆÙ„ ÙØ¦Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_categories`

```sql
CREATE TABLE supplier_categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    name VARCHAR(100) NOT NULL,
    description TEXT,
    
    -- Ø§Ù„ØªØµÙ†ÙŠÙ
    parent_id UUID REFERENCES supplier_categories(id),
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„ÙØ¦Ø© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
ALTER TABLE suppliers ADD COLUMN category_id UUID REFERENCES supplier_categories(id);

-- ÙØ¦Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
INSERT INTO supplier_categories (name, description) VALUES
    ('Ù…Ø¹Ø¯Ø§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©', 'Ù…ÙˆØ±Ø¯Ùˆ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©'),
    ('ÙƒÙŠØ¨Ù„Ø§Øª ÙˆØ£Ø³Ù„Ø§Ùƒ', 'Ù…ÙˆØ±Ø¯Ùˆ Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø³Ù„Ø§Ùƒ Ø¨Ø£Ù†ÙˆØ§Ø¹Ù‡Ø§'),
    ('Ù…Ø­ÙˆÙ„Ø§Øª', 'Ù…ÙˆØ±Ø¯Ùˆ Ø§Ù„Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©'),
    ('Ù‚Ø·Ø¹ ØºÙŠØ§Ø±', 'Ù…ÙˆØ±Ø¯Ùˆ Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± ÙˆØ§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª'),
    ('Ù…ÙˆØ§Ø¯ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠØ©', 'Ù…ÙˆØ±Ø¯Ùˆ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠØ© ÙˆØ§Ù„Ø²ÙŠÙˆØª'),
    ('Ø®Ø¯Ù…Ø§Øª', 'Ù…Ù‚Ø¯Ù…Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©'),
    ('Ù…ØªÙ†ÙˆØ¹', 'Ù…ÙˆØ±Ø¯ÙˆÙ† Ù…ØªÙ†ÙˆØ¹ÙˆÙ†');
```

### 32.2 ØªØ­Ø³ÙŠÙ†Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ (Purchase Request)

#### Ø¬Ø¯ÙˆÙ„ Ø³ÙŠØ± Ø¹Ù…Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡: `purchase_request_workflow`

```sql
CREATE TABLE purchase_request_workflow (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    request_id UUID NOT NULL REFERENCES purchase_requests(id),
    
    -- Ø®Ø·ÙˆØ© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„
    step_number INT NOT NULL,
    step_name VARCHAR(100) NOT NULL,
    
    -- Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
    approver_id UUID REFERENCES employees(id),
    approver_role VARCHAR(100),  -- Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†ØŒ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§ØªØŒ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ
    
    -- Ø§Ù„Ù‚Ø±Ø§Ø±
    status ENUM('pending', 'approved', 'rejected', 'skipped') DEFAULT 'pending',
    decision_date TIMESTAMP,
    comments TEXT,
    
    -- Ø§Ù„Ø­Ø¯ÙˆØ¯
    amount_limit DECIMAL(15,2),  -- Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pr_workflow_request ON purchase_request_workflow(request_id);
```

#### Trigger: Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

```sql
CREATE OR REPLACE FUNCTION auto_create_purchase_request()
RETURNS TRIGGER AS $$
DECLARE
    item_record RECORD;
    new_request_id UUID;
    request_number VARCHAR(20);
BEGIN
    -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªØ­Øª Ø­Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨
    SELECT i.*, inv.quantity_on_hand
    INTO item_record
    FROM items i
    JOIN inventory inv ON i.id = inv.item_id
    WHERE inv.id = NEW.id
      AND inv.quantity_on_hand <= i.reorder_level
      AND i.auto_reorder = TRUE;
    
    IF FOUND THEN
        -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ø¹Ù„Ù‚ Ù„Ù†ÙØ³ Ø§Ù„ØµÙ†Ù
        IF NOT EXISTS (
            SELECT 1 FROM purchase_requests pr
            JOIN purchase_request_items pri ON pr.id = pri.request_id
            WHERE pri.item_id = item_record.id
              AND pr.status IN ('draft', 'pending', 'approved')
        ) THEN
            -- Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
            SELECT 'PR-' || TO_CHAR(NOW(), 'YYYY') || '-' || 
                   LPAD(COALESCE(MAX(CAST(SUBSTRING(request_number FROM 9) AS INT)), 0) + 1, 4, '0')
            INTO request_number
            FROM purchase_requests
            WHERE request_number LIKE 'PR-' || TO_CHAR(NOW(), 'YYYY') || '-%';
            
            -- Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡
            INSERT INTO purchase_requests (
                request_number, warehouse_id, requested_by, status, 
                priority, notes, is_auto_generated
            ) VALUES (
                request_number,
                NEW.warehouse_id,
                (SELECT id FROM employees WHERE role = 'inventory_manager' LIMIT 1),
                'draft',
                'normal',
                'Ø·Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ - Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªØ­Øª Ø­Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨',
                TRUE
            ) RETURNING id INTO new_request_id;
            
            -- Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ù„Ù„Ø·Ù„Ø¨
            INSERT INTO purchase_request_items (
                request_id, item_id, requested_quantity, unit_id, notes
            ) VALUES (
                new_request_id,
                item_record.id,
                item_record.reorder_quantity,
                item_record.unit_id,
                'ÙƒÙ…ÙŠØ© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©'
            );
            
            -- Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
            INSERT INTO notifications (
                user_id, title, message, type, reference_type, reference_id
            )
            SELECT id, 
                   'Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯',
                   'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙ†Ù: ' || item_record.name,
                   'info',
                   'purchase_request',
                   new_request_id
            FROM users WHERE role IN ('inventory_manager', 'procurement_manager');
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_auto_purchase_request
    AFTER UPDATE OF quantity_on_hand ON inventory
    FOR EACH ROW
    WHEN (NEW.quantity_on_hand < OLD.quantity_on_hand)
    EXECUTE FUNCTION auto_create_purchase_request();

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ù„Ù„Ø£ØµÙ†Ø§Ù
ALTER TABLE items ADD COLUMN IF NOT EXISTS reorder_level DECIMAL(15,3) DEFAULT 0;
ALTER TABLE items ADD COLUMN IF NOT EXISTS reorder_quantity DECIMAL(15,3) DEFAULT 0;
ALTER TABLE items ADD COLUMN IF NOT EXISTS auto_reorder BOOLEAN DEFAULT FALSE;

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
ALTER TABLE purchase_requests ADD COLUMN IF NOT EXISTS is_auto_generated BOOLEAN DEFAULT FALSE;
```

### 32.3 ØªØ­Ø³ÙŠÙ†Ø§Øª Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Purchase Order)

#### Ø¬Ø¯ÙˆÙ„ Ø´Ø±ÙˆØ· Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: `purchase_order_terms`

```sql
CREATE TABLE purchase_order_terms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES purchase_orders(id) ON DELETE CASCADE,
    
    -- Ù†ÙˆØ¹ Ø§Ù„Ø´Ø±Ø·
    term_type ENUM(
        'payment', 'delivery', 'warranty', 'penalty', 'discount', 'other'
    ) NOT NULL,
    
    -- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø±Ø·
    description TEXT NOT NULL,
    
    -- Ø§Ù„Ù‚ÙŠÙ… (Ø¥Ù† ÙˆØ¬Ø¯Øª)
    value DECIMAL(15,2),
    percentage DECIMAL(5,2),
    
    -- Ø§Ù„ØªØ±ØªÙŠØ¨
    display_order INT DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### Function: Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª PDF Ù„Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡

```sql
CREATE OR REPLACE FUNCTION generate_purchase_order_data(p_order_id UUID)
RETURNS JSONB AS $$
DECLARE
    result JSONB;
BEGIN
    SELECT jsonb_build_object(
        'order_info', jsonb_build_object(
            'order_number', po.order_number,
            'order_date', po.order_date,
            'expected_delivery', po.expected_delivery_date,
            'status', po.status
        ),
        'supplier', jsonb_build_object(
            'name', s.name,
            'tax_number', s.tax_number,
            'address', s.address,
            'phone', s.phone,
            'email', s.email
        ),
        'contact', (
            SELECT jsonb_build_object(
                'name', sc.name,
                'phone', sc.phone,
                'email', sc.email
            )
            FROM supplier_contacts sc
            WHERE sc.supplier_id = s.id AND sc.is_primary = TRUE
            LIMIT 1
        ),
        'items', (
            SELECT jsonb_agg(jsonb_build_object(
                'item_code', i.code,
                'item_name', i.name,
                'quantity', poi.quantity,
                'unit', u.name,
                'unit_price', poi.unit_price,
                'discount', poi.discount_amount,
                'tax', poi.tax_amount,
                'total', poi.total_amount
            ))
            FROM purchase_order_items poi
            JOIN items i ON poi.item_id = i.id
            JOIN units u ON poi.unit_id = u.id
            WHERE poi.order_id = po.id
        ),
        'totals', jsonb_build_object(
            'subtotal', po.subtotal,
            'discount', po.discount_amount,
            'tax', po.tax_amount,
            'total', po.total_amount
        ),
        'terms', (
            SELECT jsonb_agg(jsonb_build_object(
                'type', pot.term_type,
                'description', pot.description
            ) ORDER BY pot.display_order)
            FROM purchase_order_terms pot
            WHERE pot.order_id = po.id
        ),
        'company', jsonb_build_object(
            'name', 'Ø´Ø±ÙƒØ© Ø§Ù„Ø­Ø¯ÙŠØ¯Ø© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡',
            'address', 'Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©ØŒ Ø§Ù„ÙŠÙ…Ù†',
            'phone', '+967 3 123456',
            'email', 'info@hodeidah-elec.com',
            'tax_number', '123456789'
        )
    )
    INTO result
    FROM purchase_orders po
    JOIN suppliers s ON po.supplier_id = s.id
    WHERE po.id = p_order_id;
    
    RETURN result;
END;
$$ LANGUAGE plpgsql;
```

#### Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: `purchase_order_sends`

```sql
CREATE TABLE purchase_order_sends (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES purchase_orders(id),
    
    -- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    send_method ENUM('email', 'fax', 'print', 'portal') NOT NULL,
    
    -- Ø§Ù„ØªÙØ§ØµÙŠÙ„
    recipient_email VARCHAR(255),
    recipient_name VARCHAR(255),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status ENUM('pending', 'sent', 'delivered', 'failed') DEFAULT 'pending',
    sent_at TIMESTAMP,
    delivered_at TIMESTAMP,
    
    -- Ø§Ù„Ù…Ù„Ù
    pdf_file_path VARCHAR(500),
    
    -- Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    error_message TEXT,
    
    -- Ø§Ù„Ù…Ø±Ø³Ù„
    sent_by UUID REFERENCES employees(id),
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_po_sends_order ON purchase_order_sends(order_id);
```

### 32.4 ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ (GRN)

#### Ø¬Ø¯ÙˆÙ„ ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: `grn_quality_checks`

```sql
CREATE TABLE grn_quality_checks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    grn_id UUID NOT NULL REFERENCES goods_received_notes(id),
    grn_item_id UUID NOT NULL REFERENCES grn_items(id),
    
    -- Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙØ­Øµ
    check_type ENUM(
        'visual', 'measurement', 'functionality', 'documentation', 'packaging'
    ) NOT NULL,
    check_description VARCHAR(255) NOT NULL,
    
    -- Ø§Ù„Ù†ØªÙŠØ¬Ø©
    result ENUM('pass', 'fail', 'conditional') NOT NULL,
    notes TEXT,
    
    -- Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (ØµÙˆØ± Ø§Ù„ÙØ­Øµ)
    attachments JSONB,  -- [{file_path, description}]
    
    -- Ø§Ù„ÙØ§Ø­Øµ
    checked_by UUID NOT NULL REFERENCES employees(id),
    checked_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_grn_quality_grn ON grn_quality_checks(grn_id);
```

#### Trigger: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…

```sql
CREATE OR REPLACE FUNCTION process_grn_confirmation()
RETURNS TRIGGER AS $$
DECLARE
    item_record RECORD;
    journal_entry_id UUID;
    total_value DECIMAL(15,2) := 0;
BEGIN
    -- ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    IF NEW.status = 'confirmed' AND OLD.status != 'confirmed' THEN
        
        -- 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„ÙƒÙ„ ØµÙ†Ù
        FOR item_record IN 
            SELECT gi.*, poi.unit_price, i.name as item_name
            FROM grn_items gi
            JOIN purchase_order_items poi ON gi.po_item_id = poi.id
            JOIN items i ON gi.item_id = i.id
            WHERE gi.grn_id = NEW.id
        LOOP
            -- ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            UPDATE inventory 
            SET quantity_on_hand = quantity_on_hand + item_record.received_quantity,
                last_received_date = NOW(),
                updated_at = NOW()
            WHERE item_id = item_record.item_id 
              AND warehouse_id = NEW.warehouse_id;
            
            -- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø±ÙƒØ© Ù…Ø®Ø²ÙˆÙ†
            INSERT INTO inventory_movements (
                item_id, warehouse_id, movement_type, quantity,
                unit_cost, reference_type, reference_id, notes
            ) VALUES (
                item_record.item_id,
                NEW.warehouse_id,
                'receipt',
                item_record.received_quantity,
                item_record.unit_price,
                'grn',
                NEW.id,
                'Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† GRN: ' || NEW.grn_number
            );
            
            total_value := total_value + (item_record.received_quantity * item_record.unit_price);
        END LOOP;
        
        -- 2. Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ù…Ø­Ø§Ø³Ø¨ÙŠ
        INSERT INTO journal_entries (
            entry_date, description, reference_type, reference_id,
            total_debit, total_credit, status, created_by
        ) VALUES (
            NOW(),
            'Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø¶Ø§Ø¦Ø¹ - ' || NEW.grn_number,
            'grn',
            NEW.id,
            total_value,
            total_value,
            'posted',
            NEW.received_by
        ) RETURNING id INTO journal_entry_id;
        
        -- Ù‚ÙŠØ¯ Ù…Ø¯ÙŠÙ†: Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        INSERT INTO journal_entry_lines (
            entry_id, account_id, debit_amount, credit_amount, description
        ) VALUES (
            journal_entry_id,
            (SELECT id FROM accounts WHERE code = '1300'),  -- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            total_value,
            0,
            'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†'
        );
        
        -- Ù‚ÙŠØ¯ Ø¯Ø§Ø¦Ù†: Ø¨Ø¶Ø§Ø¹Ø© Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚
        INSERT INTO journal_entry_lines (
            entry_id, account_id, debit_amount, credit_amount, description
        ) VALUES (
            journal_entry_id,
            (SELECT id FROM accounts WHERE code = '2100'),  -- Ø¨Ø¶Ø§Ø¹Ø© Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚
            0,
            total_value,
            'ØªØ³ÙˆÙŠØ© Ø¨Ø¶Ø§Ø¹Ø© Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚'
        );
        
        -- 3. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
        UPDATE purchase_orders po
        SET status = CASE 
            WHEN (
                SELECT SUM(gi.received_quantity) 
                FROM grn_items gi 
                JOIN goods_received_notes grn ON gi.grn_id = grn.id
                WHERE grn.purchase_order_id = po.id AND grn.status = 'confirmed'
            ) >= (
                SELECT SUM(poi.quantity) 
                FROM purchase_order_items poi 
                WHERE poi.order_id = po.id
            ) THEN 'fully_received'
            ELSE 'partially_received'
        END,
        updated_at = NOW()
        WHERE id = NEW.purchase_order_id;
        
        -- 4. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø­Ø§Ø³Ø¨
        INSERT INTO notifications (
            user_id, title, message, type, reference_type, reference_id
        )
        SELECT id,
               'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø¶Ø§Ø¦Ø¹',
               'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ Ù…Ù† ' || NEW.grn_number || ' - Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…ØªÙˆÙ‚Ø¹Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹',
               'info',
               'grn',
               NEW.id
        FROM users WHERE role = 'accountant';
        
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_process_grn_confirmation
    AFTER UPDATE OF status ON goods_received_notes
    FOR EACH ROW EXECUTE FUNCTION process_grn_confirmation();
```

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 33: ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©

### 33.1 Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© (3-Way Matching)

#### Ø¬Ø¯ÙˆÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±: `invoice_matching`

```sql
CREATE TABLE invoice_matching (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    invoice_id UUID NOT NULL REFERENCES purchase_invoices(id),
    
    -- Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
    purchase_order_id UUID REFERENCES purchase_orders(id),
    grn_id UUID REFERENCES goods_received_notes(id),
    
    -- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    po_match_status ENUM('matched', 'partial', 'mismatch', 'not_found') DEFAULT 'not_found',
    grn_match_status ENUM('matched', 'partial', 'mismatch', 'not_found') DEFAULT 'not_found',
    amount_match_status ENUM('matched', 'mismatch', 'tolerance') DEFAULT 'mismatch',
    
    -- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
    po_differences JSONB,  -- [{item_id, po_qty, invoice_qty, po_price, invoice_price}]
    grn_differences JSONB,  -- [{item_id, grn_qty, invoice_qty}]
    amount_difference DECIMAL(15,2) DEFAULT 0,
    
    -- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    overall_status ENUM('approved', 'pending_review', 'rejected') DEFAULT 'pending_review',
    
    -- Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
    reviewed_by UUID REFERENCES employees(id),
    reviewed_at TIMESTAMP,
    review_notes TEXT,
    
    -- Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ®Ø°
    action_taken ENUM(
        'auto_approved', 'manual_approved', 'request_credit_note', 
        'reject_invoice', 'accept_with_adjustment'
    ),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_invoice_matching_invoice ON invoice_matching(invoice_id);
CREATE INDEX idx_invoice_matching_status ON invoice_matching(overall_status);
```

#### Ø¬Ø¯ÙˆÙ„ ØªÙØ§ØµÙŠÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯: `invoice_matching_items`

```sql
CREATE TABLE invoice_matching_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    matching_id UUID NOT NULL REFERENCES invoice_matching(id) ON DELETE CASCADE,
    
    -- Ø§Ù„Ø¨Ù†ÙˆØ¯
    invoice_item_id UUID NOT NULL,
    po_item_id UUID REFERENCES purchase_order_items(id),
    grn_item_id UUID REFERENCES grn_items(id),
    
    -- Ø§Ù„ÙƒÙ…ÙŠØ§Øª
    invoice_quantity DECIMAL(15,3) NOT NULL,
    po_quantity DECIMAL(15,3),
    grn_quantity DECIMAL(15,3),
    
    -- Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    invoice_price DECIMAL(15,2) NOT NULL,
    po_price DECIMAL(15,2),
    
    -- Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª
    quantity_variance DECIMAL(15,3) DEFAULT 0,
    price_variance DECIMAL(15,2) DEFAULT 0,
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    match_status ENUM('matched', 'quantity_mismatch', 'price_mismatch', 'both_mismatch') DEFAULT 'matched',
    
    notes TEXT
);

CREATE INDEX idx_matching_items_matching ON invoice_matching_items(matching_id);
```

#### Function: ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©

```sql
CREATE OR REPLACE FUNCTION perform_three_way_matching(p_invoice_id UUID)
RETURNS UUID AS $$
DECLARE
    matching_id UUID;
    invoice_record RECORD;
    po_record RECORD;
    grn_record RECORD;
    item_record RECORD;
    po_match VARCHAR(20) := 'not_found';
    grn_match VARCHAR(20) := 'not_found';
    amount_match VARCHAR(20) := 'mismatch';
    overall VARCHAR(20) := 'pending_review';
    tolerance_percentage DECIMAL := 0.02;  -- 2% tolerance
    po_differences JSONB := '[]'::JSONB;
    grn_differences JSONB := '[]'::JSONB;
    amount_diff DECIMAL(15,2) := 0;
BEGIN
    -- Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    SELECT * INTO invoice_record FROM purchase_invoices WHERE id = p_invoice_id;
    
    -- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
    SELECT po.* INTO po_record
    FROM purchase_orders po
    WHERE po.supplier_id = invoice_record.supplier_id
      AND po.status IN ('sent', 'partially_received', 'fully_received')
      AND ABS(po.total_amount - invoice_record.total_amount) / po.total_amount <= tolerance_percentage
    ORDER BY ABS(po.total_amount - invoice_record.total_amount)
    LIMIT 1;
    
    IF FOUND THEN
        -- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        SELECT grn.* INTO grn_record
        FROM goods_received_notes grn
        WHERE grn.purchase_order_id = po_record.id
          AND grn.status = 'confirmed'
        LIMIT 1;
        
        -- ÙØ­Øµ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
        po_match := 'matched';
        FOR item_record IN
            SELECT 
                pii.item_id,
                pii.quantity as invoice_qty,
                pii.unit_price as invoice_price,
                poi.quantity as po_qty,
                poi.unit_price as po_price
            FROM purchase_invoice_items pii
            LEFT JOIN purchase_order_items poi ON poi.order_id = po_record.id 
                AND poi.item_id = pii.item_id
            WHERE pii.invoice_id = p_invoice_id
        LOOP
            IF item_record.po_qty IS NULL OR 
               item_record.invoice_qty != item_record.po_qty OR
               item_record.invoice_price != item_record.po_price THEN
                po_match := 'partial';
                po_differences := po_differences || jsonb_build_object(
                    'item_id', item_record.item_id,
                    'invoice_qty', item_record.invoice_qty,
                    'po_qty', item_record.po_qty,
                    'invoice_price', item_record.invoice_price,
                    'po_price', item_record.po_price
                );
            END IF;
        END LOOP;
        
        -- ÙØ­Øµ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        IF grn_record.id IS NOT NULL THEN
            grn_match := 'matched';
            FOR item_record IN
                SELECT 
                    pii.item_id,
                    pii.quantity as invoice_qty,
                    gi.received_quantity as grn_qty
                FROM purchase_invoice_items pii
                LEFT JOIN grn_items gi ON gi.grn_id = grn_record.id 
                    AND gi.item_id = pii.item_id
                WHERE pii.invoice_id = p_invoice_id
            LOOP
                IF item_record.grn_qty IS NULL OR 
                   item_record.invoice_qty != item_record.grn_qty THEN
                    grn_match := 'partial';
                    grn_differences := grn_differences || jsonb_build_object(
                        'item_id', item_record.item_id,
                        'invoice_qty', item_record.invoice_qty,
                        'grn_qty', item_record.grn_qty
                    );
                END IF;
            END LOOP;
        END IF;
        
        -- ÙØ­Øµ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø¨Ù„Øº
        amount_diff := invoice_record.total_amount - po_record.total_amount;
        IF amount_diff = 0 THEN
            amount_match := 'matched';
        ELSIF ABS(amount_diff) / po_record.total_amount <= tolerance_percentage THEN
            amount_match := 'tolerance';
        ELSE
            amount_match := 'mismatch';
        END IF;
        
        -- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        IF po_match = 'matched' AND grn_match = 'matched' AND amount_match IN ('matched', 'tolerance') THEN
            overall := 'approved';
        ELSIF po_match = 'mismatch' OR grn_match = 'mismatch' OR amount_match = 'mismatch' THEN
            overall := 'pending_review';
        END IF;
    END IF;
    
    -- Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    INSERT INTO invoice_matching (
        invoice_id, purchase_order_id, grn_id,
        po_match_status, grn_match_status, amount_match_status,
        po_differences, grn_differences, amount_difference,
        overall_status,
        action_taken
    ) VALUES (
        p_invoice_id,
        po_record.id,
        grn_record.id,
        po_match,
        grn_match,
        amount_match,
        po_differences,
        grn_differences,
        amount_diff,
        overall,
        CASE WHEN overall = 'approved' THEN 'auto_approved' ELSE NULL END
    ) RETURNING id INTO matching_id;
    
    -- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    UPDATE purchase_invoices
    SET matching_status = overall,
        updated_at = NOW()
    WHERE id = p_invoice_id;
    
    -- Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©
    IF overall = 'pending_review' THEN
        INSERT INTO notifications (
            user_id, title, message, type, reference_type, reference_id, priority
        )
        SELECT id,
               'ÙØ§ØªÙˆØ±Ø© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©',
               'Ø§Ù„ÙØ§ØªÙˆØ±Ø© ' || invoice_record.invoice_number || ' ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© - ÙØ±ÙˆÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©',
               'warning',
               'invoice_matching',
               matching_id,
               'high'
        FROM users WHERE role = 'accountant';
    END IF;
    
    RETURN matching_id;
END;
$$ LANGUAGE plpgsql;

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙÙˆØ§ØªÙŠØ±
ALTER TABLE purchase_invoices ADD COLUMN IF NOT EXISTS matching_status 
    VARCHAR(20) DEFAULT 'pending';
```

### 33.2 Ø¯ÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

#### Ø¬Ø¯ÙˆÙ„ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù: `payment_vouchers`

```sql
CREATE TABLE payment_vouchers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    business_id UUID NOT NULL REFERENCES businesses(id),
    
    -- Ø±Ù‚Ù… Ø§Ù„Ø³Ù†Ø¯
    voucher_number VARCHAR(20) NOT NULL UNIQUE,
    voucher_date DATE NOT NULL DEFAULT CURRENT_DATE,
    
    -- Ø§Ù„Ù…ÙˆØ±Ø¯
    supplier_id UUID NOT NULL REFERENCES suppliers(id),
    
    -- Ø§Ù„Ù…Ø¨Ù„Øº
    total_amount DECIMAL(15,2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'SAR',
    exchange_rate DECIMAL(10,4) DEFAULT 1,
    
    -- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
    payment_method VARCHAR(20) NOT NULL, -- bank_transfer, check, cash, credit_card
    
    -- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹
    bank_account_id UUID REFERENCES supplier_bank_accounts(id),
    check_number VARCHAR(50),
    check_date DATE,
    transaction_reference VARCHAR(100),
    
    -- Ø§Ù„Ø­Ø§Ù„Ø©
    status VARCHAR(20) DEFAULT 'draft', -- draft, pending_approval, approved, paid, cancelled
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    due_date DATE,
    payment_date DATE,
    
    -- Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
    prepared_by UUID NOT NULL REFERENCES employees(id),
    approved_by UUID REFERENCES employees(id),
    approved_at TIMESTAMP,
    paid_by UUID REFERENCES employees(id),
    paid_at TIMESTAMP,
    
    -- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    notes TEXT,
    
    -- Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
    journal_entry_id UUID REFERENCES journal_entries(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_payment_vouchers_supplier ON payment_vouchers(supplier_id);
CREATE INDEX idx_payment_vouchers_status ON payment_vouchers(status);
CREATE INDEX idx_payment_vouchers_due_date ON payment_vouchers(due_date);
```

#### Ø¬Ø¯ÙˆÙ„ ØªÙØ§ØµÙŠÙ„ Ø³Ù†Ø¯ Ø§Ù„ØµØ±Ù: `payment_voucher_items`

```sql
CREATE TABLE payment_voucher_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    voucher_id UUID NOT NULL REFERENCES payment_vouchers(id) ON DELETE CASCADE,
    
    -- Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    invoice_id UUID NOT NULL REFERENCES purchase_invoices(id),
    
    -- Ø§Ù„Ù…Ø¨Ù„Øº
    invoice_amount DECIMAL(15,2) NOT NULL,  -- Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
    paid_amount DECIMAL(15,2) NOT NULL,  -- Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
    discount_amount DECIMAL(15,2) DEFAULT 0,  -- Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ±
    
    -- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    notes TEXT
);

CREATE INDEX idx_pv_items_voucher ON payment_voucher_items(voucher_id);
CREATE INDEX idx_pv_items_invoice ON payment_voucher_items(invoice_id);
```

#### Trigger: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ

```sql
CREATE OR REPLACE FUNCTION process_payment_voucher()
RETURNS TRIGGER AS $$
DECLARE
    journal_entry_id UUID;
    supplier_record RECORD;
    item_record RECORD;
BEGIN
    -- Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
    IF NEW.status = 'paid' AND OLD.status != 'paid' THEN
        
        -- Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯
        SELECT * INTO supplier_record FROM suppliers WHERE id = NEW.supplier_id;
        
        -- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
        INSERT INTO journal_entries (
            entry_date, description, reference_type, reference_id,
            total_debit, total_credit, status, created_by
        ) VALUES (
            NEW.payment_date,
            'Ø³Ø¯Ø§Ø¯ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯: ' || supplier_record.name || ' - ' || NEW.voucher_number,
            'payment_voucher',
            NEW.id,
            NEW.total_amount,
            NEW.total_amount,
            'posted',
            NEW.paid_by
        ) RETURNING id INTO journal_entry_id;
        
        -- Ù‚ÙŠØ¯ Ù…Ø¯ÙŠÙ†: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯ (ØªØ®ÙÙŠØ¶ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…)
        INSERT INTO journal_entry_lines (
            entry_id, account_id, debit_amount, credit_amount, description
        ) VALUES (
            journal_entry_id,
            (SELECT id FROM accounts WHERE code = '2000'),  -- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
            NEW.total_amount,
            0,
            'Ø³Ø¯Ø§Ø¯ Ù„Ù„Ù…ÙˆØ±Ø¯: ' || supplier_record.name
        );
        
        -- Ù‚ÙŠØ¯ Ø¯Ø§Ø¦Ù†: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
        INSERT INTO journal_entry_lines (
            entry_id, account_id, debit_amount, credit_amount, description
        ) VALUES (
            journal_entry_id,
            CASE NEW.payment_method
                WHEN 'bank_transfer' THEN (SELECT id FROM accounts WHERE code = '1100')
                WHEN 'check' THEN (SELECT id FROM accounts WHERE code = '1100')
                WHEN 'cash' THEN (SELECT id FROM accounts WHERE code = '1000')
                ELSE (SELECT id FROM accounts WHERE code = '1100')
            END,
            0,
            NEW.total_amount,
            'Ø¯ÙØ¹ Ø¨Ù€ ' || NEW.payment_method
        );
        
        -- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù†Ø¯ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯
        NEW.journal_entry_id := journal_entry_id;
        NEW.paid_at := NOW();
        
        -- ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
        FOR item_record IN 
            SELECT * FROM payment_voucher_items WHERE voucher_id = NEW.id
        LOOP
            UPDATE purchase_invoices
            SET paid_amount = paid_amount + item_record.paid_amount,
                payment_status = CASE 
                    WHEN paid_amount + item_record.paid_amount >= total_amount THEN 'paid'
                    ELSE 'partial'
                END,
                last_payment_date = NEW.payment_date,
                updated_at = NOW()
            WHERE id = item_record.invoice_id;
        END LOOP;
        
        -- ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙˆØ±Ø¯
        UPDATE suppliers
        SET current_balance = current_balance - NEW.total_amount,
            last_payment_date = NEW.payment_date,
            updated_at = NOW()
        WHERE id = NEW.supplier_id;
        
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_process_payment_voucher
    BEFORE UPDATE OF status ON payment_vouchers
    FOR EACH ROW EXECUTE FUNCTION process_payment_voucher();

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ù„Ù„ÙÙˆØ§ØªÙŠØ±
ALTER TABLE purchase_invoices ADD COLUMN IF NOT EXISTS paid_amount DECIMAL(15,2) DEFAULT 0;
ALTER TABLE purchase_invoices ADD COLUMN IF NOT EXISTS payment_status VARCHAR(20) DEFAULT 'unpaid';
ALTER TABLE purchase_invoices ADD COLUMN IF NOT EXISTS last_payment_date DATE;

-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS current_balance DECIMAL(15,2) DEFAULT 0;
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS last_payment_date DATE;
```

#### View: Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª

```sql
CREATE OR REPLACE VIEW payment_dashboard AS
SELECT 
    -- Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
    (SELECT COUNT(*) FROM payment_vouchers WHERE status = 'pending_approval') as pending_count,
    (SELECT COALESCE(SUM(total_amount), 0) FROM payment_vouchers WHERE status = 'pending_approval') as pending_amount,
    
    -- Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…
    (SELECT COUNT(*) FROM payment_vouchers WHERE status = 'approved' AND due_date = CURRENT_DATE) as due_today_count,
    (SELECT COALESCE(SUM(total_amount), 0) FROM payment_vouchers WHERE status = 'approved' AND due_date = CURRENT_DATE) as due_today_amount,
    
    -- Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
    (SELECT COUNT(*) FROM payment_vouchers WHERE status = 'approved' AND due_date < CURRENT_DATE) as overdue_count,
    (SELECT COALESCE(SUM(total_amount), 0) FROM payment_vouchers WHERE status = 'approved' AND due_date < CURRENT_DATE) as overdue_amount,
    
    -- Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
    (SELECT COUNT(*) FROM payment_vouchers WHERE status = 'paid' AND DATE_TRUNC('month', payment_date) = DATE_TRUNC('month', CURRENT_DATE)) as paid_this_month_count,
    (SELECT COALESCE(SUM(total_amount), 0) FROM payment_vouchers WHERE status = 'paid' AND DATE_TRUNC('month', payment_date) = DATE_TRUNC('month', CURRENT_DATE)) as paid_this_month_amount;
```

### 33.3 Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø­ÙŠØ©

#### View: ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯

```sql
CREATE OR REPLACE VIEW supplier_statement AS
SELECT 
    s.id as supplier_id,
    s.name as supplier_name,
    s.code as supplier_code,
    
    -- Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ
    0 as opening_balance,
    
    -- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
    COALESCE((
        SELECT SUM(total_amount) 
        FROM purchase_invoices 
        WHERE supplier_id = s.id AND status != 'cancelled'
    ), 0) as total_invoices,
    
    -- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙØ¹Ø§Øª
    COALESCE((
        SELECT SUM(total_amount) 
        FROM payment_vouchers 
        WHERE supplier_id = s.id AND status = 'paid'
    ), 0) as total_payments,
    
    -- Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
    s.current_balance,
    
    -- Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©
    COALESCE((
        SELECT SUM(total_amount - paid_amount) 
        FROM purchase_invoices 
        WHERE supplier_id = s.id AND payment_status != 'paid'
    ), 0) as outstanding_amount,
    
    -- Ù…ØªÙˆØ³Ø· Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙØ¹
    COALESCE((
        SELECT AVG(EXTRACT(DAY FROM (pv.payment_date - pi.invoice_date)))
        FROM payment_voucher_items pvi
        JOIN payment_vouchers pv ON pvi.voucher_id = pv.id
        JOIN purchase_invoices pi ON pvi.invoice_id = pi.id
        WHERE pv.supplier_id = s.id AND pv.status = 'paid'
    ), 0) as avg_payment_days,
    
    -- Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø©
    (SELECT MAX(invoice_date) FROM purchase_invoices WHERE supplier_id = s.id) as last_invoice_date,
    
    -- Ø¢Ø®Ø± Ø¯ÙØ¹Ø©
    s.last_payment_date

FROM suppliers s;
```

#### Function: ØªÙ‚Ø±ÙŠØ± Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ

```sql
CREATE OR REPLACE FUNCTION get_supplier_transactions(
    p_supplier_id UUID,
    p_date_from DATE DEFAULT NULL,
    p_date_to DATE DEFAULT NULL
) RETURNS TABLE (
    transaction_date DATE,
    transaction_type VARCHAR(50),
    reference_number VARCHAR(50),
    description TEXT,
    debit_amount DECIMAL(15,2),
    credit_amount DECIMAL(15,2),
    running_balance DECIMAL(15,2)
) AS $$
BEGIN
    RETURN QUERY
    WITH transactions AS (
        -- Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Ø¯Ø§Ø¦Ù† - Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…)
        SELECT 
            pi.invoice_date as trans_date,
            'ÙØ§ØªÙˆØ±Ø©'::VARCHAR(50) as trans_type,
            pi.invoice_number::VARCHAR(50) as ref_number,
            'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª'::TEXT as descr,
            0::DECIMAL(15,2) as debit,
            pi.total_amount as credit
        FROM purchase_invoices pi
        WHERE pi.supplier_id = p_supplier_id
          AND pi.status != 'cancelled'
          AND (p_date_from IS NULL OR pi.invoice_date >= p_date_from)
          AND (p_date_to IS NULL OR pi.invoice_date <= p_date_to)
        
        UNION ALL
        
        -- Ø§Ù„Ø¯ÙØ¹Ø§Øª (Ù…Ø¯ÙŠÙ† - ØªØ®ÙÙŠØ¶ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…)
        SELECT 
            pv.payment_date as trans_date,
            'Ø¯ÙØ¹Ø©'::VARCHAR(50) as trans_type,
            pv.voucher_number::VARCHAR(50) as ref_number,
            'Ø³Ø¯Ø§Ø¯ ÙØ§ØªÙˆØ±Ø©'::TEXT as descr,
            pv.total_amount as debit,
            0::DECIMAL(15,2) as credit
        FROM payment_vouchers pv
        WHERE pv.supplier_id = p_supplier_id
          AND pv.status = 'paid'
          AND (p_date_from IS NULL OR pv.payment_date >= p_date_from)
          AND (p_date_to IS NULL OR pv.payment_date <= p_date_to)
        
        ORDER BY trans_date, trans_type
    )
    SELECT 
        t.trans_date,
        t.trans_type,
        t.ref_number,
        t.descr,
        t.debit,
        t.credit,
        SUM(t.credit - t.debit) OVER (ORDER BY t.trans_date, t.trans_type) as running_bal
    FROM transactions t;
END;
$$ LANGUAGE plpgsql;
```

#### View: Ù…Ù„Ø®Øµ Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ø¯Ø§Ø¦Ù†Ø© (Accounts Payable Aging)

```sql
CREATE OR REPLACE VIEW accounts_payable_aging AS
SELECT 
    s.id as supplier_id,
    s.name as supplier_name,
    s.code as supplier_code,
    
    -- Ø§Ù„Ø­Ø§Ù„ÙŠ (0-30 ÙŠÙˆÙ…)
    COALESCE(SUM(CASE 
        WHEN pi.due_date >= CURRENT_DATE - INTERVAL '30 days' THEN pi.total_amount - pi.paid_amount 
        ELSE 0 
    END), 0) as current_0_30,
    
    -- 31-60 ÙŠÙˆÙ…
    COALESCE(SUM(CASE 
        WHEN pi.due_date < CURRENT_DATE - INTERVAL '30 days' 
         AND pi.due_date >= CURRENT_DATE - INTERVAL '60 days' THEN pi.total_amount - pi.paid_amount 
        ELSE 0 
    END), 0) as days_31_60,
    
    -- 61-90 ÙŠÙˆÙ…
    COALESCE(SUM(CASE 
        WHEN pi.due_date < CURRENT_DATE - INTERVAL '60 days' 
         AND pi.due_date >= CURRENT_DATE - INTERVAL '90 days' THEN pi.total_amount - pi.paid_amount 
        ELSE 0 
    END), 0) as days_61_90,
    
    -- Ø£ÙƒØ«Ø± Ù…Ù† 90 ÙŠÙˆÙ…
    COALESCE(SUM(CASE 
        WHEN pi.due_date < CURRENT_DATE - INTERVAL '90 days' THEN pi.total_amount - pi.paid_amount 
        ELSE 0 
    END), 0) as over_90,
    
    -- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    COALESCE(SUM(pi.total_amount - pi.paid_amount), 0) as total_outstanding

FROM suppliers s
LEFT JOIN purchase_invoices pi ON s.id = pi.supplier_id 
    AND pi.payment_status != 'paid' 
    AND pi.status != 'cancelled'
GROUP BY s.id, s.name, s.code
HAVING COALESCE(SUM(pi.total_amount - pi.paid_amount), 0) > 0
ORDER BY total_outstanding DESC;
```

---

## ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ù…Ù„Ù 38

### Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†                    [+ Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯] [ğŸ“¥]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ” Ø¨Ø­Ø«...] [Ø§Ù„ÙØ¦Ø©: Ø§Ù„ÙƒÙ„ â–¼] [Ø§Ù„Ø­Ø§Ù„Ø©: Ù†Ø´Ø· â–¼]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ # â”‚ Ø§Ù„ÙƒÙˆØ¯ â”‚ Ø§Ù„Ø§Ø³Ù… â”‚ Ø§Ù„ÙØ¦Ø© â”‚ Ø§Ù„Ø±ØµÙŠØ¯ â”‚ Ø§Ù„Ø­Ø§Ù„Ø© â”‚ Ø¥Ø¬Ø±Ø§Ø¡      â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1 â”‚ SUP001â”‚ Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ â”‚ Ù…Ø¹Ø¯Ø§Øª â”‚ 45,000 â”‚ Ù†Ø´Ø· â”‚ [Ø¹Ø±Ø¶] â”‚
â”‚ 2 â”‚ SUP002â”‚ Ù…ØµÙ†Ø¹ Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª â”‚ ÙƒÙŠØ¨Ù„Ø§Øªâ”‚ 23,000 â”‚ Ù†Ø´Ø· â”‚ [Ø¹Ø±Ø¶] â”‚
â”‚ 3 â”‚ SUP003â”‚ Ø´Ø±ÙƒØ© Ø§Ù„Ø²ÙŠÙˆØª â”‚ Ù…ÙˆØ§Ø¯ â”‚ 12,500 â”‚ Ù†Ø´Ø· â”‚ [Ø¹Ø±Ø¶]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (3-Way Matching)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: INV-2025-001 â”‚ Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… Ø§Ù„ÙØ­Øµ 1: Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (PO-2025-001)           â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: âœ“ Ù…ØªØ·Ø§Ø¨Ù‚Ø©                               â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„ÙƒÙ…ÙŠØ§Øª: âœ“ Ù…ØªØ·Ø§Ø¨Ù‚Ø©                               â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„Ù…Ø¨Ù„Øº: âœ“ Ù…ØªØ·Ø§Ø¨Ù‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ Ø§Ù„ÙØ­Øµ 2: Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (GRN-2025-001)      â”‚ â”‚
â”‚ â”‚    â€¢ ÙƒÙŠØ¨Ù„ 4 Ù…Ù…: âœ“ 100 = 100                           â”‚ â”‚
â”‚ â”‚    â€¢ Ù…Ø­ÙˆÙ„ 10 ÙƒÙŠÙ„Ùˆ: âœ“ 2 = 2                            â”‚ â”‚
â”‚ â”‚    â€¢ Ø²ÙŠØª Ù…Ø­ÙˆÙ„Ø§Øª: âš ï¸ 50 â‰  48 (Ù†Ø§Ù‚Øµ 2 Ù„ØªØ±)              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… Ø§Ù„ÙØ­Øµ 3: Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ                     â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„Ù…Ø¨Ù„Øº ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: 23,000 Ø±.Ø³                   â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: 23,000 Ø±.Ø³                       â”‚ â”‚
â”‚ â”‚    â€¢ Ø§Ù„ÙØ±Ù‚: 0 Ø±.Ø³                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ù†ØªÙŠØ¬Ø©: âš ï¸ ÙØ§ØªÙˆØ±Ø© Ù…Ø¹Ù„Ù‚Ø© - ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©                   â”‚
â”‚                                                             â”‚
â”‚ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: â—‹ Ù…ÙˆØ§ÙÙ‚Ø© â—‹ Ø·Ù„Ø¨ ÙØ§ØªÙˆØ±Ø© ØªØµØ­ÙŠØ­ â—‹ Ø±ÙØ¶              â”‚
â”‚ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: [________________________________]              â”‚
â”‚                                                             â”‚
â”‚              [Ù…ÙˆØ§ÙÙ‚Ø©] [Ø±ÙØ¶] [ØªØ£Ø¬ÙŠÙ„]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø´Ø§Ø´Ø© Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ ğŸ“‹ Ù…Ø¹Ù„Ù‚Ø©     â”‚ â”‚ â° Ù…Ø³ØªØ­Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…â”‚ â”‚ âš ï¸ Ù…ØªØ£Ø®Ø±Ø©    â”‚      â”‚
â”‚ â”‚ 5 Ø¯ÙØ¹Ø§Øª     â”‚ â”‚ 2 Ø¯ÙØ¹Ø§Øª      â”‚ â”‚ 1 Ø¯ÙØ¹Ø©       â”‚      â”‚
â”‚ â”‚ 115,000 Ø±.Ø³ â”‚ â”‚ 45,000 Ø±.Ø³   â”‚ â”‚ 20,000 Ø±.Ø³  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ø§Ù„Ù…ÙˆØ±Ø¯ â”‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø© â”‚ Ø§Ù„Ù…Ø¨Ù„Øº â”‚ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ â”‚ Ø§Ù„Ø­Ø§Ù„Ø© â”‚ Ø¥Ø¬Ø±Ø§Ø¡â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ â”‚ INV-001 â”‚ 23,000 â”‚ 20/01 â”‚ Ù…Ø¹Ù„Ù‚ â”‚ [Ø¯ÙØ¹]â”‚ â”‚
â”‚ â”‚ Ù…ØµÙ†Ø¹ Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª â”‚ INV-002 â”‚ 15,000 â”‚ 15/01 â”‚ Ù…Ø¹Ù„Ù‚ â”‚ [Ø¯ÙØ¹]â”‚ â”‚
â”‚ â”‚ Ø´Ø±ÙƒØ© Ø§Ù„Ø²ÙŠÙˆØª â”‚ INV-003 â”‚ 8,000 â”‚ 10/12 â”‚ Ù…ØªØ£Ø®Ø± â”‚ [Ø¯ÙØ¹]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ [Ø¯ÙØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯] [ØªØ£Ø¬ÙŠÙ„] [Ø·Ø¨Ø§Ø¹Ø© Ø´ÙŠÙƒØ§Øª]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## APIs - Ù…Ù„Ù 38

```yaml
# Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
GET    /api/v1/suppliers                         - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
POST   /api/v1/suppliers                         - Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯
GET    /api/v1/suppliers/{id}                    - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯
PUT    /api/v1/suppliers/{id}                    - ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯
GET    /api/v1/suppliers/{id}/contacts           - Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯
POST   /api/v1/suppliers/{id}/contacts           - Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„
GET    /api/v1/suppliers/{id}/bank-accounts      - Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
GET    /api/v1/suppliers/{id}/statement          - ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯
GET    /api/v1/suppliers/{id}/transactions       - Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ÙˆØ±Ø¯

# Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
GET    /api/v1/purchase-requests                 - Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
POST   /api/v1/purchase-requests                 - Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡
GET    /api/v1/purchase-requests/{id}            - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
PUT    /api/v1/purchase-requests/{id}            - ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
POST   /api/v1/purchase-requests/{id}/submit     - Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©
POST   /api/v1/purchase-requests/{id}/approve    - Ù…ÙˆØ§ÙÙ‚Ø©
POST   /api/v1/purchase-requests/{id}/reject     - Ø±ÙØ¶

# Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
GET    /api/v1/purchase-orders                   - Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
POST   /api/v1/purchase-orders                   - Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡
GET    /api/v1/purchase-orders/{id}              - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù…Ø±
GET    /api/v1/purchase-orders/{id}/pdf          - ØªØ­Ù…ÙŠÙ„ PDF
POST   /api/v1/purchase-orders/{id}/send         - Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ±Ø¯

# Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹
GET    /api/v1/grn                               - Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
POST   /api/v1/grn                               - Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø§Ø³ØªÙ„Ø§Ù…
GET    /api/v1/grn/{id}                          - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
POST   /api/v1/grn/{id}/confirm                  - ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
POST   /api/v1/grn/{id}/quality-check            - Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¬ÙˆØ¯Ø©

# ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
GET    /api/v1/purchase-invoices                 - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±
POST   /api/v1/purchase-invoices                 - Ø¥Ø¯Ø®Ø§Ù„ ÙØ§ØªÙˆØ±Ø©
GET    /api/v1/purchase-invoices/{id}            - ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
POST   /api/v1/purchase-invoices/{id}/match      - ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©
GET    /api/v1/purchase-invoices/{id}/matching   - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
POST   /api/v1/purchase-invoices/{id}/approve    - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©

# Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù ÙˆØ§Ù„Ø¯ÙØ¹Ø§Øª
GET    /api/v1/payment-vouchers                  - Ù‚Ø§Ø¦Ù…Ø© Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù
POST   /api/v1/payment-vouchers                  - Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ ØµØ±Ù
GET    /api/v1/payment-vouchers/{id}             - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯
POST   /api/v1/payment-vouchers/{id}/approve     - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ù†Ø¯
POST   /api/v1/payment-vouchers/{id}/pay         - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹
GET    /api/v1/payment-dashboard                 - Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª

# Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
GET    /api/v1/reports/accounts-payable-aging    - ØªÙ‚Ø±ÙŠØ± Ø£Ø¹Ù…Ø§Ø± Ø§Ù„Ø°Ù…Ù… Ø§Ù„Ø¯Ø§Ø¦Ù†Ø©
GET    /api/v1/reports/supplier-statement/{id}   - ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù…ÙˆØ±Ø¯
GET    /api/v1/reports/purchase-summary          - Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
GET    /api/v1/reports/payment-forecast          - ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø§Øª
```

---

## Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ù„Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© - Ù…Ù„Ù 38

| Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ù„Ù… | Ø§Ù„Ù…Ø´ÙƒÙ„Ø© | Ø§Ù„Ø­Ù„ |
|------------|---------|------|
| Ù‚Ø§Ø¦Ù…Ø© Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…ØªÙ†Ø§Ø«Ø±Ø© | Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ø§Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„Ø¯ÙØ§ØªØ± | Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ÙƒØ²ÙŠØ© |
| Ø·Ù„Ø¨Ø§Øª Ø´ÙÙ‡ÙŠØ© | Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø±Ø³Ù…ÙŠØ© | Ù†Ø¸Ø§Ù… Ø·Ù„Ø¨Ø§Øª Ø´Ø±Ø§Ø¡ Ù…ÙˆØ«Ù‚ |
| Ø§ØªÙØ§Ù‚Ø§Øª Ù‡Ø§ØªÙÙŠØ© | ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© | Ø£ÙˆØ§Ù…Ø± Ø´Ø±Ø§Ø¡ Ø±Ø³Ù…ÙŠØ© Ù…Ø¹ PDF |
| Ø§Ø³ØªÙ„Ø§Ù… ÙŠØ¯ÙˆÙŠ | ØªØ£Ø®Ø± Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ | Ø§Ø³ØªÙ„Ø§Ù… Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙˆØ±ÙŠ |
| ÙÙˆØ§ØªÙŠØ± ÙˆØ±Ù‚ÙŠØ© | Ù…Ø·Ø§Ø¨Ù‚Ø© ÙŠØ¯ÙˆÙŠØ© Ù…Ø¹Ù‚Ø¯Ø© | Ù…Ø·Ø§Ø¨Ù‚Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø¢Ù„ÙŠØ© |
| Ø¯ÙØ¹Ø§Øª ØºÙŠØ± Ù…Ù†Ø¸Ù…Ø© | Ø¹Ø¯Ù… Ø±Ø¨Ø· Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ± | Ø¯ÙˆØ±Ø© Ø¯ÙØ¹ Ù…ØªÙƒØ§Ù…Ù„Ø© |
| ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ£Ø®Ø±Ø© | ØªØ³ØªØºØ±Ù‚ Ø£Ø³Ø§Ø¨ÙŠØ¹ | ØªÙ‚Ø§Ø±ÙŠØ± Ø­ÙŠØ© ÙÙˆØ±ÙŠØ© |
| Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ø­ØªÙŠØ§Ù„ | Ù„Ø§ Ø±Ù‚Ø§Ø¨Ø© ÙƒØ§ÙÙŠØ© | ØªÙˆØ«ÙŠÙ‚ ÙƒØ§Ù…Ù„ ÙˆÙ…Ø·Ø§Ø¨Ù‚Ø© |



---

## ğŸ”§ Ø¥ÙƒÙ…Ø§Ù„ ÙØ¬ÙˆØ§Øª Ù…Ù„Ù 38 - Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©

---

### 38.1 Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…Ù† Excel

#### Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: `supplier_import_logs`

```sql
CREATE TABLE supplier_import_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500),
    imported_by INT NOT NULL,
    import_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_rows INT DEFAULT 0,
    success_count INT DEFAULT 0,
    error_count INT DEFAULT 0,
    status ENUM('processing', 'completed', 'failed', 'partial') DEFAULT 'processing',
    error_details JSON,
    FOREIGN KEY (imported_by) REFERENCES users(id)
);
```

#### Ø¬Ø¯ÙˆÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: `supplier_import_details`

```sql
CREATE TABLE supplier_import_details (
    id INT PRIMARY KEY AUTO_INCREMENT,
    import_log_id INT NOT NULL,
    row_number INT NOT NULL,
    supplier_name VARCHAR(255),
    raw_data JSON,
    status ENUM('success', 'error', 'duplicate', 'skipped') DEFAULT 'success',
    error_message TEXT,
    created_supplier_id INT,
    FOREIGN KEY (import_log_id) REFERENCES supplier_import_logs(id),
    FOREIGN KEY (created_supplier_id) REFERENCES suppliers(id)
);
```

#### Ø´Ø§Ø´Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…Ù† Excel                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [ğŸ“ Ø§Ø®ØªØ± Ù…Ù„Ù Excel Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§]                â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: .xlsx, .xls, .csv                â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 1000 Ù…ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙˆØ§Ø­Ø¯          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ [ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Excel]                                  â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ø®Ø·ÙˆØ© 2: Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Ø¹Ù…ÙˆØ¯ Excel          | Ø­Ù‚Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…                 â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ Column A (Ø§Ù„Ø§Ø³Ù…)    | [Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ â–¼]            â”‚  â”‚
â”‚ â”‚ Column B (Ø§Ù„Ù‡Ø§ØªÙ)   | [Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ â–¼]            â”‚  â”‚
â”‚ â”‚ Column C (Ø§Ù„Ø¨Ø±ÙŠØ¯)   | [Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ â–¼]     â”‚  â”‚
â”‚ â”‚ Column D (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)  | [Ø§Ù„Ø¹Ù†ÙˆØ§Ù† â–¼]               â”‚  â”‚
â”‚ â”‚ Column E (Ø§Ù„ÙØ¦Ø©)    | [ÙØ¦Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ â–¼]            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ø®Ø·ÙˆØ© 3: Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ # | Ø§Ù„Ø§Ø³Ù… | Ø§Ù„Ù‡Ø§ØªÙ | Ø§Ù„Ø­Ø§Ù„Ø©                      â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ 1 | Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ | 050xxx | âœ“ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯   â”‚  â”‚
â”‚ â”‚ 2 | Ù…ØµÙ†Ø¹ Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª | 055xxx | âœ“ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯   â”‚  â”‚
â”‚ â”‚ 3 | Ø´Ø±ÙƒØ© Ø§Ù„Ø²ÙŠÙˆØª | - | âš  Ù‡Ø§ØªÙ Ù…ÙÙ‚ÙˆØ¯             â”‚  â”‚
â”‚ â”‚ 4 | Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª | 050xxx | âš  Ù…ÙƒØ±Ø±              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ù…Ù„Ø®Øµ: 100 ØµÙ | 95 Ø¬Ø§Ù‡Ø² | 3 ØªØ­Ø°ÙŠØ± | 2 Ø®Ø·Ø£            â”‚
â”‚                                                          â”‚
â”‚ [Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒÙ„] [Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØµØ§Ù„Ø­ ÙÙ‚Ø·] [Ø¥Ù„ØºØ§Ø¡]          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### APIs Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†:

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| POST | `/api/suppliers/import/upload` | Ø±ÙØ¹ Ù…Ù„Ù Excel |
| GET | `/api/suppliers/import/template` | ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Excel |
| POST | `/api/suppliers/import/preview` | Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª |
| POST | `/api/suppliers/import/execute` | ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ |
| GET | `/api/suppliers/import/logs` | Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ |
| GET | `/api/suppliers/import/logs/{id}` | ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªÙŠØ±Ø§Ø¯ |

---

### 38.2 ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Supplier Rating)

#### Ø¬Ø¯ÙˆÙ„ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_ratings`

```sql
CREATE TABLE supplier_ratings (
    id INT PRIMARY KEY AUTO_INCREMENT,
    supplier_id INT NOT NULL,
    rating_period DATE NOT NULL COMMENT 'Ø´Ù‡Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…',
    
    -- Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ù…Ù† 1 Ø¥Ù„Ù‰ 5)
    quality_score DECIMAL(3,2) DEFAULT 0 COMMENT 'Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
    delivery_score DECIMAL(3,2) DEFAULT 0 COMMENT 'Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØªØ³Ù„ÙŠÙ…',
    price_score DECIMAL(3,2) DEFAULT 0 COMMENT 'ØªÙ†Ø§ÙØ³ÙŠØ© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±',
    service_score DECIMAL(3,2) DEFAULT 0 COMMENT 'Ø®Ø¯Ù…Ø© Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹',
    communication_score DECIMAL(3,2) DEFAULT 0 COMMENT 'Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„',
    
    -- Ø§Ù„Ø£ÙˆØ²Ø§Ù†
    quality_weight DECIMAL(3,2) DEFAULT 0.30,
    delivery_weight DECIMAL(3,2) DEFAULT 0.25,
    price_weight DECIMAL(3,2) DEFAULT 0.20,
    service_weight DECIMAL(3,2) DEFAULT 0.15,
    communication_weight DECIMAL(3,2) DEFAULT 0.10,
    
    -- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    overall_score DECIMAL(3,2) GENERATED ALWAYS AS (
        (quality_score * quality_weight) +
        (delivery_score * delivery_weight) +
        (price_score * price_weight) +
        (service_score * service_weight) +
        (communication_score * communication_weight)
    ) STORED,
    
    rating_grade ENUM('A', 'B', 'C', 'D', 'F') GENERATED ALWAYS AS (
        CASE 
            WHEN overall_score >= 4.5 THEN 'A'
            WHEN overall_score >= 3.5 THEN 'B'
            WHEN overall_score >= 2.5 THEN 'C'
            WHEN overall_score >= 1.5 THEN 'D'
            ELSE 'F'
        END
    ) STORED,
    
    notes TEXT,
    rated_by INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (rated_by) REFERENCES users(id),
    UNIQUE KEY unique_supplier_period (supplier_id, rating_period)
);
```

#### Ø¬Ø¯ÙˆÙ„ Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_incidents`

```sql
CREATE TABLE supplier_incidents (
    id INT PRIMARY KEY AUTO_INCREMENT,
    supplier_id INT NOT NULL,
    incident_type ENUM(
        'late_delivery',      -- ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØ³Ù„ÙŠÙ…
        'quality_issue',      -- Ù…Ø´ÙƒÙ„Ø© Ø¬ÙˆØ¯Ø©
        'wrong_quantity',     -- ÙƒÙ…ÙŠØ© Ø®Ø§Ø·Ø¦Ø©
        'wrong_item',         -- ØµÙ†Ù Ø®Ø§Ø·Ø¦
        'damaged_goods',      -- Ø¨Ø¶Ø§Ø¦Ø¹ ØªØ§Ù„ÙØ©
        'price_dispute',      -- Ø®Ù„Ø§Ù Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø±
        'communication_issue', -- Ù…Ø´ÙƒÙ„Ø© ØªÙˆØ§ØµÙ„
        'other'
    ) NOT NULL,
    severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',
    related_po_id INT,
    related_grn_id INT,
    description TEXT NOT NULL,
    resolution TEXT,
    status ENUM('open', 'investigating', 'resolved', 'closed') DEFAULT 'open',
    reported_by INT NOT NULL,
    resolved_by INT,
    reported_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP,
    
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (related_po_id) REFERENCES purchase_orders(id),
    FOREIGN KEY (reported_by) REFERENCES users(id),
    FOREIGN KEY (resolved_by) REFERENCES users(id)
);
```

#### View: Ù…Ù„Ø®Øµ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

```sql
CREATE VIEW supplier_rating_summary AS
SELECT 
    s.id AS supplier_id,
    s.name AS supplier_name,
    s.category,
    
    -- Ø¢Ø®Ø± ØªÙ‚ÙŠÙŠÙ…
    lr.overall_score AS latest_score,
    lr.rating_grade AS latest_grade,
    lr.rating_period AS last_rating_date,
    
    -- Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª (Ø¢Ø®Ø± 12 Ø´Ù‡Ø±)
    AVG(sr.overall_score) AS avg_score_12m,
    
    -- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
    COUNT(DISTINCT po.id) AS total_orders,
    SUM(CASE WHEN grn.received_date <= po.expected_delivery_date THEN 1 ELSE 0 END) AS on_time_deliveries,
    ROUND(SUM(CASE WHEN grn.received_date <= po.expected_delivery_date THEN 1 ELSE 0 END) * 100.0 / 
          NULLIF(COUNT(DISTINCT po.id), 0), 1) AS on_time_percentage,
    
    -- Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
    COUNT(DISTINCT si.id) AS total_incidents,
    SUM(CASE WHEN si.severity IN ('high', 'critical') THEN 1 ELSE 0 END) AS critical_incidents,
    
    -- Ø§Ù„ØªÙˆØµÙŠØ©
    CASE 
        WHEN lr.rating_grade = 'A' THEN 'Ù…ÙˆØ±Ø¯ Ù…ÙØ¶Ù„'
        WHEN lr.rating_grade = 'B' THEN 'Ù…ÙˆØ±Ø¯ Ù…ÙˆØ«ÙˆÙ‚'
        WHEN lr.rating_grade = 'C' THEN 'Ù…ÙˆØ±Ø¯ Ù…Ù‚Ø¨ÙˆÙ„'
        WHEN lr.rating_grade = 'D' THEN 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'
        ELSE 'ØºÙŠØ± Ù…ÙˆØµÙ‰ Ø¨Ù‡'
    END AS recommendation
    
FROM suppliers s
LEFT JOIN supplier_ratings sr ON s.id = sr.supplier_id 
    AND sr.rating_period >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
LEFT JOIN supplier_ratings lr ON s.id = lr.supplier_id 
    AND lr.rating_period = (SELECT MAX(rating_period) FROM supplier_ratings WHERE supplier_id = s.id)
LEFT JOIN purchase_orders po ON s.id = po.supplier_id
LEFT JOIN goods_receipt_notes grn ON po.id = grn.purchase_order_id
LEFT JOIN supplier_incidents si ON s.id = si.supplier_id
GROUP BY s.id, s.name, s.category, lr.overall_score, lr.rating_grade, lr.rating_period;
```

#### Ø´Ø§Ø´Ø© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ ÙØªØ±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø¯ÙŠØ³Ù…Ø¨Ø± 2025                              â”‚
â”‚                                                          â”‚
â”‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (30%)                              â”‚  â”‚
â”‚ â”‚ â­â­â­â­â­  [5/5]                                   â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØªØ³Ù„ÙŠÙ… (25%)                          â”‚  â”‚
â”‚ â”‚ â­â­â­â­â˜†  [4/5]                                   â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ ØªÙ†Ø§ÙØ³ÙŠØ© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (20%)                            â”‚  â”‚
â”‚ â”‚ â­â­â­â˜†â˜†  [3/5]                                   â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø®Ø¯Ù…Ø© Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹ (15%)                          â”‚  â”‚
â”‚ â”‚ â­â­â­â­â˜†  [4/5]                                   â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ (10%)                              â”‚  â”‚
â”‚ â”‚ â­â­â­â­â­  [5/5]                                   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: 4.15 / 5.00                          â”‚
â”‚ Ø§Ù„ØªØµÙ†ÙŠÙ: [B] Ù…ÙˆØ±Ø¯ Ù…ÙˆØ«ÙˆÙ‚                                â”‚
â”‚                                                          â”‚
â”‚ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [Ø£Ø³Ø¹Ø§Ø± Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† Ù„ÙƒÙ† Ø¬ÙˆØ¯Ø© Ù…Ù…ØªØ§Ø²Ø©]       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ [Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…] [Ø¥Ù„ØºØ§Ø¡]                                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### APIs ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†:

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/suppliers/{id}/ratings` | ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ |
| POST | `/api/suppliers/{id}/ratings` | Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯ |
| GET | `/api/suppliers/{id}/rating-summary` | Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… |
| GET | `/api/suppliers/{id}/incidents` | Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…ÙˆØ±Ø¯ |
| POST | `/api/suppliers/{id}/incidents` | ØªØ³Ø¬ÙŠÙ„ Ø­Ø§Ø¯Ø«Ø© |
| GET | `/api/suppliers/rankings` | ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |

---

### 38.3 Ø±Ø¨Ø· Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹/Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„

#### ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡:

```sql
ALTER TABLE purchase_requests ADD COLUMN (
    linked_entity_type ENUM('project', 'work_order', 'maintenance', 'general') DEFAULT 'general',
    linked_entity_id INT,
    cost_center_id INT,
    budget_code VARCHAR(50)
);

-- Ø¥Ø¶Ø§ÙØ© ÙÙ‡Ø±Ø³
CREATE INDEX idx_pr_linked_entity ON purchase_requests(linked_entity_type, linked_entity_id);
```

#### View: Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```sql
CREATE VIEW purchase_requests_by_project AS
SELECT 
    pr.id AS pr_id,
    pr.pr_number,
    pr.request_date,
    pr.status,
    pr.total_amount,
    pr.linked_entity_type,
    pr.linked_entity_id,
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    CASE pr.linked_entity_type
        WHEN 'project' THEN p.project_name
        WHEN 'work_order' THEN CONCAT('Ø£Ù…Ø± Ø¹Ù…Ù„ #', wo.work_order_number)
        WHEN 'maintenance' THEN CONCAT('ØµÙŠØ§Ù†Ø© #', m.maintenance_number)
        ELSE 'Ø¹Ø§Ù…'
    END AS linked_entity_name,
    
    -- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
    u.full_name AS requested_by_name,
    
    -- Ø§Ù„Ø£ØµÙ†Ø§Ù
    GROUP_CONCAT(CONCAT(i.name, ' (', pri.quantity, ')') SEPARATOR ', ') AS items_summary

FROM purchase_requests pr
LEFT JOIN projects p ON pr.linked_entity_type = 'project' AND pr.linked_entity_id = p.id
LEFT JOIN work_orders wo ON pr.linked_entity_type = 'work_order' AND pr.linked_entity_id = wo.id
LEFT JOIN maintenance_orders m ON pr.linked_entity_type = 'maintenance' AND pr.linked_entity_id = m.id
LEFT JOIN users u ON pr.requested_by = u.id
LEFT JOIN purchase_request_items pri ON pr.id = pri.purchase_request_id
LEFT JOIN inventory_items i ON pri.item_id = i.id
GROUP BY pr.id;
```

#### Ø´Ø§Ø´Ø© Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ù…Ø±ØªØ¨Ø·:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯                                           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ Ø±Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù€:                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â—‹ Ù…Ø´Ø±ÙˆØ¹                                           â”‚  â”‚
â”‚ â”‚   [ğŸ” Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: Ù…Ø´Ø±ÙˆØ¹ ØªÙˆØ³Ø¹Ø© Ø§Ù„Ø´Ø¨ÙƒØ© G1 â–¼]    â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ â—‹ Ø£Ù…Ø± Ø¹Ù…Ù„                                         â”‚  â”‚
â”‚ â”‚   [ğŸ” Ø§Ø®ØªØ± Ø£Ù…Ø± Ø§Ù„Ø¹Ù…Ù„ â–¼]                          â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ â—‹ Ø£Ù…Ø± ØµÙŠØ§Ù†Ø©                                       â”‚  â”‚
â”‚ â”‚   [ğŸ” Ø§Ø®ØªØ± Ø£Ù…Ø± Ø§Ù„ØµÙŠØ§Ù†Ø© â–¼]                        â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ â—‹ Ø·Ù„Ø¨ Ø¹Ø§Ù… (ØºÙŠØ± Ù…Ø±ØªØ¨Ø·)                            â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙƒÙ„ÙØ©: [Ù…Ø­Ø·Ø© G1 â–¼]                              â”‚
â”‚ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: [CAPEX-2025-001]                        â”‚
â”‚                                                          â”‚
â”‚ ... Ø¨Ø§Ù‚ÙŠ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ ...                                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 38.4 ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ… (Delivery Tracking)

#### Ø¬Ø¯ÙˆÙ„ ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª: `shipment_tracking`

```sql
CREATE TABLE shipment_tracking (
    id INT PRIMARY KEY AUTO_INCREMENT,
    purchase_order_id INT NOT NULL,
    tracking_number VARCHAR(100),
    carrier_name VARCHAR(100) COMMENT 'Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†',
    
    -- Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø©
    status ENUM(
        'pending',           -- ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø´Ø­Ù†
        'picked_up',         -- ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯
        'in_transit',        -- ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚
        'out_for_delivery',  -- Ø®Ø§Ø±Ø¬ Ù„Ù„ØªØ³Ù„ÙŠÙ…
        'delivered',         -- ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
        'failed_delivery',   -- ÙØ´Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…
        'returned'           -- Ù…Ø±ØªØ¬Ø¹
    ) DEFAULT 'pending',
    
    -- Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    estimated_delivery_date DATE,
    actual_delivery_date DATE,
    shipped_date TIMESTAMP,
    
    -- Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
    current_location VARCHAR(255),
    last_update TIMESTAMP,
    
    -- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (purchase_order_id) REFERENCES purchase_orders(id)
);
```

#### Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø­Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†Ø©: `shipment_tracking_history`

```sql
CREATE TABLE shipment_tracking_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    shipment_id INT NOT NULL,
    status VARCHAR(50) NOT NULL,
    location VARCHAR(255),
    description TEXT,
    event_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (shipment_id) REFERENCES shipment_tracking(id)
);
```

#### Ø´Ø§Ø´Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø© - Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ PO-2025-001                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹: SHP-123456789                              â”‚
â”‚ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†: Ø£Ø±Ø§Ù…ÙƒØ³                                     â”‚
â”‚ Ø§Ù„Ø­Ø§Ù„Ø©: ğŸšš ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚                                   â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„ØªÙˆÙ‚ÙŠØª:                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø­Ù†: 2025-12-15                          â”‚  â”‚
â”‚ â”‚ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: 2025-12-20                      â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: 3 Ø£ÙŠØ§Ù…                          â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø­Ù†Ø©:                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âœ“ 15/12 09:00 | ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ - Ø§Ù„Ø±ÙŠØ§Ø¶  â”‚  â”‚
â”‚ â”‚ âœ“ 15/12 14:00 | ÙˆØµÙ„ Ù…Ø±ÙƒØ² Ø§Ù„ÙØ±Ø² - Ø§Ù„Ø±ÙŠØ§Ø¶         â”‚  â”‚
â”‚ â”‚ âœ“ 16/12 08:00 | ØºØ§Ø¯Ø± Ù…Ø±ÙƒØ² Ø§Ù„ÙØ±Ø² - Ø§Ù„Ø±ÙŠØ§Ø¶        â”‚  â”‚
â”‚ â”‚ âœ“ 17/12 10:00 | ÙˆØµÙ„ Ù…Ø±ÙƒØ² Ø§Ù„ÙØ±Ø² - Ø¬Ø¯Ø©            â”‚  â”‚
â”‚ â”‚ â—‹ 18/12 --:-- | ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©           â”‚  â”‚
â”‚ â”‚ â—‹ 20/12 --:-- | Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ [ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©] [ğŸ“ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø´Ø§Ø­Ù†]                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### APIs ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª:

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/purchase-orders/{id}/tracking` | Ø­Ø§Ù„Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø© |
| POST | `/api/purchase-orders/{id}/tracking` | Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ |
| PUT | `/api/shipments/{id}/status` | ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø© |
| GET | `/api/shipments/{id}/history` | Ø³Ø¬Ù„ Ø­Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†Ø© |
| GET | `/api/shipments/pending-delivery` | Ø§Ù„Ø´Ø­Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ ÙˆØµÙˆÙ„Ù‡Ø§ |

---

### 38.5 ØµÙˆØ± ÙˆÙ…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…

#### ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹:

```sql
ALTER TABLE goods_receipt_notes ADD COLUMN (
    attachments JSON COMMENT 'Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©',
    signature_image VARCHAR(500) COMMENT 'ØµÙˆØ±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹',
    delivery_note_image VARCHAR(500) COMMENT 'ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…'
);
```

#### Ø¬Ø¯ÙˆÙ„ ØµÙˆØ± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: `grn_attachments`

```sql
CREATE TABLE grn_attachments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    grn_id INT NOT NULL,
    attachment_type ENUM(
        'delivery_note',     -- Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ…
        'invoice',           -- Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        'packing_list',      -- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¹Ø¨Ø¦Ø©
        'quality_certificate', -- Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©
        'photo',             -- ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹
        'damage_photo',      -- ØµÙˆØ±Ø© Ø§Ù„ØªÙ„Ù
        'signature',         -- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
        'other'
    ) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INT,
    mime_type VARCHAR(100),
    description TEXT,
    uploaded_by INT NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (grn_id) REFERENCES goods_receipt_notes(id),
    FOREIGN KEY (uploaded_by) REFERENCES users(id)
);
```

#### Ø´Ø§Ø´Ø© Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø¹ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø¥Ø´Ø¹Ø§Ø± Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ (GRN)                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ ... Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ...                       â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ÙˆØ§Ù„ØµÙˆØ±:                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [ğŸ“· Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©] [ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù]                   â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:                                 â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ â”‚ ğŸ“„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ³Ù„ÙŠÙ….pdf        [Ø¹Ø±Ø¶] [Ø­Ø°Ù]   â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ 1.jpg       [Ø¹Ø±Ø¶] [Ø­Ø°Ù]   â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ 2.jpg       [Ø¹Ø±Ø¶] [Ø­Ø°Ù]   â”‚  â”‚  â”‚
â”‚ â”‚ â”‚ ğŸ“· ØµÙˆØ±Ø© Ø§Ù„ØªÙ„Ù - Ø²ÙŠØª.jpg     [Ø¹Ø±Ø¶] [Ø­Ø°Ù]   â”‚  â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:                              â”‚  â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ â”‚     [Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹]                         â”‚  â”‚  â”‚
â”‚ â”‚ â”‚     âœï¸ ÙˆÙ‚Ø¹ Ù‡Ù†Ø§                              â”‚  â”‚  â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ [ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…] [Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©] [Ø¥Ù„ØºØ§Ø¡]                 â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 38.6 Ù…Ø³Ø­ Ø§Ù„ÙØ§ØªÙˆØ±Ø© OCR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù…ØªÙ‚Ø¯Ù…)

#### Ø¬Ø¯ÙˆÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø­: `invoice_ocr_requests`

```sql
CREATE TABLE invoice_ocr_requests (
    id INT PRIMARY KEY AUTO_INCREMENT,
    original_file_path VARCHAR(500) NOT NULL,
    file_name VARCHAR(255),
    
    -- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³Ø­
    ocr_status ENUM('pending', 'processing', 'completed', 'failed') DEFAULT 'pending',
    extracted_data JSON COMMENT 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©',
    confidence_score DECIMAL(5,2) COMMENT 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø«Ù‚Ø©',
    
    -- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    extracted_invoice_number VARCHAR(100),
    extracted_supplier_name VARCHAR(255),
    extracted_date DATE,
    extracted_total DECIMAL(15,2),
    extracted_items JSON,
    
    -- Ø§Ù„Ø±Ø¨Ø·
    matched_supplier_id INT,
    matched_po_id INT,
    created_invoice_id INT,
    
    -- Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    processed_at TIMESTAMP,
    reviewed_by INT,
    reviewed_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (matched_supplier_id) REFERENCES suppliers(id),
    FOREIGN KEY (matched_po_id) REFERENCES purchase_orders(id),
    FOREIGN KEY (reviewed_by) REFERENCES users(id)
);
```

#### Ø´Ø§Ø´Ø© Ù…Ø³Ø­ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ù…Ø³Ø­ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (OCR)                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ [ğŸ“· Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©] [ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù PDF/ØµÙˆØ±Ø©]               â”‚
â”‚                                                          â”‚
â”‚ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³Ø­:                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: INV-2025-001 âœ“ (Ø«Ù‚Ø©: 95%)         â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ù…ÙˆØ±Ø¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª âœ“ (Ù…Ø·Ø§Ø¨Ù‚)        â”‚  â”‚
â”‚ â”‚ Ø§Ù„ØªØ§Ø±ÙŠØ®: 2025-12-20 âœ“                           â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ù…Ø¨Ù„Øº: 23,000 Ø±ÙŠØ§Ù„ âœ“                           â”‚  â”‚
â”‚ â”‚                                                    â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:                              â”‚  â”‚
â”‚ â”‚ 1. ÙƒÙŠØ¨Ù„ 4 Ù…Ù… - 100 Ù…ØªØ± - 5,000 Ø±ÙŠØ§Ù„           â”‚  â”‚
â”‚ â”‚ 2. Ù…Ø­ÙˆÙ„ 10 ÙƒÙŠÙ„Ùˆ - 2 ÙˆØ­Ø¯Ø© - 10,000 Ø±ÙŠØ§Ù„        â”‚  â”‚
â”‚ â”‚ 3. Ø²ÙŠØª Ù…Ø­ÙˆÙ„Ø§Øª - 50 Ù„ØªØ± - 5,000 Ø±ÙŠØ§Ù„           â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚: PO-2025-001 âœ“                     â”‚
â”‚                                                          â”‚
â”‚ [âœ“ ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©] [âœï¸ ØªØ¹Ø¯ÙŠÙ„] [âŒ Ø¥Ù„ØºØ§Ø¡]     â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 38.7 Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹

#### Ø¬Ø¯ÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: `supplier_notifications`

```sql
CREATE TABLE supplier_notifications (
    id INT PRIMARY KEY AUTO_INCREMENT,
    supplier_id INT NOT NULL,
    notification_type ENUM(
        'payment_completed',    -- ØªÙ… Ø§Ù„Ø¯ÙØ¹
        'payment_scheduled',    -- Ø¯ÙØ¹ Ù…Ø¬Ø¯ÙˆÙ„
        'po_issued',           -- Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯
        'grn_confirmed',       -- ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        'invoice_approved',    -- Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        'invoice_rejected',    -- Ø±ÙØ¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        'rating_update'        -- ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
    ) NOT NULL,
    
    -- Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    subject VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    
    -- Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„Ù…Ø±ØªØ¨Ø·
    related_entity_type VARCHAR(50),
    related_entity_id INT,
    
    -- Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    send_method ENUM('email', 'sms', 'both') DEFAULT 'email',
    email_sent BOOLEAN DEFAULT FALSE,
    sms_sent BOOLEAN DEFAULT FALSE,
    sent_at TIMESTAMP,
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    email_opened BOOLEAN DEFAULT FALSE,
    opened_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);
```

#### Trigger: Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹

```sql
DELIMITER //
CREATE TRIGGER notify_supplier_on_payment
AFTER UPDATE ON payment_vouchers
FOR EACH ROW
BEGIN
    IF NEW.status = 'paid' AND OLD.status != 'paid' THEN
        -- Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ±Ø¯
        INSERT INTO supplier_notifications (
            supplier_id,
            notification_type,
            subject,
            message,
            related_entity_type,
            related_entity_id,
            send_method
        )
        SELECT 
            s.id,
            'payment_completed',
            CONCAT('ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ', inv.invoice_number),
            CONCAT(
                'Ø¹Ø²ÙŠØ²Ù†Ø§ ', s.name, ',\n\n',
                'Ù†ÙˆØ¯ Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ… Ø¨Ø£Ù†Ù‡ ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ', inv.invoice_number, ' Ø¨Ù…Ø¨Ù„Øº ', FORMAT(NEW.amount, 2), ' Ø±ÙŠØ§Ù„.\n\n',
                'Ø±Ù‚Ù… Ø³Ù†Ø¯ Ø§Ù„ØµØ±Ù: ', NEW.voucher_number, '\n',
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹: ', DATE_FORMAT(NOW(), '%Y-%m-%d'), '\n',
                'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ', NEW.payment_method, '\n\n',
                'Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.'
            ),
            'payment_voucher',
            NEW.id,
            CASE WHEN s.email IS NOT NULL THEN 'email' ELSE 'sms' END
        FROM suppliers s
        JOIN supplier_invoices inv ON NEW.invoice_id = inv.id
        WHERE inv.supplier_id = s.id;
    END IF;
END //
DELIMITER ;
```

#### Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:

```html
<!-- Ù‚Ø§Ù„Ø¨ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ù…ÙˆØ±Ø¯ -->
<div style="font-family: Arial, sans-serif; direction: rtl;">
    <h2>Ø¥Ø´Ø¹Ø§Ø± Ø³Ø¯Ø§Ø¯ ÙØ§ØªÙˆØ±Ø©</h2>
    
    <p>Ø¹Ø²ÙŠØ²Ù†Ø§ {{supplier_name}}ØŒ</p>
    
    <p>Ù†ÙˆØ¯ Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ… Ø¨Ø£Ù†Ù‡ ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
    
    <table style="border-collapse: collapse; width: 100%;">
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong></td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{invoice_number}}</td>
        </tr>
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong></td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{amount}} Ø±ÙŠØ§Ù„</td>
        </tr>
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><strong>Ø±Ù‚Ù… Ø³Ù†Ø¯ Ø§Ù„ØµØ±Ù:</strong></td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{voucher_number}}</td>
        </tr>
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹:</strong></td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{payment_date}}</td>
        </tr>
        <tr>
            <td style="border: 1px solid #ddd; padding: 8px;"><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</strong></td>
            <td style="border: 1px solid #ddd; padding: 8px;">{{payment_method}}</td>
        </tr>
    </table>
    
    <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§.</p>
    
    <p>Ù…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ<br>
    Ù‚Ø³Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
</div>
```

---

### 38.8 Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´ÙŠÙƒØ§Øª

#### Ø¬Ø¯ÙˆÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø´ÙŠÙƒØ§Øª: `check_templates`

```sql
CREATE TABLE check_templates (
    id INT PRIMARY KEY AUTO_INCREMENT,
    template_name VARCHAR(100) NOT NULL,
    bank_name VARCHAR(100) NOT NULL,
    
    -- Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø´ÙŠÙƒ (Ø¨Ø§Ù„Ù…Ù„ÙŠÙ…ØªØ±)
    check_width DECIMAL(6,2) DEFAULT 180,
    check_height DECIMAL(6,2) DEFAULT 80,
    
    -- Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ (X, Y Ø¨Ø§Ù„Ù…Ù„ÙŠÙ…ØªØ± Ù…Ù† Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø§Ù„Ø¹Ù„ÙŠØ§)
    date_position_x DECIMAL(6,2),
    date_position_y DECIMAL(6,2),
    amount_numbers_position_x DECIMAL(6,2),
    amount_numbers_position_y DECIMAL(6,2),
    amount_words_position_x DECIMAL(6,2),
    amount_words_position_y DECIMAL(6,2),
    payee_position_x DECIMAL(6,2),
    payee_position_y DECIMAL(6,2),
    
    -- Ø§Ù„Ø®Ø·ÙˆØ·
    font_name VARCHAR(50) DEFAULT 'Arial',
    font_size INT DEFAULT 12,
    
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´ÙŠÙƒØ§Øª: `printed_checks`

```sql
CREATE TABLE printed_checks (
    id INT PRIMARY KEY AUTO_INCREMENT,
    payment_voucher_id INT NOT NULL,
    check_number VARCHAR(50) NOT NULL,
    bank_account_id INT NOT NULL,
    
    -- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠÙƒ
    payee_name VARCHAR(255) NOT NULL,
    amount DECIMAL(15,2) NOT NULL,
    amount_in_words VARCHAR(500),
    check_date DATE NOT NULL,
    
    -- Ø­Ø§Ù„Ø© Ø§Ù„Ø´ÙŠÙƒ
    status ENUM('printed', 'delivered', 'cashed', 'cancelled', 'void') DEFAULT 'printed',
    
    -- Ø§Ù„ØªØªØ¨Ø¹
    printed_by INT NOT NULL,
    printed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    delivered_at TIMESTAMP,
    cashed_at TIMESTAMP,
    
    -- Ø§Ù„Ø¥Ù„ØºØ§Ø¡
    cancelled_reason TEXT,
    cancelled_by INT,
    cancelled_at TIMESTAMP,
    
    FOREIGN KEY (payment_voucher_id) REFERENCES payment_vouchers(id),
    FOREIGN KEY (printed_by) REFERENCES users(id),
    FOREIGN KEY (cancelled_by) REFERENCES users(id)
);
```

#### Function: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª

```sql
DELIMITER //
CREATE FUNCTION amount_to_arabic_words(amount DECIMAL(15,2))
RETURNS VARCHAR(500)
DETERMINISTIC
BEGIN
    DECLARE result VARCHAR(500);
    DECLARE whole_part INT;
    DECLARE decimal_part INT;
    
    SET whole_part = FLOOR(amount);
    SET decimal_part = ROUND((amount - whole_part) * 100);
    
    -- Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© Ù…Ø¨Ø³Ø·Ø©ØŒ ÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹Ù‡Ø§
    SET result = CONCAT(
        convert_number_to_words(whole_part), ' Ø±ÙŠØ§Ù„',
        IF(decimal_part > 0, CONCAT(' Ùˆ ', convert_number_to_words(decimal_part), ' Ù‡Ù„Ù„Ø©'), '')
    );
    
    RETURN result;
END //
DELIMITER ;
```

#### Ø´Ø§Ø´Ø© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´ÙŠÙƒ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø·Ø¨Ø§Ø¹Ø© Ø´ÙŠÙƒ - Ø³Ù†Ø¯ Ø§Ù„ØµØ±Ù DP-2025-001                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                          â”‚
â”‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠÙƒ:                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª                  â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ù…Ø¨Ù„Øº: 23,000.00 Ø±ÙŠØ§Ù„                           â”‚  â”‚
â”‚ â”‚ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØªØ§Ø¨Ø©: Ø«Ù„Ø§Ø«Ø© ÙˆØ¹Ø´Ø±ÙˆÙ† Ø£Ù„Ù Ø±ÙŠØ§Ù„ Ù„Ø§ ØºÙŠØ±      â”‚  â”‚
â”‚ â”‚ Ø§Ù„ØªØ§Ø±ÙŠØ®: 2025-12-25                              â”‚  â”‚
â”‚ â”‚ Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ: [123456]                              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ:                                          â”‚
â”‚ [Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ - Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… 1234567890 â–¼]                 â”‚
â”‚                                                          â”‚
â”‚ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:                                           â”‚
â”‚ [Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ - Ø´ÙŠÙƒ Ø¹Ø§Ø¯ÙŠ â–¼]                       â”‚
â”‚                                                          â”‚
â”‚ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´ÙŠÙƒ:                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚  â”‚ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ                    2025/12/25 â”‚  â”‚  â”‚
â”‚ â”‚  â”‚                                              â”‚  â”‚  â”‚
â”‚ â”‚  â”‚ Ø§Ø¯ÙØ¹ÙˆØ§ Ù„Ø£Ù…Ø±: Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª        â”‚  â”‚  â”‚
â”‚ â”‚  â”‚                                              â”‚  â”‚  â”‚
â”‚ â”‚  â”‚ Ù…Ø¨Ù„Øº ÙˆÙ‚Ø¯Ø±Ù‡: Ø«Ù„Ø§Ø«Ø© ÙˆØ¹Ø´Ø±ÙˆÙ† Ø£Ù„Ù Ø±ÙŠØ§Ù„ Ù„Ø§ ØºÙŠØ±  â”‚  â”‚  â”‚
â”‚ â”‚  â”‚                                              â”‚  â”‚  â”‚
â”‚ â”‚  â”‚                          23,000.00 Ø±ÙŠØ§Ù„    â”‚  â”‚  â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚ [ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©] [Ù…Ø¹Ø§ÙŠÙ†Ø© PDF] [Ø¥Ù„ØºØ§Ø¡]                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### APIs Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´ÙŠÙƒØ§Øª:

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/check-templates` | Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø´ÙŠÙƒØ§Øª |
| POST | `/api/check-templates` | Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ |
| POST | `/api/payment-vouchers/{id}/print-check` | Ø·Ø¨Ø§Ø¹Ø© Ø´ÙŠÙƒ |
| GET | `/api/printed-checks` | Ø³Ø¬Ù„ Ø§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø© |
| PUT | `/api/printed-checks/{id}/status` | ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø´ÙŠÙƒ |
| POST | `/api/printed-checks/{id}/cancel` | Ø¥Ù„ØºØ§Ø¡ Ø´ÙŠÙƒ |

---

### Ù…Ù„Ø®Øµ Ø§Ù„ÙØ¬ÙˆØ§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©:

| # | Ø§Ù„ÙØ¬ÙˆØ© | Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ | Ø§Ù„Ø´Ø§Ø´Ø§Øª | APIs |
|---|--------|---------|---------|------|
| 1 | Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† | 2 | 1 | 6 |
| 2 | ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† | 2 + View | 1 | 6 |
| 3 | Ø±Ø¨Ø· PR Ø¨Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ | ØªØ­Ø¯ÙŠØ« + View | 1 | - |
| 4 | ØªØªØ¨Ø¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… | 2 | 1 | 5 |
| 5 | ØµÙˆØ± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… | 1 + ØªØ­Ø¯ÙŠØ« | 1 | - |
| 6 | Ù…Ø³Ø­ OCR | 1 | 1 | - |
| 7 | Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙØ¹ | 1 + Trigger | - | - |
| 8 | Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´ÙŠÙƒØ§Øª | 2 + Function | 1 | 6 |
| **Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ** | **13 Ø¬Ø¯ÙˆÙ„** | **7 Ø´Ø§Ø´Ø§Øª** | **23 API** |



---

# ğŸ”§ Ù…Ù„Ù 40 (ØªÙƒÙ…Ù„Ø©): ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù„ÙƒÙŠØ© (TCO)

> **Ø§Ù„ØºØ±Ø¶:** Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ø§Ù…ØªÙ„Ø§Ùƒ ÙƒÙ„ Ø£ØµÙ„ Ø£Ùˆ Ù†ÙˆØ¹ Ù…ÙƒÙˆÙ†ØŒ Ø´Ø§Ù…Ù„Ø© Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ¬Ù…ÙŠØ¹ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©.

## 1. View Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù„ÙƒÙŠØ© (total_cost_of_ownership)

```sql
CREATE OR REPLACE VIEW total_cost_of_ownership AS
WITH purchase_costs AS (
    SELECT 
        ii.id AS item_id,
        ii.name AS item_name,
        ii.category_id,
        ic.name AS category_name,
        AVG(poi.unit_price) AS avg_purchase_price,
        COUNT(DISTINCT poi.id) AS purchase_count
    FROM inventory_items ii
    LEFT JOIN item_categories ic ON ii.category_id = ic.id
    LEFT JOIN purchase_order_items poi ON ii.id = poi.item_id
    GROUP BY ii.id, ii.name, ii.category_id, ic.name
),
repair_costs AS (
    SELECT 
        di.item_id,
        COUNT(ro.id) AS repair_count,
        SUM(ro.actual_cost) AS total_repair_cost,
        AVG(ro.actual_cost) AS avg_repair_cost
    FROM damaged_inventory di
    LEFT JOIN repair_orders ro ON di.id = ro.damaged_item_id AND ro.status = 'completed'
    GROUP BY di.item_id
),
maintenance_costs AS (
    SELECT 
        pmm.item_id,
        SUM(pmm.quantity * pmm.unit_cost) AS total_maintenance_cost
    FROM pm_wo_materials_used pmm
    GROUP BY pmm.item_id
),
disposal_value AS (
    SELECT 
        di.item_id,
        SUM(dd.scrap_value) AS total_scrap_value
    FROM damaged_inventory di
    LEFT JOIN disposal_decisions dd ON di.id = dd.damaged_item_id
    GROUP BY di.item_id
)
SELECT 
    pc.item_id,
    pc.item_name,
    pc.category_name,
    pc.avg_purchase_price,
    pc.purchase_count,
    COALESCE(rc.repair_count, 0) AS repair_count,
    COALESCE(rc.total_repair_cost, 0) AS total_repair_cost,
    COALESCE(rc.avg_repair_cost, 0) AS avg_repair_cost,
    COALESCE(mc.total_maintenance_cost, 0) AS total_maintenance_cost,
    COALESCE(dv.total_scrap_value, 0) AS total_scrap_value,
    -- Ø­Ø³Ø§Ø¨ TCO
    (
        pc.avg_purchase_price + 
        COALESCE(rc.total_repair_cost, 0) + 
        COALESCE(mc.total_maintenance_cost, 0) - 
        COALESCE(dv.total_scrap_value, 0)
    ) AS total_cost_of_ownership,
    -- Ù†Ø³Ø¨Ø© ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    CASE 
        WHEN pc.avg_purchase_price > 0 THEN
            ROUND((COALESCE(rc.total_repair_cost, 0) / pc.avg_purchase_price) * 100, 2)
        ELSE 0
    END AS repair_cost_percentage
FROM purchase_costs pc
LEFT JOIN repair_costs rc ON pc.item_id = rc.item_id
LEFT JOIN maintenance_costs mc ON pc.item_id = mc.item_id
LEFT JOIN disposal_value dv ON pc.item_id = dv.item_id;
```

## 2. View ØªØ­Ù„ÙŠÙ„ TCO Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯

```sql
CREATE OR REPLACE VIEW tco_by_supplier AS
SELECT 
    s.id AS supplier_id,
    s.name AS supplier_name,
    COUNT(DISTINCT tco.item_id) AS items_supplied,
    AVG(tco.avg_purchase_price) AS avg_purchase_price,
    AVG(tco.total_repair_cost) AS avg_repair_cost,
    AVG(tco.repair_cost_percentage) AS avg_repair_percentage,
    -- ØªØµÙ†ÙŠÙ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ TCO
    CASE 
        WHEN AVG(tco.repair_cost_percentage) < 20 THEN 'Ù…Ù…ØªØ§Ø²'
        WHEN AVG(tco.repair_cost_percentage) < 40 THEN 'Ø¬ÙŠØ¯'
        WHEN AVG(tco.repair_cost_percentage) < 60 THEN 'Ù…ØªÙˆØ³Ø·'
        ELSE 'Ø¶Ø¹ÙŠÙ'
    END AS supplier_quality_rating
FROM suppliers s
JOIN purchase_order_items poi ON s.id = (
    SELECT po.supplier_id FROM purchase_orders po WHERE po.id = poi.purchase_order_id
)
JOIN total_cost_of_ownership tco ON poi.item_id = tco.item_id
GROUP BY s.id, s.name
ORDER BY avg_repair_percentage ASC;
```

## 3. Function Ø­Ø³Ø§Ø¨ TCO Ù„Ø£ØµÙ„ Ù…Ø­Ø¯Ø¯

```sql
CREATE OR REPLACE FUNCTION calculate_asset_tco(p_asset_id UUID)
RETURNS TABLE (
    asset_id UUID,
    asset_name VARCHAR,
    purchase_price DECIMAL,
    total_maintenance_cost DECIMAL,
    total_repair_cost DECIMAL,
    total_component_cost DECIMAL,
    total_cost_of_ownership DECIMAL,
    cost_per_operating_hour DECIMAL,
    cost_per_day DECIMAL
) AS $$
BEGIN
    RETURN QUERY
    WITH asset_info AS (
        SELECT 
            a.id, a.name, a.purchase_price,
            EXTRACT(DAY FROM (CURRENT_DATE - a.installation_date)) AS days_in_service
        FROM assets a WHERE a.id = p_asset_id
    ),
    maintenance_costs AS (
        SELECT SUM(pmwo.labor_cost + pmwo.material_cost + pmwo.external_cost) AS total_pm_cost
        FROM pm_work_orders pmwo
        WHERE pmwo.asset_id = p_asset_id AND pmwo.status = 'completed'
    ),
    repair_costs AS (
        SELECT SUM(wo.labor_cost + wo.material_cost + wo.external_cost) AS total_repair_cost
        FROM work_orders wo
        WHERE wo.asset_id = p_asset_id AND wo.maintenance_type IN ('corrective', 'emergency') AND wo.status = 'completed'
    ),
    component_costs AS (
        SELECT SUM(cr.component_cost) AS total_component_cost
        FROM component_replacements cr WHERE cr.asset_id = p_asset_id
    ),
    operating_hours AS (
        SELECT COALESCE(MAX(mr.meter_reading), 0) AS total_hours
        FROM meter_readings mr WHERE mr.asset_id = p_asset_id AND mr.meter_type = 'operating_hours'
    )
    SELECT 
        ai.id, ai.name, ai.purchase_price,
        COALESCE(mc.total_pm_cost, 0),
        COALESCE(rc.total_repair_cost, 0),
        COALESCE(cc.total_component_cost, 0),
        (ai.purchase_price + COALESCE(mc.total_pm_cost, 0) + COALESCE(rc.total_repair_cost, 0) + COALESCE(cc.total_component_cost, 0)),
        CASE WHEN oh.total_hours > 0 THEN ROUND((ai.purchase_price + COALESCE(mc.total_pm_cost, 0) + COALESCE(rc.total_repair_cost, 0)) / oh.total_hours, 2) ELSE 0 END,
        CASE WHEN ai.days_in_service > 0 THEN ROUND((ai.purchase_price + COALESCE(mc.total_pm_cost, 0) + COALESCE(rc.total_repair_cost, 0)) / ai.days_in_service, 2) ELSE 0 END
    FROM asset_info ai
    CROSS JOIN maintenance_costs mc
    CROSS JOIN repair_costs rc
    CROSS JOIN component_costs cc
    CROSS JOIN operating_hours oh;
END;
$$ LANGUAGE plpgsql;
```

## 4. Ø´Ø§Ø´Ø© ØªÙ‚Ø±ÙŠØ± TCO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù„ÙƒÙŠØ© (TCO)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ÙÙ„ØªØ±: Ø§Ù„ÙØ¦Ø© â–¼] [ÙÙ„ØªØ±: Ø§Ù„Ù…ÙˆØ±Ø¯ â–¼] [Ù…Ù† ØªØ§Ø±ÙŠØ®: ___] [Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®: ___] [ğŸ”]    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ˆ Ù…Ù„Ø®Øµ TCO                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª    â”‚  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª   â”‚  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©      â”‚   â”‚
â”‚  â”‚  $1,250,000          â”‚  $185,000 (14.8%)   â”‚  $95,000 (7.6%)      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø±Ø¯Ø©         â”‚  TCO Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ       â”‚  Ù…ØªÙˆØ³Ø· TCO/ÙˆØ­Ø¯Ø©      â”‚   â”‚
â”‚  â”‚  $45,000             â”‚  $1,485,000         â”‚  $2,475              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ­ TCO Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Ø§Ù„Ù…ÙˆØ±Ø¯       â”‚ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡ â”‚ %Ø¥ØµÙ„Ø§Ø­   â”‚ TCO/ÙˆØ­Ø¯Ø© â”‚ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Caterpillar  â”‚ $12,000  â”‚ 12%      â”‚ $13,440  â”‚ â­â­â­â­â­ Ù…Ù…ØªØ§Ø²       â”‚   â”‚
â”‚  â”‚ Schneider    â”‚ $3,500   â”‚ 8%       â”‚ $3,780   â”‚ â­â­â­â­â­ Ù…Ù…ØªØ§Ø²       â”‚   â”‚
â”‚  â”‚ ABB          â”‚ $4,200   â”‚ 15%      â”‚ $4,830   â”‚ â­â­â­â­ Ø¬ÙŠØ¯          â”‚   â”‚
â”‚  â”‚ Ù…Ø­Ù„ÙŠ Ø£       â”‚ $800     â”‚ 35%      â”‚ $1,080   â”‚ â­â­â­ Ù…ØªÙˆØ³Ø·         â”‚   â”‚
â”‚  â”‚ Ù…Ø­Ù„ÙŠ Ø¨       â”‚ $600     â”‚ 55%      â”‚ $930     â”‚ â­â­ Ø¶Ø¹ÙŠÙ           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [ğŸ“¥ ØªØµØ¯ÙŠØ± Excel]  [ğŸ“„ ØªØµØ¯ÙŠØ± PDF]  [ğŸ“Š Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. APIs ØªÙ‚Ø±ÙŠØ± TCO

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/v1/reports/tco` | ØªÙ‚Ø±ÙŠØ± TCO Ø§Ù„Ø´Ø§Ù…Ù„ |
| GET | `/api/v1/reports/tco/by-category` | TCO Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© |
| GET | `/api/v1/reports/tco/by-supplier` | TCO Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ±Ø¯ |
| GET | `/api/v1/reports/tco/asset/:id` | TCO Ù„Ø£ØµÙ„ Ù…Ø­Ø¯Ø¯ |
| GET | `/api/v1/reports/tco/trend` | Ø§ØªØ¬Ø§Ù‡ TCO Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù† |



---

# ğŸ”„ ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

> **Ø§Ù„ØºØ±Ø¶:** ØªØ±Ø­ÙŠÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø© Ù…Ù†Ø° Ø¨Ø¯Ø§ÙŠØ© 2024

---

## 1. ØªØ±Ø­ÙŠÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

### 1.1 Ø¬Ø¯ÙˆÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© (supplier_opening_balances)

```sql
CREATE TABLE supplier_opening_balances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    migration_project_id UUID REFERENCES migration_projects(id),
    
    supplier_id UUID REFERENCES suppliers(id),
    supplier_code VARCHAR(50),
    supplier_name VARCHAR(200),
    
    source_balance DECIMAL(18,2) NOT NULL,
    source_balance_date DATE NOT NULL,
    source_system VARCHAR(100),
    
    unpaid_invoices_count INTEGER DEFAULT 0,
    oldest_invoice_date DATE,
    last_payment_date DATE,
    
    is_verified BOOLEAN DEFAULT FALSE,
    verified_by UUID REFERENCES users(id),
    verified_at TIMESTAMP,
    
    calculated_balance DECIMAL(18,2),
    variance DECIMAL(18,2) GENERATED ALWAYS AS (source_balance - COALESCE(calculated_balance, source_balance)) STORED,
    
    status VARCHAR(50) DEFAULT 'pending',
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 1.2 Function ØªØ±Ø­ÙŠÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

```sql
CREATE OR REPLACE FUNCTION migrate_supplier_balances(p_project_id UUID, p_opening_date DATE)
RETURNS TABLE (success BOOLEAN, suppliers_migrated INTEGER, total_balance DECIMAL, message TEXT) AS $$
DECLARE
    v_count INTEGER := 0;
    v_total DECIMAL := 0;
BEGIN
    SELECT COUNT(*), COALESCE(SUM(source_balance), 0) INTO v_count, v_total
    FROM supplier_opening_balances WHERE migration_project_id = p_project_id AND status = 'verified';
    
    IF v_count = 0 THEN
        RETURN QUERY SELECT FALSE, 0, 0::DECIMAL, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø© Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…Ø¹ØªÙ…Ø¯Ø©';
        RETURN;
    END IF;
    
    UPDATE suppliers s SET current_balance = sob.source_balance
    FROM supplier_opening_balances sob
    WHERE s.id = sob.supplier_id AND sob.migration_project_id = p_project_id AND sob.status = 'verified';
    
    UPDATE supplier_opening_balances SET status = 'posted' WHERE migration_project_id = p_project_id AND status = 'verified';
    
    RETURN QUERY SELECT TRUE, v_count, v_total, 'ØªÙ… ØªØ±Ø­ÙŠÙ„ Ø£Ø±ØµØ¯Ø© ' || v_count || ' Ù…ÙˆØ±Ø¯';
END;
$$ LANGUAGE plpgsql;
```

---

## 2. ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ

### 2.1 Ø¬Ø¯ÙˆÙ„ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© (inventory_opening_balances)

```sql
CREATE TABLE inventory_opening_balances (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    migration_project_id UUID REFERENCES migration_projects(id),
    
    item_id UUID REFERENCES items(id),
    item_code VARCHAR(50),
    item_name VARCHAR(200),
    warehouse_id UUID REFERENCES warehouses(id),
    
    quantity DECIMAL(15,4) NOT NULL,
    unit_cost DECIMAL(18,4) NOT NULL,
    total_value DECIMAL(18,2) GENERATED ALWAYS AS (quantity * unit_cost) STORED,
    
    count_date DATE NOT NULL,
    
    is_verified BOOLEAN DEFAULT FALSE,
    verified_by UUID REFERENCES users(id),
    verification_method VARCHAR(50),
    
    system_quantity DECIMAL(15,4),
    variance_quantity DECIMAL(15,4) GENERATED ALWAYS AS (quantity - COALESCE(system_quantity, quantity)) STORED,
    
    status VARCHAR(50) DEFAULT 'pending',
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 2.2 Function ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ

```sql
CREATE OR REPLACE FUNCTION migrate_inventory_balances(p_project_id UUID, p_opening_date DATE)
RETURNS TABLE (success BOOLEAN, items_migrated INTEGER, total_value DECIMAL, message TEXT) AS $$
DECLARE
    v_count INTEGER := 0;
    v_total DECIMAL := 0;
BEGIN
    SELECT COUNT(*), COALESCE(SUM(total_value), 0) INTO v_count, v_total
    FROM inventory_opening_balances WHERE migration_project_id = p_project_id AND status = 'verified';
    
    IF v_count = 0 THEN
        RETURN QUERY SELECT FALSE, 0, 0::DECIMAL, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø© Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ØªÙ…Ø¯Ø©';
        RETURN;
    END IF;
    
    UPDATE inventory i SET quantity = iob.quantity, unit_cost = iob.unit_cost
    FROM inventory_opening_balances iob
    WHERE i.item_id = iob.item_id AND i.warehouse_id = iob.warehouse_id 
      AND iob.migration_project_id = p_project_id AND iob.status = 'verified';
    
    INSERT INTO inventory_movements (movement_type, item_id, to_warehouse_id, quantity, unit_cost, reference_type, notes)
    SELECT 'in', item_id, warehouse_id, quantity, unit_cost, 'migration', 'Ø±ØµÙŠØ¯ Ø§ÙØªØªØ§Ø­ÙŠ'
    FROM inventory_opening_balances WHERE migration_project_id = p_project_id AND status = 'verified';
    
    UPDATE inventory_opening_balances SET status = 'posted' WHERE migration_project_id = p_project_id AND status = 'verified';
    
    RETURN QUERY SELECT TRUE, v_count, v_total, 'ØªÙ… ØªØ±Ø­ÙŠÙ„ ' || v_count || ' ØµÙ†Ù';
END;
$$ LANGUAGE plpgsql;
```

---

## 3. APIs ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| POST | `/api/v1/migration/suppliers/import` | Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| GET | `/api/v1/migration/suppliers/balances` | Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| PUT | `/api/v1/migration/suppliers/balances/:id/verify` | Ø§Ø¹ØªÙ…Ø§Ø¯ Ø±ØµÙŠØ¯ Ù…ÙˆØ±Ø¯ |
| POST | `/api/v1/migration/suppliers/migrate` | ØªÙ†ÙÙŠØ° ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| POST | `/api/v1/migration/inventory/import` | Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| GET | `/api/v1/migration/inventory/balances` | Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| PUT | `/api/v1/migration/inventory/balances/:id/verify` | Ø§Ø¹ØªÙ…Ø§Ø¯ Ø±ØµÙŠØ¯ ØµÙ†Ù |
| POST | `/api/v1/migration/inventory/migrate` | ØªÙ†ÙÙŠØ° ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |


---

# ğŸ”Œ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ± (02)

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙŠØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ± Ø¹Ø¨Ø±:
1. **APIs Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©** - Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø®Ø±Ù‰
2. **Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø­Ø¯Ø§Ø«** - Ù„Ù†Ø´Ø± Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
3. **Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ** - Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
4. **ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†** - Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©

---

## ğŸ“¡ APIs Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ±

Ø¬Ù…ÙŠØ¹ APIs Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ù…ØªØ§Ø­Ø© Ø¹Ø¨Ø± `/api/inventory/*`:

| Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© | Endpoint | Ø§Ù„ÙˆØµÙ |
|----------|----------|-------|
| Ø§Ù„Ù…Ø®Ø²ÙˆÙ† | `/api/inventory/items` | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù |
| Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª | `/api/inventory/warehouses` | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª |
| Ø§Ù„Ø­Ø±ÙƒØ§Øª | `/api/inventory/movements` | Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† |
| Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª | `/api/inventory/purchases` | Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ |
| Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† | `/api/inventory/suppliers` | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |

---

## ğŸ¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©

```
inventory.received          - Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø®Ø²ÙˆÙ†
inventory.issued            - ØµØ±Ù Ù…Ø®Ø²ÙˆÙ†
inventory.transferred       - Ù†Ù‚Ù„ Ù…Ø®Ø²ÙˆÙ†
inventory.adjusted          - ØªØ¹Ø¯ÙŠÙ„ Ù…Ø®Ø²ÙˆÙ†
inventory.low_stock         - Ù†Ù‚Øµ Ù…Ø®Ø²ÙˆÙ†
inventory.material_available - ØªÙˆÙØ± Ù…Ø§Ø¯Ø©

purchase.created            - Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡
purchase.approved           - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡
purchase.received           - Ø§Ø³ØªÙ„Ø§Ù… Ø£Ù…Ø± Ø´Ø±Ø§Ø¡
purchase.cancelled          - Ø¥Ù„ØºØ§Ø¡ Ø£Ù…Ø± Ø´Ø±Ø§Ø¡

supplier.payment_due        - Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø¯ÙØ¹Ø© Ù…ÙˆØ±Ø¯
```

---

## ğŸ“¥ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø©

| Ø§Ù„Ø­Ø¯Ø« | Ø§Ù„Ù…ØµØ¯Ø± | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ |
|-------|--------|---------|
| `work_order.created` | Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© | Ø­Ø¬Ø² Ù…ÙˆØ§Ø¯ |
| `work_order.completed` | Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© | ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØµØ±Ù |
| `maintenance.scheduled` | Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„ØµÙŠØ§Ù†Ø© | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± |
| `project.approved` | Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ | Ø­Ø¬Ø² Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ |

---

## ğŸ’° Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ

### Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

```sql
-- Trigger Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠÙˆØ¯ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
CREATE OR REPLACE FUNCTION create_inventory_journal()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.movement_type = 'receipt' THEN
        -- Ù‚ÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù…
        INSERT INTO journal_entries (...)
        VALUES (...);
    ELSIF NEW.movement_type = 'issue' THEN
        -- Ù‚ÙŠØ¯ ØµØ±Ù
        INSERT INTO journal_entries (...)
        VALUES (...);
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## ğŸ“Š Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ±

```sql
INSERT INTO performance_metrics (metric_name, metric_type, metric_value, labels)
VALUES
  ('inventory.total_items', 'gauge', 1500, '{}'),
  ('inventory.low_stock_items', 'gauge', 25, '{}'),
  ('inventory.pending_orders', 'gauge', 10, '{}'),
  ('inventory.turnover_rate', 'gauge', 4.5, '{}');
```

---

## ğŸ¤– ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ

### Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø·Ù„Ø¨

```
POST /api/ai/predict/inventory-demand
{
  "item_id": "uuid",
  "forecast_months": 3
}
```

### ØªØ­Ø³ÙŠÙ† Ù†Ù‚Ø§Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨

```
POST /api/ai/optimize/reorder-points
{
  "warehouse_id": "uuid",
  "service_level": 0.95
}
```


---

## ğŸ› ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…

### Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹

| Ø§Ù„Ø¹Ù†ØµØ± | Ø§Ù„Ù‚ÙŠÙ…Ø© |
|--------|--------|
| **Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹** | `inventory-system` |
| **Ø§Ù„Ù…Ù†ÙØ° API** | 3006 |
| **Ø§Ù„Ù…Ù†ÙØ° Web** | 4206 |
| **Ø¨Ø§Ø¯Ø¦Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„** | `inv_` |
| **Ù…Ø³Ø§Ø± API** | `/api/v1/inventory` |

### Prisma Schema Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ

```prisma
model inv_warehouses {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(20)
  name        String   @db.VarChar(200)
  type        String   @db.VarChar(50)
  stationId   String?  @map("station_id") @db.Uuid
  address     String?  @db.Text
  managerId   String?  @map("manager_id") @db.Uuid
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  items       inv_warehouse_items[]
  transactions inv_transactions[]
  
  @@map("inv_warehouses")
}

model inv_items {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(50)
  name        String   @db.VarChar(200)
  nameEn      String?  @map("name_en") @db.VarChar(200)
  categoryId  String   @map("category_id") @db.Uuid
  unit        String   @db.VarChar(20)
  barcode     String?  @db.VarChar(50)
  minStock    Int      @default(0) @map("min_stock")
  maxStock    Int?     @map("max_stock")
  reorderPoint Int?    @map("reorder_point")
  unitCost    Decimal  @default(0) @map("unit_cost") @db.Decimal(15, 2)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  category    inv_categories @relation(fields: [categoryId], references: [id])
  warehouseItems inv_warehouse_items[]
  
  @@map("inv_items")
}

model inv_categories {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(20)
  name        String   @db.VarChar(100)
  parentId    String?  @map("parent_id") @db.Uuid
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  
  parent      inv_categories?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    inv_categories[] @relation("CategoryHierarchy")
  items       inv_items[]
  
  @@map("inv_categories")
}

model inv_warehouse_items {
  id          String   @id @default(uuid()) @db.Uuid
  warehouseId String   @map("warehouse_id") @db.Uuid
  itemId      String   @map("item_id") @db.Uuid
  quantity    Int      @default(0)
  avgCost     Decimal  @default(0) @map("avg_cost") @db.Decimal(15, 2)
  lastReceiveDate DateTime? @map("last_receive_date")
  lastIssueDate DateTime? @map("last_issue_date")
  
  warehouse   inv_warehouses @relation(fields: [warehouseId], references: [id])
  item        inv_items @relation(fields: [itemId], references: [id])
  
  @@unique([warehouseId, itemId])
  @@map("inv_warehouse_items")
}

model inv_transactions {
  id              String   @id @default(uuid()) @db.Uuid
  transactionNumber String @unique @map("transaction_number") @db.VarChar(50)
  type            String   @db.VarChar(20)
  warehouseId     String   @map("warehouse_id") @db.Uuid
  referenceType   String?  @map("reference_type") @db.VarChar(50)
  referenceId     String?  @map("reference_id") @db.Uuid
  status          String   @default("draft") @db.VarChar(20)
  notes           String?  @db.Text
  createdBy       String   @map("created_by") @db.Uuid
  approvedBy      String?  @map("approved_by") @db.Uuid
  approvedAt      DateTime? @map("approved_at")
  createdAt       DateTime @default(now()) @map("created_at")
  
  warehouse       inv_warehouses @relation(fields: [warehouseId], references: [id])
  lines           inv_transaction_lines[]
  
  @@index([warehouseId])
  @@index([type])
  @@map("inv_transactions")
}

model inv_transaction_lines {
  id            String   @id @default(uuid()) @db.Uuid
  transactionId String   @map("transaction_id") @db.Uuid
  itemId        String   @map("item_id") @db.Uuid
  quantity      Int
  unitCost      Decimal  @map("unit_cost") @db.Decimal(15, 2)
  totalCost     Decimal  @map("total_cost") @db.Decimal(15, 2)
  
  transaction   inv_transactions @relation(fields: [transactionId], references: [id])
  
  @@map("inv_transaction_lines")
}

model inv_suppliers {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(20)
  name        String   @db.VarChar(200)
  contactName String?  @map("contact_name") @db.VarChar(100)
  phone       String?  @db.VarChar(20)
  email       String?  @db.VarChar(255)
  address     String?  @db.Text
  taxNumber   String?  @map("tax_number") @db.VarChar(50)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  purchaseOrders inv_purchase_orders[]
  
  @@map("inv_suppliers")
}

model inv_purchase_orders {
  id            String    @id @default(uuid()) @db.Uuid
  orderNumber   String    @unique @map("order_number") @db.VarChar(50)
  supplierId    String    @map("supplier_id") @db.Uuid
  warehouseId   String    @map("warehouse_id") @db.Uuid
  status        String    @default("draft") @db.VarChar(20)
  orderDate     DateTime  @map("order_date") @db.Date
  expectedDate  DateTime? @map("expected_date") @db.Date
  totalAmount   Decimal   @map("total_amount") @db.Decimal(15, 2)
  notes         String?   @db.Text
  createdBy     String    @map("created_by") @db.Uuid
  approvedBy    String?   @map("approved_by") @db.Uuid
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  supplier      inv_suppliers @relation(fields: [supplierId], references: [id])
  lines         inv_purchase_order_lines[]
  
  @@map("inv_purchase_orders")
}

model inv_purchase_order_lines {
  id              String   @id @default(uuid()) @db.Uuid
  purchaseOrderId String   @map("purchase_order_id") @db.Uuid
  itemId          String   @map("item_id") @db.Uuid
  quantity        Int
  unitPrice       Decimal  @map("unit_price") @db.Decimal(15, 2)
  totalPrice      Decimal  @map("total_price") @db.Decimal(15, 2)
  receivedQty     Int      @default(0) @map("received_qty")
  
  purchaseOrder   inv_purchase_orders @relation(fields: [purchaseOrderId], references: [id])
  
  @@map("inv_purchase_order_lines")
}
```

### Environment Variables

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/electricity_management"
JWT_SECRET="inventory-system-secret-key"
API_PORT=3006
CORE_API_URL="http://localhost:3001/api/v1"
ASSETS_API_URL="http://localhost:3003/api/v1"
```
